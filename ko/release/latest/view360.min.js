!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@egjs/component"),require("gl-matrix"),require("@egjs/imready")):"function"==typeof define&&define.amd?define(["@egjs/component","gl-matrix","@egjs/imready"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).View360=e(t.Component,t.glMatrix,t.eg.ImReady)}(this,(function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var n=i(t),o=i(s);function r(t,e,s,i){return new(s||(s=Promise))((function(n,o){function r(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,a)}h((i=i.apply(t,e||[])).next())}))}class a extends Error{constructor(t,e){super(t),Object.setPrototypeOf(this,a.prototype),this.name="View360Error",this.code=e}}const h={WRONG_TYPE:0,WRONG_OPTION:1,ELEMENT_NOT_FOUND:2,CANVAS_NOT_FOUND:3,WEBGL_NOT_SUPPORTED:4,FAILED_CREATE_CONTEXT_2D:5,PROVIDE_PROJECTION_FIRST:6,FAILED_LINKING_PROGRAM:7,INSUFFICIENT_ARGS:8};var l=h,c={WRONG_TYPE:(t,e)=>`${typeof t} is not a ${e.map((t=>`"${t}"`)).join(" or ")}.`,WRONG_OPTION:(t,e)=>`Bad option: given "${t}" for option "${e}".`,ELEMENT_NOT_FOUND:t=>`Element with selector "${t}" not found.`,CANVAS_NOT_FOUND:"The canvas element was not found inside the given root element.",WEBGL_NOT_SUPPORTED:"WebGL is not supported on this browser.",FAILED_CREATE_CONTEXT_2D:"Failed to create canvas 2D context",PROVIDE_PROJECTION_FIRST:'"projection" should be provided before initialization.',FAILED_LINKING_PROGRAM:(t,e)=>`Failed linking WebGL program - "${t}\nShader compile Log: ${e}`,INSUFFICIENT_ARGS:(t,e)=>`Insufficient arguments: given "${t}" for "${e}".`};const u="mousedown",_="mousemove",d="mouseup",m="touchstart",p="touchmove",g="touchend",v="wheel",E="resize",T="contextmenu",b="mouseenter",f="mouseleave",R="keydown",w="keyup",y="click",L="webglcontextcreationerror",C="webglcontextlost",O="webglcontextrestored",x="deviceorientation",I="devicemotion",A="orientationchange",S="play",P="pause",N="loadeddata",M="volumechange",D="timeupdate",U="durationchange",B="canplaythrough",F="transitionend",z="end",V="div",G="button";var k;!function(t){t[t.LEFT=0]="LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.RIGHT=2]="RIGHT"}(k||(k={}));const H="grab",Y="grabbing",X="",W=["LEFT","UP","RIGHT","DOWN"];var q;!function(t){t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN"}(q||(q={}));const j={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"},K=["requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","webkitCancelFullScreen","mozRequestFullScreen","msRequestFullscreen"],Z=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],$=["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"],Q=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],J={CONTAINER:"view360-container",CANVAS:"view360-canvas",CTX_LOST:"view360-ctx-lost",IN_VR:"view360-vr-presenting",HOTSPOT_CONTAINER:"view360-hotspots",HOTSPOT:"view360-hotspot",HOTSPOT_VISIBLE:"view360-hotspot-visible",HOTSPOT_FLIP_X:"view360-hotspot-flip-x",HOTSPOT_FLIP_Y:"view360-hotspot-flip-y"},tt={READY:"ready",LOAD_START:"loadStart",LOAD:"load",PROJECTION_CHANGE:"projectionChange",RESIZE:"resize",BEFORE_RENDER:"beforeRender",RENDER:"render",INPUT_START:"inputStart",INPUT_END:"inputEnd",VIEW_CHANGE:"viewChange",STATIC_CLICK:"staticClick",VR_START:"vrStart",VR_END:"vrEnd"},et={LINEAR:t=>t,SINE_WAVE:t=>Math.sin(t*Math.PI*2),EASE_OUT_CUBIC:t=>1-Math.pow(1-t,3),EASE_OUT_BOUNCE:t=>{const e=7.5625,s=2.75;return t<1/s?e*t*t:t<2/s?e*(t-=1.5/s)*t+.75:t<2.5/s?e*(t-=2.25/s)*t+.9375:e*(t-=2.625/s)*t+.984375}};var st;const it="animationEnd",nt="update",ot="inputStart",rt="change",at="inputEnd",ht="enable",lt="disable",ct="staticClick",ut=Math.PI/180,_t=180/Math.PI,dt=et.EASE_OUT_CUBIC,mt=300,pt={min:-1/0,max:1/0},gt={min:-90,max:90},vt={min:.6,max:10};var Et;!function(t){t[t.ZERO=0]="ZERO",t[t.CW_90=1]="CW_90",t[t.CCW_90=2]="CCW_90",t[t.CW_180=3]="CW_180"}(Et||(Et={}));const Tt="view360videotimechange",bt="http://www.w3.org/2000/svg",ft="immersive-vr",Rt="local",wt=null!==(st=Number.EPSILON)&&void 0!==st?st:2220446049250313e-31,yt=t=>"string"==typeof t,Lt=(t,e=V)=>{const s=document.createElement(e);return s.classList.add(t),s},Ct=(t,e)=>{let s=null;if(yt(t)){const i=(e||document).querySelector(t);if(!i)return null;s=i}else(i=t)&&i.nodeType===Node.ELEMENT_NODE&&(s=t);var i;return s},Ot=(t,e,s)=>Math.max(Math.min(t,s),e),xt=(t,e,s)=>t*(1-s)+e*s,It=(t,e,s)=>{const i=Math.abs(s-e);if(t<e){t=s-(e-t)%i}else if(t>s){t=e+(t-s)%i}return t},At=(t,e)=>{for(let s=0;s<t.length;s++)if(e(t[s]))return s;return-1},St=t=>"object"==typeof t?t:{},Pt=(t,e)=>2*Math.atan(Math.tan(.5*t)/e),Nt=(t,e,s="RLUDFB")=>s.split("").map((t=>e.indexOf(t))).map((e=>t[e])),Mt=()=>{if(!document)return!1;for(const t of Z)if(document[t])return!0;return!1},Dt=()=>window.isSecureContext&&!!DeviceMotionEvent&&"requestPermission"in DeviceMotionEvent,Ut=(t,s,i,n)=>{e.quat.identity(t);const o=Ot(i,-89.99,89.99);return e.quat.rotateY(t,t,s*ut),e.quat.rotateX(t,t,o*ut),e.quat.rotateZ(t,t,n*ut),t},Bt=t=>{const s=t[0],i=t[1],n=t[2],o=t[3],r=s*s+i*i+n*n+o*o,a=s*o-i*n;let h,l;if(a>.499995*r)h=Math.PI/2,l=2*Math.atan2(i,s);else if(a<-.499995*r)h=-Math.PI/2,l=-2*Math.atan2(i,s);else{const s=e.vec3.fromValues(0,0,1),i=e.vec3.fromValues(0,1,0);e.vec3.transformQuat(s,s,t),e.vec3.transformQuat(i,i,t);const n=Math.sqrt(s[0]*s[0]+s[2]*s[2]);h=Math.atan2(-s[1],n),l=Math.atan2(s[0],s[2])}return{pitch:Ot(h*_t,-90,90),yaw:It(l*_t,0,360)}};class Ft{get val(){return this._val}get start(){return this._start}get end(){return this._end}get progress(){return this._progress}get activated(){return this._activated}get duration(){return this._duration}set duration(t){this._duration=t}get loop(){return this._loop}set loop(t){this._loop=t}get range(){return this._range}get easing(){return this._easing}set easing(t){this._easing=t}constructor({duration:t=300,loop:e=!1,range:s={min:0,max:1},easing:i=dt}={}){this._duration=t,this._loop=e,this._range=s,this._easing=i,this._activated=!1,this.reset(0)}update(t){if(!this._activated)return this._val=this._end,0;const e=this._start,s=this._end,i=this._duration,n=this._val,o=this._loop,r=this._progress+t/i;this._progress=o?It(r,0,1):Ot(r,0,1);const a=this._easing(this._progress);return this._val=xt(e,s,a),!o&&this._progress>=1&&(this._activated=!1),this._val-n}reset(t){const e=this._range,s=Ot(t,e.min,e.max);this._start=s,this._end=s,this._val=s,this._progress=0,this._activated=!1}add(t){const e=this._range;this._start=Ot(this._start+t,e.min,e.max),this._end=Ot(this._end+t,e.min,e.max),this._val=Ot(this._val+t,e.min,e.max)}setNewEndByDelta(t){const e=this._range;this._start=this._val,this._end=Ot(this._end+t,e.min,e.max),this._progress=0,this._activated=!0}setRange(t,e){this._start=Ot(this._start,t,e),this._end=Ot(this._end,t,e),this._range={min:t,max:e}}}class zt{get duration(){return this._motion.duration}set duration(t){this._motion.duration=t}get easing(){return this._motion.easing}set easing(t){this._motion.easing=t}constructor(t,e,s,{duration:i=300,easing:n=dt}={}){this._camera=t,this._motion=new Ft({duration:i,easing:n,range:{min:0,max:1}}),this._from=e,this._to=s,this._finishPromise=new Promise((t=>{this._finish=t})),this._motion.setNewEndByDelta(1)}getFinishPromise(){return this._finishPromise}update(t){const s=this._camera,i=this._from,n=this._to,o=this._motion;o.update(t);const r=o.val,a=e.quat.create(),h=xt(i.zoom,n.zoom,r);e.quat.slerp(a,i.rotation,n.rotation,r),s.rotate(a,h),r>=1&&this._finish()}}class Vt extends n.default{get aspect(){return this._aspect}get changed(){return this._changed}get yawRange(){return this._initialYawRange}set yawRange(t){this._initialYawRange=t}get pitchRange(){return this._initialPitchRange}set pitchRange(t){this._initialPitchRange=t}get zoomRange(){return this._initialZoomRange}set zoomRange(t){this._initialZoomRange=t}constructor({initialYaw:t,initialPitch:s,initialZoom:i,yawRange:n,pitchRange:o,zoomRange:r,fov:a}){super(),this.yaw=t,this.pitch=s,this.zoom=i,this.rollOffset=0,this.initialYaw=t,this.initialPitch=s,this.initialZoom=i,this.position=e.vec3.create(),this.animation=null,this._up=e.vec3.fromValues(0,1,0),this._aspect=1,this._initialYawRange=n,this._initialPitchRange=o,this._initialZoomRange=r,this._yawRange=n,this._pitchRange=o,this._zoomRange=r,this.quaternion=e.quat.create(),this._updateQuaternion(),this.viewMatrix=e.mat4.create(),this.projectionMatrix=e.mat4.create(),this.fov=a,this._maxRenderHeight=-1}destroy(){this.off()}resize(t,e){const s=this._aspect;this._aspect=t/e,this._aspect!==s&&this.updateMatrix()}lookAt({yaw:t=this.yaw,pitch:s=this.pitch,zoom:i=this.zoom}){const n=e.quat.clone(this.quaternion),o=this.zoom;this.yaw=It(t,0,360),this.pitch=Ot(s,-90,90),this.zoom=i,this._updateQuaternion();const r=Math.abs(i-o);(!e.quat.equals(this.quaternion,n)||r>=10*wt)&&this.updateMatrix()}rotate(t,s=this.zoom){const i=e.quat.normalize(e.quat.create(),t),n=e.quat.equals(this.quaternion,i);e.quat.copy(this.quaternion,i);const o=this.zoom,{yaw:r,pitch:a}=Bt(i);this.yaw=r,this.pitch=a,this.zoom=s;const h=Math.abs(s-o);(!n||h>=10*wt)&&this.updateMatrix()}animateTo({yaw:t=this.yaw,pitch:s=this.pitch,zoom:i=this.zoom,duration:n=0,easing:o=dt}={}){return r(this,void 0,void 0,(function*(){if(this.yaw===t&&this.pitch===s&&this.zoom===i)return;const r={rotation:e.quat.clone(this.quaternion),zoom:this.zoom},a={rotation:Ut(e.quat.create(),t,s,this.rollOffset),zoom:i},h=new zt(this,r,a,{duration:n,easing:o}),l=h.getFinishPromise();return this.animation=h,l.then((()=>{this.animation=null,this.trigger(it,{animation:h})})),l}))}restrictYawRange(t,e){this._yawRange={min:t,max:e}}restrictPitchRange(t,e){this._pitchRange={min:t,max:e}}restrictZoomRange(t,e){this._zoomRange={min:t,max:e}}restrictRenderHeight(t){this._maxRenderHeight=t}resetRange(){this._yawRange=this._initialYawRange,this._pitchRange=this._initialPitchRange,this._zoomRange=this._initialZoomRange,this._maxRenderHeight=-1}getYawRange(t){const e=this._yawRange,s=this._maxRenderHeight;if(!e)return pt;const i=.5*this.getHorizontalFov(t);let n=e.min,o=e.max;if(s>0){const t=Pt(i*ut,this._aspect),r=.5*s,a=Math.tan(t),h=Math.sqrt((1+r*r)/(1+a*a)),l=Math.atan(Math.tan(i*ut)*h)*_t;n=e.min+l,o=e.max-l}return n>o&&(n=0,o=0),{min:n,max:o}}getPitchRange(t){const e=this._pitchRange,s=this._maxRenderHeight;if(!e)return gt;let i=e.min,n=e.max;if(s>0){const s=.5*this.getVerticalFov(t);i=e.min+s,n=e.max-s}return i>n&&(i=0,n=0),{min:Math.max(i,-90),max:Math.min(n,90)}}getZoomRange(){var t;const e=null!==(t=this._zoomRange)&&void 0!==t?t:vt,s=this.getHorizontalFov(e.max),i=this.getHorizontalFov(e.min),n=this.getHorizontalFov(this.zoom);return{min:Math.max(s,1),max:Math.min(i,180),current:n}}getHorizontalFov(t=this.zoom){return this._getZoomedHorizontalFov(t)*_t}getVerticalFov(t=this.zoom){const e=this._aspect,s=this._getZoomedHorizontalFov(t);return Pt(s,e)*_t}fovToZoom(t){const e=this.fov;return Math.tan(ut*e*.5)/Math.tan(ut*t*.5)}updateMatrix(){const t=this._up,s=this._aspect,i=this.viewMatrix,n=this.projectionMatrix,o=this.position,r=this.quaternion,a=e.vec3.create(),h=e.vec3.fromValues(0,0,-1);e.vec3.transformQuat(h,h,r),e.vec3.transformQuat(a,t,r);const l=this._getZoomedHorizontalFov(),c=Pt(l,s);e.mat4.lookAt(i,o,h,a),e.mat4.perspective(n,c,s,.1,100),this._changed=!0}onFrameRender(){this._changed=!1}_updateQuaternion(){Ut(this.quaternion,this.yaw,this.pitch,this.rollOffset)}_getZoomedHorizontalFov(t=this.zoom){return 2*Math.atan(Math.tan(ut*this.fov*.5)/t)}}class Gt extends n.default{constructor(){super(),this._onMouseDown=t=>{const e=this._el;e&&t.button===k.LEFT&&(t.preventDefault(),e.focus?e.focus():window.focus(),this._prevPos[0]=t.clientX,this._prevPos[1]=t.clientY,window.addEventListener(_,this._onMouseMove,!1),window.addEventListener(d,this._onMouseUp,!1),this.trigger(ot,{srcEvent:t,isTouch:!1,isKeyboard:!1}))},this._onMouseMove=t=>{t.preventDefault();const e=t.clientX,s=t.clientY,i=this._prevPos,n=e-i[0],o=s-i[1];this.trigger(rt,{delta:{x:n,y:o},isTouch:!1,isKeyboard:!1}),i[0]=e,i[1]=s},this._onMouseUp=()=>{this._prevPos[0]=0,this._prevPos[1]=0,window.removeEventListener(_,this._onMouseMove,!1),window.removeEventListener(d,this._onMouseUp,!1),this.trigger(at,{isTouch:!1,isKeyboard:!1,scrolling:!1})},this._el=null,this._prevPos=[0,0]}enable(t){this._el||(t.addEventListener(u,this._onMouseDown),this._el=t)}disable(){const t=this._el;t&&(t.removeEventListener(u,this._onMouseDown),window.removeEventListener(_,this._onMouseMove,!1),window.removeEventListener(d,this._onMouseUp,!1),this._el=null)}}class kt extends n.default{get scrollable(){return this._scrollable}set scrollable(t){this._scrollable=t}constructor(){super(),this._onTouchStart=t=>{if(t.touches.length>1||this._scrolling)return;const e=t.touches[0];this._isFirstTouch=!0,this._prevPos[0]=e.clientX,this._prevPos[1]=e.clientY,this.trigger(ot,{srcEvent:t,isTouch:!0,isKeyboard:!1})},this._onTouchMove=t=>{if(t.touches.length>1||this._scrolling)return;const e=t.touches[0],s=this._scrollable,i=this._prevPos,n=e.clientX,o=e.clientY,r=n-i[0],a=o-i[1];if(this._isFirstTouch){if(s&&!Mt()&&Math.abs(a)>Math.abs(r))return void(this._scrolling=!0);this._isFirstTouch=!1}!1!==t.cancelable&&t.preventDefault(),this.trigger(rt,{delta:{x:r,y:a},isTouch:!0,isKeyboard:!1}),i[0]=n,i[1]=o},this._onTouchEnd=t=>{if(0!==t.touches.length)return;const e=t.touches[0],s=this._prevPos;e?(s[0]=e.clientX,s[1]=e.clientY):(s[0]=0,s[1]=0,this.trigger(at,{isTouch:!0,isKeyboard:!1,scrolling:this._scrolling})),!1!==t.cancelable&&t.preventDefault(),this._scrolling=!1},this._el=null,this._prevPos=[0,0],this._isFirstTouch=!1,this._scrolling=!1,this._scrollable=!1}enable(t){this._el||(t.addEventListener(m,this._onTouchStart,{passive:!1}),t.addEventListener(p,this._onTouchMove,{passive:!1}),t.addEventListener(g,this._onTouchEnd),this._el=t)}disable(){const t=this._el;t&&(t.removeEventListener(m,this._onTouchStart),t.removeEventListener(p,this._onTouchMove),t.removeEventListener(g,this._onTouchEnd),this._el=null)}}class Ht extends n.default{get active(){const t=this._pressed;return t.LEFT||t.UP||t.RIGHT||t.DOWN}constructor(){super(),this._onKeyDown=t=>{if(t.location!==KeyboardEvent.DOM_KEY_LOCATION_STANDARD)return;this._updateKeyPress(t,!0);const e=this._getPressedKeyCount();e<=0||(t.preventDefault(),1!==e||t.repeat||this.trigger(ot,{srcEvent:t,isTouch:!1,isKeyboard:!0}))},this._onKeyUp=t=>{if(t.location!==KeyboardEvent.DOM_KEY_LOCATION_STANDARD)return;this._updateKeyPress(t,!1);this._getPressedKeyCount()>0||this.trigger(at,{isTouch:!1,isKeyboard:!0,scrolling:!1})},this._el=null,this._clearPressedKeys()}enable(t){this._el||(t.addEventListener(R,this._onKeyDown),t.addEventListener(w,this._onKeyUp),this._el=t,this._clearPressedKeys())}disable(){const t=this._el;t&&(t.removeEventListener(R,this._onKeyDown),t.removeEventListener(w,this._onKeyUp),this._el=null,this._clearPressedKeys())}update(){const t=this._getDeltaByPressedKeys();0===t.x&&0===t.y||this.trigger(rt,{delta:t,isTouch:!1,isKeyboard:!0})}_clearPressedKeys(){this._pressed=W.reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:!1})),{})}_updateKeyPress(t,e){const s=this._pressed,i=null!=t.keyCode?q[t.keyCode]:j[t.key];i&&(s[i]=e)}_getPressedKeyCount(){return W.filter((t=>this._pressed[t])).length}_getDeltaByPressedKeys(){const t=this._pressed;let e=0,s=0;return t.LEFT&&(e+=1),t.RIGHT&&(e-=1),t.UP&&(s+=1),t.DOWN&&(s-=1),{x:e,y:s}}}class Yt extends n.default{get enabled(){return this._enabled}get enableBlocked(){return this._enableBlocked}get animating(){return this._keyboardInput.active||this._xMotion.activated||this._yMotion.activated}get yaw(){return this._xMotion}get pitch(){return this._yMotion}get scrollable(){return this._touchInput.scrollable}set scrollable(t){this._touchInput.scrollable=t}get pointerScale(){return this._pointerScale}set pointerScale(t){this._pointerScale=t}get keyboardScale(){return this._keyboardScale}set keyboardScale(t){this._keyboardScale=t}get duration(){return this._duration}set duration(t){this._duration=t,this._xMotion.duration=t,this._yMotion.duration=t}get easing(){return this._easing}set easing(t){this._easing=t,this._xMotion.easing=t,this._yMotion.easing=t}get disablePitch(){return this._disablePitch}set disablePitch(t){this._disablePitch=t}get disableYaw(){return this._disableYaw}set disableYaw(t){this._disableYaw=t}get disableKeyboard(){return this._disableKeyboard}set disableKeyboard(t){this._disableKeyboard=t}constructor(t,e,{duration:s=300,easing:i=dt,pointerScale:n=[1,1],keyboardScale:o=[1,1],disablePitch:r=!1,disableYaw:a=!1,disableKeyboard:h=!1}={}){super(),this._onInputStart=t=>{this._changedWhileDragging=!1,this.trigger(ot,Object.assign(Object.assign({},t),{inputType:"rotate"}))},this._onChange=t=>{const e=t.delta,s=1/this._zoomScale,i=this._screenScale,n=this._keyboardScale,o=this._pointerScale;let r;r=t.isKeyboard?[n[0]*s,n[1]*s]:[o[0]*i[0]*s,o[1]*i[1]*s];const a=e.x*r[0],h=e.y*r[1];this._xMotion.setNewEndByDelta(a),this._yMotion.setNewEndByDelta(h),this._changedWhileDragging=!0},this._onInputEnd=t=>{this.trigger(at,Object.assign(Object.assign({},t),{inputType:"rotate"})),this._changedWhileDragging||t.isKeyboard||t.scrolling||this.trigger(ct,{isTouch:t.isTouch}),this._changedWhileDragging=!1},this._controlEl=t,this._pointerScale=n,this._keyboardScale=o,this._duration=s,this._easing=i,this._disablePitch=r,this._disableYaw=a,this._disableKeyboard=h,this._enableBlocked=e,this._mouseInput=new Gt,this._touchInput=new kt,this._keyboardInput=new Ht,this._xMotion=new Ft({duration:s,range:pt,easing:i}),this._yMotion=new Ft({duration:s,range:gt,easing:i}),this._screenScale=[1,1],this._zoomScale=1,this._enabled=!1,this._changedWhileDragging=!1,this._bindInputs()}destroy(){this.disable(),this._mouseInput.off(),this._touchInput.off(),this._keyboardInput.off(),this.off(),this._changedWhileDragging=!1}update(t){if(!this._enabled)return;const e=this._xMotion,s=this._yMotion,i=this._keyboardInput;this._disableKeyboard||i.update(),this._disablePitch||s.update(t),this._disableYaw||e.update(t)}updateRange(t,e){const s=t.getYawRange(e),i=t.getPitchRange(e);this._xMotion.setRange(s.min,s.max),this._yMotion.setRange(i.min,i.max)}setZoomScale(t){this._zoomScale=t}resize(t,e,s,i){const n=Pt(t*ut,e)*_t;this._screenScale[0]=t/s,this._screenScale[1]=n/i}enable(){if(this._enabled)return;const t=this._controlEl;this._mouseInput.enable(t),this._touchInput.enable(t),this._keyboardInput.enable(t),this._enabled=!0,this._enableBlocked=!1,this.trigger(ht,{control:this,updateCursor:!0})}disable(){this._enabled&&(this._mouseInput.disable(),this._touchInput.disable(),this._keyboardInput.disable(),this._enabled=!1,this.trigger(lt,{updateCursor:!0}))}sync(t){this.updateRange(t,t.zoom),this._xMotion.reset(t.yaw),this._yMotion.reset(t.pitch)}_bindInputs(){const t=this._mouseInput,e=this._touchInput,s=this._keyboardInput;t.on(ot,this._onInputStart),t.on(rt,this._onChange),t.on(at,this._onInputEnd),e.on(ot,this._onInputStart),e.on(rt,this._onChange),e.on(at,this._onInputEnd),s.on(ot,this._onInputStart),s.on(rt,this._onChange),s.on(at,this._onInputEnd)}}class Xt extends n.default{get scrollable(){return this._scrollable}set scrollable(t){this._scrollable=t}constructor(){super(),this._onWheel=t=>{const e=this._scrollable;if(0===t.deltaY||e)return;t.preventDefault(),t.stopPropagation(),this._inputTimer<0?this.trigger(ot,{srcEvent:t,isTouch:!1,isKeyboard:!1}):this._clearTimer();const s=this._baseScale*t.deltaY;this.trigger(rt,{delta:s,isTouch:!1,isKeyboard:!1}),this._inputTimer=window.setTimeout((()=>{this.trigger(at,{isTouch:!1,isKeyboard:!1,scrolling:!1}),this._inputTimer=-1}),mt)},this._el=null,this._baseScale=.04,this._scrollable=!1,this._inputTimer=-1}enable(t){this._el||(t.addEventListener(v,this._onWheel,{passive:!1,capture:!1}),this._el=t,this._clearTimer())}disable(){const t=this._el;t&&(t.removeEventListener(v,this._onWheel,!1),this._el=null,this._clearTimer())}_clearTimer(){window.clearTimeout(this._inputTimer),this._inputTimer=-1}}class Wt extends n.default{constructor(){super(),this._onTouchMove=t=>{const e=t.touches;if(2!==e.length)return;if(!t.cancelable)return;t.preventDefault(),t.stopPropagation();const s=this._prevDistance,i=[e[0].pageX-e[1].pageX,e[0].pageY-e[1].pageY],n=Math.sqrt(i[0]*i[0]+i[1]*i[1])*this._baseScale,o=this._isFirstTouch?0:n-s;this._isFirstTouch&&this.trigger(ot,{srcEvent:t,isTouch:!0,isKeyboard:!1}),this._prevDistance=n,this._isFirstTouch=!1,this.trigger(rt,{delta:o,isTouch:!0,isKeyboard:!1})},this._onTouchEnd=t=>{0===t.touches.length&&(this._isFirstTouch||this.trigger(at,{isTouch:!0,isKeyboard:!1,scrolling:!1}),this._prevDistance=-1,this._isFirstTouch=!0)},this._el=null,this._baseScale=-.2,this._prevDistance=-1,this._isFirstTouch=!0}enable(t){this._el||(t.addEventListener(p,this._onTouchMove,{passive:!1,capture:!1}),t.addEventListener(g,this._onTouchEnd),this._el=t,this._prevDistance=-1,this._isFirstTouch=!0)}disable(){const t=this._el;t&&(t.removeEventListener(p,this._onTouchMove,!1),t.removeEventListener(g,this._onTouchEnd),this._el=null)}}class qt extends n.default{get enabled(){return this._enabled}get enableBlocked(){return this._enableBlocked}get animating(){return this._motion.activated}get zoom(){return this._motion.val}get scrollable(){return this._wheelInput.scrollable}set scrollable(t){this._wheelInput.scrollable=t}get range(){return this._motion.range}get scale(){return this._scale}set scale(t){this._scale=t}get duration(){return this._motion.duration}get easing(){return this._motion.easing}constructor(t,e,{scale:s=1,duration:i=300,easing:n=dt}={}){super(),this._onInputStart=t=>{this.trigger(ot,Object.assign(Object.assign({},t),{inputType:"zoom"}))},this._onChange=({delta:t})=>{const e=t*this._scale;this._motion.setNewEndByDelta(e)},this._onInputEnd=t=>{this.trigger(at,Object.assign(Object.assign({},t),{inputType:"zoom"}))},this._scale=s,this._controlEl=t,this._enableBlocked=e,this._wheelInput=new Xt,this._pinchInput=new Wt,this._motion=new Ft({duration:i,easing:n,range:pt}),this._enabled=!1,this._bindInputs()}destroy(){this.disable(),this._wheelInput.off(),this._pinchInput.off(),this.off()}update(t){if(!this._enabled)return;this._motion.update(t)}enable(){if(this._enabled)return;const t=this._controlEl;this._wheelInput.enable(t),this._pinchInput.enable(t),this._enabled=!0,this._enableBlocked=!1,this.trigger(ht,{control:this,updateCursor:!1})}disable(){this._enabled&&(this._wheelInput.disable(),this._pinchInput.disable(),this._enabled=!1,this.trigger(lt,{updateCursor:!1}))}sync(t){const e=this._motion,s=t.getZoomRange();e.setRange(s.min,s.max),e.reset(s.current)}_bindInputs(){const t=this._wheelInput,e=this._pinchInput;t.on(ot,this._onInputStart),t.on(rt,this._onChange),t.on(at,this._onInputEnd),e.on(ot,this._onInputStart),e.on(rt,this._onChange),e.on(at,this._onInputEnd)}}const jt={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};jt[jt.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},jt[jt.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},jt[jt.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]};class Kt extends n.default{get enabled(){return this._enabled}get orientationUpdated(){return this._orientationUpdated}get ignoreRoll(){return this._ignoreRoll}set ignoreRoll(t){this._ignoreRoll=t}constructor(){super(),this._onDeviceOrientation=t=>{const e=this._orientation,{alpha:s,beta:i,gamma:n}=t;null!=s&&null!=i&&null!=n&&(e.alpha=s,e.beta=i,e.gamma=n,this._orientationUpdated=!0,this._needsCalibrate&&(this._needsCalibrate=!1,this._calibrateSensor()))},this._updateScreenOrientation=()=>{window.screen&&window.screen.orientation&&void 0!==window.screen.orientation.angle?this._screenOrientation=screen.orientation.angle:void 0!==window.orientation?this._screenOrientation=window.orientation>=0?window.orientation:360+window.orientation:this._screenOrientation=0},this.quaternion=e.quat.create(),this._orientation={alpha:0,beta:90,gamma:0},this._yawOrigin=0,this._yawOffset=0,this._orientationUpdated=!1,this._screenOrientation=0,this._needsCalibrate=!0,this._enabled=!1}enable(){this._enabled||(window.addEventListener(x,this._onDeviceOrientation),window.addEventListener(A,this._updateScreenOrientation),this._updateScreenOrientation(),this._orientationUpdated=!1,this._needsCalibrate=!0,this._enabled=!0)}disable(){this._enabled&&(window.removeEventListener(x,this._onDeviceOrientation),window.removeEventListener(A,this._updateScreenOrientation),this._enabled=!1)}update(){this._updateRotation(),this._orientationUpdated=!1}collectDelta(){if(!this._orientationUpdated)return{pitch:0,yaw:0};const t=e.quat.clone(this.quaternion);return this._updateRotation(),this._orientationUpdated=!1,this._toEulerDelta(t,this.quaternion)}setInitialRotation(t){this._yawOrigin=t}_calibrateSensor(){const t=this._yawOrigin,e=this.quaternion;this._yawOffset=0,this._updateRotation();const{yaw:s}=Bt(e);this._yawOffset=s-t,this._updateRotation(),this._needsCalibrate=!1}_updateRotation(){const t=this.quaternion,{alpha:s,beta:i,gamma:n}=this._orientation;e.quat.identity(t),e.quat.rotateY(t,t,(s-this._yawOffset)*ut),e.quat.rotateX(t,t,i*ut),e.quat.rotateZ(t,t,-n*ut);const o=e.quat.create(),r=.5*-this._screenOrientation*ut,a=e.quat.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5));e.quat.set(o,0,Math.sin(r),0,Math.cos(r)),e.quat.multiply(t,t,o),e.quat.multiply(t,t,a),e.quat.normalize(t,t)}_toEulerDelta(t,e){return{yaw:this._getDeltaYaw(t,e),pitch:this._getDeltaPitch(t,e)}}_getDeltaYaw(t,e){const s=this._getRotationDelta(t,e,jt.YAW_DELTA_BY_YAW);return this._getRotationDelta(t,e,jt.YAW_DELTA_BY_ROLL)*Math.sin(this._extractPitchFromQuat(e))+s}_getDeltaPitch(t,e){return this._getRotationDelta(t,e,jt.PITCH_DELTA)}_getRotationDelta(t,s,i){const n=e.vec3.fromValues(jt[i].targetAxis[0],jt[i].targetAxis[1],jt[i].targetAxis[2]),o=jt[i].meshPoint,r=e.quat.clone(t),a=e.quat.clone(s);e.quat.normalize(r,r),e.quat.normalize(a,a);let h=e.vec3.fromValues(0,0,1),l=e.vec3.fromValues(0,0,1);e.vec3.transformQuat(h,h,r),e.vec3.transformQuat(l,l,a),e.vec3.transformQuat(n,n,a);const c=e.vec3.dot(n,e.vec3.cross(e.vec3.create(),h,l))>0?1:-1,u=e.vec3.fromValues(o[0],o[1],o[2]);let _;_=i!==jt.YAW_DELTA_BY_YAW?e.vec3.fromValues(0,c,0):e.vec3.fromValues(c,0,0),e.vec3.transformQuat(u,u,a),e.vec3.transformQuat(_,_,a);const d=u,m=_,p=e.vec3.create();e.vec3.cross(p,d,m),e.vec3.normalize(p,p);const g=p[0],v=p[1],E=p[2];l=e.vec3.fromValues(o[0],o[1],o[2]),e.vec3.transformQuat(l,l,a),h=e.vec3.fromValues(o[0],o[1],o[2]),e.vec3.transformQuat(h,h,r);let T=Math.abs(h[0]*g+h[1]*v+h[2]*E);const b=e.vec3.create();e.vec3.subtract(b,h,e.vec3.scale(e.vec3.create(),p,T));let f=(b[0]*l[0]+b[1]*l[1]+b[2]*l[2])/(e.vec3.length(b)*e.vec3.length(l));f>1&&(f=1);const R=Math.acos(f),w=e.vec3.cross(e.vec3.create(),l,b);let y;T=g*w[0]+v*w[1]+E*w[2],y=i!==jt.YAW_DELTA_BY_YAW?T>0?1:-1:T<0?1:-1;return R*y*c*_t}_extractPitchFromQuat(t){const s=e.vec3.fromValues(0,0,1);return e.vec3.transformQuat(s,s,t),-1*Math.atan2(s[1],Math.sqrt(Math.pow(s[0],2)+Math.pow(s[2],2)))}}class Zt extends n.default{get enabled(){return this._input.enabled}get enableBlocked(){return this._enableBlocked}get animating(){return this._input.enabled&&this._input.orientationUpdated}get ignoreRoll(){return this._ignoreRoll}set ignoreRoll(t){this._ignoreRoll=t}static isAvailable(){return r(this,void 0,void 0,(function*(){if(!DeviceMotionEvent)return!1;let t;return Promise.race([new Promise((e=>{t=t=>{e(t.rotationRate&&null!=t.rotationRate.alpha)},window.addEventListener(I,t)})),new Promise((t=>{setTimeout((()=>t(!1)),1e3)}))]).then((e=>(window.removeEventListener(I,t),e)))}))}static requestSensorPermission(){return r(this,void 0,void 0,(function*(){return!Dt()||DeviceMotionEvent.requestPermission().then((t=>"granted"===t)).catch((()=>!1))}))}constructor(t,{ignoreRoll:e=!0}={}){super(),this._enableBlocked=t,this._ignoreRoll=e,this._input=new Kt}destroy(){this.disable(),this._input.off(),this.off()}update(t,e,s,i){this._ignoreRoll?this._updateYawPitch(t,e,s,i):this._updateQuaternion(t,i)}enable(){this._input.enabled||(this._input.enable(),this._enableBlocked=!1,this.trigger(ht,{control:this,updateCursor:!1}))}disable(){this._input.enabled&&(this._input.disable(),this.trigger(lt,{updateCursor:!1}))}sync(){}_updateYawPitch(t,e,s,i){const n=this._input;if(!n.enabled)return;const{yaw:o,pitch:r}=n.collectDelta();e.add(o),s.add(r),t.lookAt({yaw:e.val,pitch:s.val,zoom:i})}_updateQuaternion(t,e){const s=this._input;s.enabled&&(s.update(),t.rotate(s.quaternion,e))}}class $t{get useGrabCursor(){return this._useGrabCursor}set useGrabCursor(t){t!==this._useGrabCursor&&(this._useGrabCursor=t,t&&this._enabled?this._setCursor(H):t||this._setCursor(X))}get disableContextMenu(){return this._disableContextMenu}set disableContextMenu(t){t!==this._disableContextMenu&&(this._disableContextMenu=t,t&&this._enabled?this._blockContextMenu():t||this._restoreContextMenu())}get scrollable(){return this._rotateControl.scrollable}set scrollable(t){this._rotateControl.scrollable=t}get wheelScrollable(){return this._zoomControl.scrollable}set wheelScrollable(t){this._zoomControl.scrollable=t}get ignoreZoomScale(){return this._ignoreZoomScale}set ignoreZoomScale(t){this._ignoreZoomScale=t}get enabled(){return this._enabled}get rotate(){return this._rotateControl}get zoom(){return this._zoomControl}get gyro(){return this._gyroControl}get animating(){return this._rotateControl.animating||this._zoomControl.animating||this._gyroControl.animating}constructor(t,e,{useGrabCursor:s,scrollable:i,wheelScrollable:n,disableContextMenu:o,rotate:r,zoom:a,gyro:h}){this._preventContextMenu=t=>{t.preventDefault()},this._onInputStart=t=>{this._useGrabCursor&&!t.isKeyboard&&this._setCursor(Y)},this._onInputEnd=t=>{this._useGrabCursor&&!t.isKeyboard&&this._setCursor(H)},this._onEnable=({control:t,updateCursor:e})=>{e&&this._useGrabCursor&&this._setCursor(H),t.sync(this._camera)},this._onDisable=({updateCursor:t})=>{t&&this._setCursor(X)},this._onCameraAnimationEnd=({animation:t})=>{t.getFinishPromise().then((()=>{this.sync()}))},this._useGrabCursor=s,this._disableContextMenu=o,this._camera=e,this._controlEl=t,this._ignoreZoomScale=!1,this._enabled=!1,this._rotateControl=new Yt(t,!r,St(r)),this._zoomControl=new qt(t,!a,St(a)),this._gyroControl=new Zt(!h,St(h)),this._rotateControl.scrollable=i,this._zoomControl.scrollable=n,this._bindEvents()}destroy(){this.disable(),this._rotateControl.destroy(),this._zoomControl.destroy(),this._setCursor(X)}resize(t,e){const s=this._camera;this._rotateControl.resize(s.fov,s.aspect,t,e)}enable(){return r(this,void 0,void 0,(function*(){this._enabled||(this._rotateControl.enableBlocked||this._rotateControl.enable(),this._zoomControl.enableBlocked||this._zoomControl.enable(),this._gyroControl.enableBlocked||(yield Zt.isAvailable())&&this._gyroControl.enable(),this.sync(),this._disableContextMenu&&this._blockContextMenu(),this._enabled=!0)}))}disable(){this._enabled&&(this._rotateControl.disable(),this._zoomControl.disable(),this._gyroControl.disable(),this._restoreContextMenu(),this._enabled=!1)}update(t){const e=this._camera,s=this._rotateControl,i=this._zoomControl,n=this._gyroControl;i.update(t);const o=(r=e.fov,a=i.zoom,Math.tan(ut*r*.5)/Math.tan(ut*a*.5));var r,a;const h=this._ignoreZoomScale?1:Math.max(o,1);s.setZoomScale(h),s.updateRange(e,o),s.update(t);const l=s.yaw,c=s.pitch;n.enabled?n.update(e,l,c,o):e.lookAt({yaw:l.val,pitch:c.val,zoom:o})}sync(){const t=this._camera;this._zoomControl.sync(t),this._rotateControl.sync(t)}_blockContextMenu(){this._controlEl.addEventListener(T,this._preventContextMenu)}_restoreContextMenu(){this._controlEl.removeEventListener(T,this._preventContextMenu)}_setCursor(t){if(!this._useGrabCursor&&t!==X)return;this._controlEl.style.cursor=t}_bindEvents(){const t=this._rotateControl,e=this._zoomControl;t.on(ot,this._onInputStart),t.on(at,this._onInputEnd),t.on(ht,this._onEnable),t.on(lt,this._onDisable),e.on(ht,this._onEnable),e.on(lt,this._onDisable),this._camera.on(it,this._onCameraAnimationEnd)}}class Qt{constructor({width:t,height:e,flipY:s}){this.width=t,this.height=e,this.flipY=s,this.wrapS=WebGLRenderingContext.CLAMP_TO_EDGE,this.wrapT=WebGLRenderingContext.CLAMP_TO_EDGE}destroy(){}isVideo(){return!1}isCube(){return!1}}class Jt extends Qt{constructor({source:t,width:e,height:s,flipY:i}){super({width:e,height:s,flipY:i}),this.source=t}}class te extends Jt{destroy(){const t=this.source;t.pause(),t.removeAttribute("src"),t.load()}isVideo(){return!0}isPaused(){const t=this.source;return t.paused||t.ended||t.readyState<=2}hasAudio(){const t=this.source;return t.audioTracks?t.audioTracks.length>0:null!=t.webkitAudioDecodedByteCount?t.webkitAudioDecodedByteCount>0:null==t.mozHasAudio||t.mozHasAudio}}class ee extends Qt{constructor({sources:t,width:e,height:s,flipY:i}){super({width:e,height:s,flipY:i}),this.sources=t}isCube(){return!0}}class se{constructor(){this._loadChecker=new o.default}load(t,e){return r(this,void 0,void 0,(function*(){if(e)return this.loadVideo(t,St(e));if(Array.isArray(t)&&t.length>1)return this.loadCubeImage(t);{const e=Array.isArray(t)?t[0]:t;return this.loadImage(e)}}))}loadImage(t){return r(this,void 0,void 0,(function*(){const e=this._toImageArray(t);return this._load(e,(t=>{const s=e[0];t(new Jt({source:s,width:s.naturalWidth,height:s.naturalHeight,flipY:!0}))}))}))}loadCubeImage(t){return r(this,void 0,void 0,(function*(){const e=this._toImageArray(t);return this._load(e,(t=>{t(new ee({sources:e,width:e[0].naturalWidth,height:e[0].naturalHeight,flipY:!1}))}))}))}loadVideo(t,e){return r(this,void 0,void 0,(function*(){const s=Object.assign({autoplay:!0,muted:!0,loop:!1,volume:1},e),i=this._toVideoElement(t,s);return this._load([i],(t=>{const{autoplay:e,muted:n}=s;i.currentTime=0,e&&n&&i.play().catch((()=>{})),t(new te({source:i,width:i.videoWidth,height:i.videoHeight,flipY:!0}))}))}))}_load(t,e){const s=this._loadChecker;return new Promise(((i,n)=>{s.once("ready",(t=>{t.errorCount>0||e(i)})),s.once("error",n),s.check(t)}))}_toImageArray(t){return(Array.isArray(t)?t:[t]).map((t=>{if(yt(t)){const e=new Image;return e.crossOrigin="anonymous",e.src=t,e}return t}))}_toVideoElement(t,{muted:e,loop:s,volume:i}){if(t instanceof HTMLVideoElement)return t;const n=document.createElement("video");n.crossOrigin="anonymous",n.playsInline=!0,n.setAttribute("webkit-playsinline",""),n.muted=e,n.volume=i,n.loop=s,Array.isArray(t)?t.forEach((t=>this._appendSourceElement(n,t))):this._appendSourceElement(n,t);return n.querySelectorAll("source").length>0&&n.readyState<1&&n.load(),n}_appendSourceElement(t,e){if(e instanceof HTMLSourceElement)return e;const s=document.createElement("source");s.src=e,t.appendChild(s)}}class ie{constructor(t,e=window){this.maxDeltaTime=t,this._context=e,this._rafId=-1,this._rafTimer=-1,this._lastUpdateTime=-1}start(t){const e=this._context;if(!e||!t)return;if(this._rafId>=0||this._rafTimer>=0)return;const s=(i,n)=>{const o=Date.now(),r=Math.min(o-this._lastUpdateTime,1e3*this.maxDeltaTime);t(r,n),this._lastUpdateTime=o,this._rafId=e.requestAnimationFrame(s)};this._lastUpdateTime=Date.now(),this._rafId=e.requestAnimationFrame(s)}stop(){this._rafId>=0&&this._context.cancelAnimationFrame(this._rafId),this._rafTimer>=0&&clearTimeout(this._rafTimer),this._rafId=-1,this._rafTimer=-1}changeContext(t){this.stop(),this._context=t}}class ne{get useResizeObserver(){return this._useResizeObserver}get enabled(){return this._enabled}constructor(t,e){this._skipFirstResize=(()=>{let t=!0;return()=>{t?t=!1:this._onResize()}})(),this._useResizeObserver=t,this._enabled=!1,this._resizeObserver=null,this._onResize=e}enable(t){if(this._enabled&&this.disable(),this._useResizeObserver&&window.ResizeObserver){const e=t.getBoundingClientRect(),s=0!==e.width||0!==e.height,i=new ResizeObserver(s?this._skipFirstResize:this._onResize);i.observe(t),this._resizeObserver=i}else window.addEventListener(E,this._onResize);return this._enabled=!0,this}disable(){if(!this._enabled)return this;const t=this._resizeObserver;return t?(t.disconnect(),this._resizeObserver=null):window.removeEventListener(E,this._onResize),this._enabled=!1,this}}class oe{get enabled(){return this._enabled}get enableBlocked(){return this._enableBlocked}get playing(){return this._enabled&&!this._interrupted}get delay(){return this._delay}set delay(t){this._delay=t}get delayOnMouseLeave(){return this._delayOnMouseLeave}set delayOnMouseLeave(t){this._delayOnMouseLeave=t}get speed(){return this._speed}set speed(t){this._speed=t}get pauseOnHover(){return this._pauseOnHover}set pauseOnHover(t){this._pauseOnHover=t}get canInterrupt(){return this._canInterrupt}set canInterrupt(t){this._canInterrupt=t}get disableOnInterrupt(){return this._disableOnInterrupt}set disableOnInterrupt(t){this._disableOnInterrupt=t}constructor(t,e,s){this._onInputStart=()=>{this._canInterrupt&&(this._interrupted=!0,this._clearTimeout())},this._onInputEnd=()=>{this._setUninterruptedAfterDelay(this._delay)},this._onGyroEnable=()=>{this.disable()},this._onMouseEnter=()=>{this._pauseOnHover&&(this._interrupted=!0,this._hovering=!0)},this._onMouseLeave=()=>{this._pauseOnHover&&(this._hovering=!1,this._setUninterruptedAfterDelay(this._delayOnMouseLeave))},this._camera=t.camera,this._control=t.control,this._element=e,this._enabled=!1,this._interrupted=!1,this._interruptionTimer=-1,this._hovering=!1;const{delay:i=2e3,delayOnMouseLeave:n=0,speed:o=1,pauseOnHover:r=!1,canInterrupt:a=!0,disableOnInterrupt:h=!1}=St(s);this._enableBlocked=!s,this._delay=i,this._delayOnMouseLeave=n,this._speed=o,this._pauseOnHover=r,this._canInterrupt=a,this._disableOnInterrupt=h}destroy(){this.disable()}update(t){if(!this._enabled)return;if(this._interrupted)return void(this._disableOnInterrupt&&this.disable());const e=this._camera,s=-this._speed*t/100;e.yaw=It(e.yaw+s,0,360)}enable(){const t=this._control,e=this._element;this._enabled||t.gyro.enabled||(t.rotate.on(ot,this._onInputStart),t.rotate.on(at,this._onInputEnd),t.zoom.on(ot,this._onInputStart),t.zoom.on(at,this._onInputEnd),t.gyro.on(ht,this._onGyroEnable),e.addEventListener(b,this._onMouseEnter,!1),e.addEventListener(f,this._onMouseLeave,!1),this._enabled=!0,this._enableBlocked=!1)}enableAfterDelay(){this.enable(),this._interrupted=!0,this._setUninterruptedAfterDelay(this._delay)}disable(){if(!this._enabled)return;const t=this._control,e=this._element;t.rotate.off(ot,this._onInputStart),t.rotate.off(at,this._onInputEnd),t.zoom.off(ot,this._onInputStart),t.zoom.off(at,this._onInputEnd),t.gyro.off(ht,this._onGyroEnable),e.removeEventListener(b,this._onMouseEnter,!1),e.removeEventListener(f,this._onMouseLeave,!1),this._enabled=!1,this._interrupted=!1,this._hovering=!1,this._clearTimeout()}_setUninterruptedAfterDelay(t){this._hovering||(this._clearTimeout(),t>0?this._interruptionTimer=window.setTimeout((()=>{this._interrupted=!1,this._interruptionTimer=-1}),t):(this._interrupted=!1,this._interruptionTimer=-1))}_clearTimeout(){this._interruptionTimer>=0&&(window.clearTimeout(this._interruptionTimer),this._interruptionTimer=-1)}}class re extends n.default{constructor(t,e={}){super(),this.destroy=()=>{this.exit(),this.off()},this._onSessionEnd=()=>{this.exit(),this.trigger(tt.VR_END)},this._xrSession=null,this._xrRefSpace=null,this._ctx=t,this._options=e}isAvailable(){return r(this,void 0,void 0,(function*(){const t=window.navigator.xr;return!!t&&t.isSessionSupported(ft).then((t=>t)).catch((()=>!1))}))}enter(){return r(this,void 0,void 0,(function*(){const t=this._ctx,e=window.navigator.xr;if(!e)return;yield Zt.requestSensorPermission();const s=Object.assign({requiredFeatures:[Rt]},this._options);yield t.makeXRCompatible();const i=yield e.requestSession(ft,s);t.bindXRLayer(i);const n=yield i.requestReferenceSpace(Rt);this._setSession(i,n),this.trigger(tt.VR_START,{session:i})}))}exit(){const t=this._xrSession;t&&t.end().catch((()=>{})),this._xrSession=null,this._xrRefSpace=null}canRender(t){const e=this._xrRefSpace;if(!e)return!1;return!!t.getViewerPose(e)}getEyeParams(t){const e=t.session,s=t.getViewerPose(this._xrRefSpace);if(!s)return null;const i=e.renderState.baseLayer;return i?s.views.map((t=>({viewport:i.getViewport(t),vMatrix:t.transform.inverse.matrix,pMatrix:t.projectionMatrix}))):null}_setSession(t,e){this._xrSession=t,this._xrRefSpace=e,t.addEventListener(z,this._onSessionEnd)}}class ae{constructor(t,e){this.element=t,this.position=e}}class he{constructor(t,e,{zoom:s=!1}){this._containerEl=Ct(`.${J.HOTSPOT_CONTAINER}`,t),this._renderer=e,this._hotspots=[],this._zoom=s}refresh(){const t=this._containerEl;if(!t)return;const e=[].slice.apply(t.querySelectorAll(`.${J.HOTSPOT}`));this._hotspots=e.map((t=>this._parseHotspot(t)))}render(t){const s=this._hotspots,i=.5*this._renderer.width,n=.5*this._renderer.height,o=t.zoom,r="translate(-50%, -50%)",a=this._zoom?`scale(${o})`:"";s.forEach((s=>{const o=s.position,h=e.vec3.create();if(e.vec3.copy(h,o),e.vec3.transformMat4(h,h,t.viewMatrix),e.vec3.transformMat4(h,h,t.projectionMatrix),h[2]>1||h[2]<0)return void s.element.classList.remove(J.HOTSPOT_VISIBLE);const l=e.vec2.fromValues(h[0]*i+i,-h[1]*n+n);s.element.classList.add(J.HOTSPOT_VISIBLE),s.element.style.transform=[r,`translate(${l[0]}px, ${l[1]}px)`,a].join(" ")}))}_parseHotspot(t){const s=t.dataset.yaw,i=t.dataset.pitch,n=t.dataset.position;if(s||i){const e=s?parseFloat(s):0,n=i?parseFloat(i):0,o=this._yawPitchToVec3(e,n);return new ae(t,o)}if(n){const s=n.split(" ").map((t=>parseFloat(t)));if(s.length<3)throw new a(c.INSUFFICIENT_ARGS(n,'hotspot attribute "data-position"'),l.INSUFFICIENT_ARGS);return new ae(t,e.vec3.fromValues(s[0],s[1],s[2]))}{const s=e.vec3.fromValues(0,0,-1);return new ae(t,s)}}_yawPitchToVec3(t,s){const i=t*ut,n=s*ut,o=e.vec3.create();return o[1]=Math.sin(n),o[2]=Math.cos(n),o[0]=o[2]*Math.sin(-i),o[2]=-o[2]*Math.cos(-i),o}}class le{get count(){return this.geometry.indicies.count}constructor(t,e,s){this.obj=t,this.geometry=e,this.buffers=s}}class ce{get canvas(){return this._canvas}get maxTextureSize(){return this._maxTextureSize}get isWebGL2(){return this._isWebGL2}get supportVAO(){return this._isWebGL2||!!this._extensions.vao}get lost(){return this._contextLost}get debug(){return this._debug}constructor(t,e){this._onContextLost=()=>{this._canvas.classList.add(J.CTX_LOST),this._contextLost=!0},this._onContextRestore=()=>{this._canvas.classList.remove(J.CTX_LOST),this._contextLost=!1},this._canvas=t,this._contextLost=!1,this._debug=e,this._extensions={vao:null,loseContext:null}}init(){const t=this._canvas,{gl:e,isWebGL2:s}=this._getContext(t);this._gl=e,this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._isWebGL2=s,this._isWebGL2||(this._extensions.vao=e.getExtension("OES_vertex_array_object")),this._extensions.loseContext=e.getExtension("WEBGL_lose_context"),t.addEventListener(C,this._onContextLost),t.addEventListener(O,this._onContextRestore)}destroy(){const t=this._gl,e=this._canvas;t&&(t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),e.removeEventListener(C,this._onContextLost),e.removeEventListener(O,this._onContextRestore)}forceLoseContext(){const t=this._extensions.loseContext;t&&t.loseContext()}forceRestoreContext(){const t=this._extensions.loseContext;t&&t.restoreContext()}clear(){const t=this._gl;t.clear(t.COLOR_BUFFER_BIT)}resize(){const t=this._gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)}viewport(t,e,s,i){this._gl.viewport(t,e,s,i)}createVAO(t,e){const s=this._createNativeVAO(),i=new le(s,t,{indicies:this._createBuffer(),position:this._createBuffer(),uv:this._createBuffer()});return s&&(this._bindNativeVAO(s),this._supplyGeometryData(i,e),this._bindNativeVAO(null),this._unbindBuffers()),i}draw(t,e){const s=this._gl;t.obj?this._bindNativeVAO(t.obj):this._supplyGeometryData(t,e),s.drawElements(s.TRIANGLES,t.count,s.UNSIGNED_SHORT,0),t.obj?this._bindNativeVAO(null):this._unbindBuffers()}releaseVAO(t){t.obj&&this._deleteNativeVAO(t.obj),this._deleteBuffer(t.buffers.indicies),this._deleteBuffer(t.buffers.position),this._deleteBuffer(t.buffers.uv)}getUniformLocations(t,e){const s=this._gl,i=Object.keys(e).reduce(((e,i)=>(e[i]=s.getUniformLocation(t,i),e)),{});return Object.assign(Object.assign({},this._getCommonUniformLocations(t)),i)}updateCommonUniforms(t,s,i){const n=this._gl,o=i.uniformLocations,r=t.matrix,a=e.mat4.create();e.mat4.multiply(a,s.viewMatrix,r),n.uniformMatrix4fv(o.uMVMatrix,!1,a),n.uniformMatrix4fv(o.uPMatrix,!1,s.projectionMatrix)}updateVRUniforms(t,e,s,i){const n=this._gl,o=t.uniformLocations;n.uniformMatrix4fv(o.uMVMatrix,!1,e),n.uniformMatrix4fv(o.uPMatrix,!1,s),o.uEye&&n.uniform1f(o.uEye,i)}updateUniforms(t){const e=this._gl,s=t.uniforms,i=t.uniformLocations;for(const t in s){const n=s[t],o=i[t];n&&(n.needsUpdate&&n.update(e,o,this._isWebGL2))}}releaseShaderResources(t){const e=this._gl,s=t.uniforms;for(const t in s){const i=s[t];i&&(i.needsUpdate&&i.destroy(e))}e.deleteProgram(t.program)}useProgram(t){this._gl.useProgram(t.program)}createProgram(t,e){const s=this._gl,i=s.createProgram(),n=this._compileShader(s.VERTEX_SHADER,t),o=this._compileShader(s.FRAGMENT_SHADER,e);if(s.attachShader(i,n),s.attachShader(i,o),s.bindAttribLocation(i,0,"position"),s.bindAttribLocation(i,1,"uv"),s.linkProgram(i),this._debug&&!s.getProgramParameter(i,s.LINK_STATUS)){let t=null;throw s.getShaderParameter(n,s.COMPILE_STATUS)?s.getShaderParameter(o,s.COMPILE_STATUS)||(t=s.getShaderInfoLog(o)):t=s.getShaderInfoLog(n),new a(c.FAILED_LINKING_PROGRAM(s.getProgramInfoLog(i),t),l.FAILED_LINKING_PROGRAM)}return s.deleteShader(n),s.deleteShader(o),i}createWebGLTexture(t){const e=this._gl,s=e.createTexture();if(e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapT),!t.isVideo()&&this._isWebGL2){const s=e;s.texStorage2D(s.TEXTURE_2D,1,s.RGBA8,t.width,t.height)}return s}createWebGLCubeTexture(t,e){const s=this._gl,i=s.createTexture();if(s.bindTexture(s.TEXTURE_CUBE_MAP,i),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,t.wrapS),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,t.wrapT),this._isWebGL2){const t=s;t.texStorage2D(t.TEXTURE_CUBE_MAP,1,t.RGBA8,e,e)}return i}makeXRCompatible(){return r(this,void 0,void 0,(function*(){const t=this._gl,e=t.getContextAttributes();e&&!0!==e.xrCompatible&&(yield t.makeXRCompatible())}))}bindXRLayer(t){const e=this._gl,s=new XRWebGLLayer(t,e);t.updateRenderState({baseLayer:s})}bindXRFrame(t){const e=this._gl,s=t.session.renderState.baseLayer;e.bindFramebuffer(e.FRAMEBUFFER,s.framebuffer)}useDefaultFrameBuffer(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null)}_createBuffer(){return this._gl.createBuffer()}_deleteBuffer(t){return this._gl.deleteBuffer(t)}_createNativeVAO(){const t=this._gl;if(this._isWebGL2)return t.createVertexArray();{const t=this._extensions.vao;return(null==t?void 0:t.createVertexArrayOES())||null}}_bindNativeVAO(t){const e=this._gl;if(this._isWebGL2)e.bindVertexArray(t);else{const e=this._extensions.vao;null==e||e.bindVertexArrayOES(t)}}_deleteNativeVAO(t){const e=this._gl;if(this._isWebGL2)e.deleteVertexArray(t);else{const e=this._extensions.vao;null==e||e.deleteVertexArrayOES(t)}}_supplyGeometryData(t,e){const s=t.geometry;this._supplyIndiciesData(s.indicies,t.buffers.indicies),this._supplyAttributeData(s.vertices,e.program,"position",t.buffers.position),this._supplyAttributeData(s.uvs,e.program,"uv",t.buffers.uv)}_unbindBuffers(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null)}_supplyIndiciesData(t,e){const s=this._gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),s.bufferData(s.ELEMENT_ARRAY_BUFFER,t.data,s.STATIC_DRAW)}_supplyAttributeData(t,e,s,i){const n=this._gl,o=n.getAttribLocation(e,s);o<0||(n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,t.data,n.STATIC_DRAW),n.vertexAttribPointer(o,t.itemSize,n.FLOAT,!1,0,0),n.enableVertexAttribArray(o))}_compileShader(t,e){const s=this._gl,i=s.createShader(t);return s.shaderSource(i,e),s.compileShader(i),i}_getCommonUniformLocations(t){const e=this._gl;return{uMVMatrix:e.getUniformLocation(t,"uMVMatrix"),uPMatrix:e.getUniformLocation(t,"uPMatrix")}}_getContext(t){const e=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];let s=null,i=!1;const n={preserveDrawingBuffer:!1,antialias:!1},o=t=>t.statusMessage;t.addEventListener(L,o);for(const o of e){try{s=t.getContext(o,n),i="webgl2"===o}catch(t){}if(s)break}if(t.removeEventListener(L,o),!s)throw new a(c.WEBGL_NOT_SUPPORTED,l.WEBGL_NOT_SUPPORTED);return{gl:s,isWebGL2:i}}}class ue{get canvas(){return this._canvas}get width(){return this._elementSize.x}get height(){return this._elementSize.y}get pixelRatio(){return this._pixelRatio}get aspect(){return this._elementSize.x/this._elementSize.y}constructor(t,e){this._canvas=t,this._elementSize={x:0,y:0},this._pixelRatio=1,this.ctx=new ce(t,e)}destroy(){const t=this._canvas;this.ctx.destroy(),t.width=1,t.height=1}resize(){const t=this._canvas,e=this._elementSize,s=window.devicePixelRatio;e.x=t.clientWidth,e.y=t.clientHeight,t.width=e.x*s,t.height=e.y*s,this._pixelRatio=s,this.ctx.resize()}render(t,e){const s=this.ctx;s.lost||(s.clear(),s.useProgram(t.program),s.updateCommonUniforms(t,e,t.program),t.update({camera:e}),s.updateUniforms(t.program),s.draw(t.vao,t.program))}renderVR(t,s,i){const n=this.ctx,o=s.getEyeParams(i);o&&t&&(n.bindXRFrame(i),n.useProgram(t.program),n.updateUniforms(t.program),o.forEach(((s,i)=>{const o=s.viewport,r=e.mat4.multiply(e.mat4.create(),s.vMatrix,t.matrix);n.viewport(o.x,o.y,o.width,o.height),n.updateVRUniforms(t.program,r,s.pMatrix,i),n.draw(t.vao,t.program)})))}}class _e extends n.default{get rootEl(){return this._rootEl}get renderer(){return this._renderer}get camera(){return this._camera}get control(){return this._control}get vr(){return this._vr}get hotspot(){return this._hotspot}get plugins(){return this._plugins}get projection(){return this._projection}set projection(t){this._initialized&&t?this.load(t):this._projection=t}get mesh(){return this._mesh}get initialized(){return this._initialized}get autoplay(){return this._autoplay}get autoInit(){return this._autoInit}get autoResize(){return this._autoResize}get canvasSelector(){return this._canvasSelector}get useResizeObserver(){return this._useResizeObserver}get tabIndex(){return this._tabIndex}set tabIndex(t){const e=this._renderer.canvas;this._tabIndex=t,null!=t?e.tabIndex=t:e.removeAttribute("tabindex")}get maxDeltaTime(){return this._animator.maxDeltaTime}set maxDeltaTime(t){this._animator.maxDeltaTime=t}get debug(){return this._debug}set debug(t){this._debug=t}get initialYaw(){return this._camera.initialYaw}set initialYaw(t){this._camera.initialYaw=t}get initialPitch(){return this._camera.initialPitch}set initialPitch(t){this._camera.initialPitch=t}get initialZoom(){return this._camera.initialZoom}set initialZoom(t){this._camera.initialZoom=t}get yawRange(){return this._camera.yawRange}set yawRange(t){this._camera.yawRange=t,this._projection&&this._projection.updateCamera(this._camera)}get pitchRange(){return this._camera.pitchRange}set pitchRange(t){this._camera.pitchRange=t,this._projection&&this._projection.updateCamera(this._camera)}get zoomRange(){return this._camera.zoomRange}set zoomRange(t){this._camera.zoomRange=t,this._projection&&this._projection.updateCamera(this._camera)}get fov(){return this._camera.fov}set fov(t){const e=this._camera,s=this._control;e.fov=t,e.updateMatrix(),s.sync()}get rotate(){return this._control.rotate}get zoom(){return this._control.zoom}get gyro(){return this._control.gyro}get useGrabCursor(){return this._control.useGrabCursor}set useGrabCursor(t){this._control.useGrabCursor=t}get disableContextMenu(){return this._control.disableContextMenu}set disableContextMenu(t){this._control.disableContextMenu=t}get scrollable(){return this._control.scrollable}set scrollable(t){this._control.scrollable=t}get wheelScrollable(){return this._control.wheelScrollable}set wheelScrollable(t){this._control.wheelScrollable=t}constructor(t,{projection:e=null,initialYaw:s=0,initialPitch:i=0,initialZoom:n=1,yawRange:o=null,pitchRange:r=null,zoomRange:h=null,fov:u=90,useGrabCursor:_=!0,disableContextMenu:d=!1,rotate:m=!0,zoom:p=!0,gyro:g=!1,scrollable:v=!0,wheelScrollable:E=!1,autoplay:T=!1,hotspot:b={},autoInit:f=!0,autoResize:R=!0,canvasSelector:w="canvas",useResizeObserver:y=!0,on:L={},plugins:C=[],maxDeltaTime:O=1/30,tabIndex:x=0,debug:I=!1}={}){super(),this.renderFrame=t=>{const e=this._camera,s=this._renderer,i=this._control,n=this._hotspot,o=this._autoplay,r=this._mesh;r&&(this._emit(tt.BEFORE_RENDER),o.playing&&(o.update(t),i.sync()),e.animation?e.animation.update(t):i.update(t),s.render(r,e),n.render(e),e.changed&&this._emit(tt.VIEW_CHANGE,{yaw:e.yaw,pitch:e.pitch,zoom:e.zoom,quaternion:[e.quaternion[0],e.quaternion[1],e.quaternion[2],e.quaternion[3]]}),e.onFrameRender(),this._emit(tt.RENDER))},this._renderFrameOnDemand=t=>{const e=this._camera,s=this._control,i=this._autoplay,n=this._mesh,o=null==n?void 0:n.getTexture();this._initialized&&o&&(e.animation||s.animating||i.playing||o.isVideo())&&this.renderFrame(t)},this._renderVRFrame=(t,e)=>{const s=this._vr,i=this._mesh,n=this._renderer;i&&(this._emit(tt.BEFORE_RENDER),n.renderVR(i,s,e),this._emit(tt.RENDER))},this._rootEl=((t,e)=>{const s=Ct(t,e);if(!s)throw yt(t)?new a(c.ELEMENT_NOT_FOUND(t),l.ELEMENT_NOT_FOUND):new a(c.WRONG_TYPE(t,["HTMLElement","string"]),l.WRONG_TYPE);return s})(t),this._plugins=C,this._initialized=!1,this._autoInit=f,this._autoResize=R,this._canvasSelector=w,this._useResizeObserver=y,this._tabIndex=x,this._debug=I;const A=((t,e)=>{const s=t.querySelector(e);if(!s)throw new a(c.CANVAS_NOT_FOUND,l.CANVAS_NOT_FOUND);return s})(this._rootEl,w);this._renderer=new ue(A,I),this._camera=new Vt({initialYaw:s,initialPitch:i,initialZoom:n,fov:u,yawRange:o,pitchRange:r,zoomRange:h}),this._control=new $t(A,this._camera,{useGrabCursor:_,scrollable:v,wheelScrollable:E,disableContextMenu:d,rotate:m,zoom:p,gyro:g}),this._animator=new ie(O),this._autoplay=new oe(this,A,T),this._projection=e,this._mesh=null,this._autoResizer=new ne(y,(()=>this.resize())),this._vr=new re(this._renderer.ctx),this._hotspot=new he(this._rootEl,this._renderer,b),this._addEventHandlers(L),e&&f&&this.init()}destroy(){this._camera.destroy(),this._animator.stop(),this._renderer.destroy(),this._control.destroy(),this._autoResizer.disable(),this._mesh&&(this._mesh.destroy(this._renderer.ctx),this._mesh=null),this._plugins.forEach((t=>t.destroy(this))),this._initialized=!1}init(){return r(this,void 0,void 0,(function*(){if(!this._projection)throw new a(c.PROVIDE_PROJECTION_FIRST,l.PROVIDE_PROJECTION_FIRST);const t=this._renderer,e=this._camera,s=this._control,i=this._animator,n=this._hotspot,o=this._projection,r=t.canvas;this._bindComponentEvents(),t.ctx.init(),this._resizeComponents(),e.updateMatrix(),this._autoResize&&this._autoResizer.enable(r),this._autoplay.enableBlocked||this._autoplay.enable(),this._plugins.forEach((t=>{t.init(this)}));const h=yield this._loadTexture(o);this._applyProjection(o,h),n.refresh(),i.start(this._renderFrameOnDemand),yield s.enable(),null==this._tabIndex||r.hasAttribute("tabIndex")||(r.tabIndex=this._tabIndex),this._initialized=!0,this.renderFrame(0),this._emit(tt.READY)}))}load(t){return r(this,void 0,void 0,(function*(){if(!t)return!1;if(this._initialized){const e=yield this._loadTexture(t);this._applyProjection(t,e),this.renderFrame(0)}else this._projection=t,this.init();return!0}))}resize(){if(!this._initialized)return;this._resizeComponents(),this.renderFrame(0);const{width:t,height:e}=this._renderer;this._emit(tt.RESIZE,{width:t,height:e})}addPlugins(...t){this._initialized&&t.forEach((t=>{t.init(this)})),this._plugins.push(...t)}removePlugins(...t){t.forEach((t=>{const e=this._plugins.indexOf(t);e<0||(t.destroy(this),this._plugins.splice(e,1))}))}_emit(t,...e){const s=e?e[0]:{};this.trigger(t,Object.assign({type:t,target:this},s))}_applyProjection(t,e){const s=this._camera,i=this._control,n=this._renderer,o=this._mesh;o&&o.destroy(n.ctx);const r=t.createMesh(n.ctx,e);t.updateCamera(s),t.updateControl(i),this._mesh=r,this._emit(tt.PROJECTION_CHANGE,{projection:t})}_loadTexture(t){return r(this,void 0,void 0,(function*(){const e=new se,{src:s,video:i}=t;this._emit(tt.LOAD_START,{src:s,video:i});const n=yield e.load(s,i);return this._emit(tt.LOAD,{src:s,video:i}),n}))}_resizeComponents(){const t=this._renderer,e=this._camera,s=this._control;t.resize(),e.resize(t.width,t.height),s.resize(t.width,t.height)}_addEventHandlers(t){Object.keys(t).forEach((e=>{this.on(e,t[e])}))}_bindComponentEvents(){const t=this._rootEl,e=this._control,s=this._animator,i=this._renderer,n=this._vr;[ct,ot,at].forEach((t=>{e.rotate.on(t,(e=>{this._emit(t,e)})),e.zoom.on(t,(e=>{this._emit(t,e)}))})),n.on(tt.VR_START,(e=>{t.classList.add(J.IN_VR),s.changeContext(e.session),s.start(this._renderVRFrame),this._emit(tt.VR_START)})),n.on(tt.VR_END,(()=>{t.classList.remove(J.IN_VR),i.ctx.useDefaultFrameBuffer(),s.changeContext(window),s.start(this._renderFrameOnDemand),this.resize(),this._emit(tt.VR_END)}))}}_e.VERSION="4.0.0-beta.7";class de extends n.default{constructor(){super(),this.matrix=e.mat4.create(),this.rotation=e.quat.create(),this.position=e.vec3.fromValues(0,0,0),this.scale=e.vec3.fromValues(1,1,1)}updateMatrix(){e.mat4.fromRotationTranslationScale(this.matrix,this.rotation,this.position,this.scale)}update(t){this.trigger(nt,t)}}class me{constructor({className:t={}}={}){this._startLoading=({target:t})=>{t.rootEl.appendChild(this._container),t.initialized?t.once(tt.LOAD,this._detachElements):t.once(tt.READY,this._detachElements)},this._detachElements=({target:t})=>{const e=this._container;e&&e.parentElement===t.rootEl&&t.rootEl.removeChild(e)},this.className=t,this._container=this._createElements()}init(t){t.on(tt.LOAD_START,this._startLoading)}destroy(t){t.off(tt.LOAD_START,this._startLoading),this._detachElements({target:t})}_createElements(){const t=Object.assign(Object.assign({},this.className),me.DEFAULT_CLASS),e=Lt(t.CONTAINER),s=Lt(t.RING);return e.appendChild(s),e}}me.DEFAULT_CLASS={CONTAINER:"view360-spinner",RING:"view360-spinner-ring"};class pe{constructor(t){this.position=t.position,this.order=t.order}}const ge={CONTROLS_ROOT:"view360-controls",CONTROLS_BG:"view360-controls-background",CONTROLS_MAIN:"view360-controls-main",CONTROLS_TOP:"view360-controls-top",CONTROLS_BOTTOM:"view360-controls-bottom",CONTROLS_MID:"view360-controls-mid",CONTROLS_LEFT:"view360-controls-left",CONTROLS_RIGHT:"view360-controls-right",CONTROLS_FLOAT_LEFT:"view360-controls-float-left",CONTROLS_FLOAT_RIGHT:"view360-controls-float-right",CONTROLS_BUTTON:"view360-controls-button",PROGRESS_ROOT:"view360-controls-progress",VOLUME_ROOT:"view360-controls-volume",RANGE_ROOT:"view360-range",RANGE_TRACK:"view360-range-track",RANGE_THUMB:"view360-range-thumb",RANGE_FILLER:"view360-range-filler",PLAY_BUTTON:"view360-controls-play",PAUSE_BUTTON:"view360-controls-pause",UNMUTED_BUTTON:"view360-controls-unmuted",MUTED_BUTTON:"view360-controls-muted",FULLSCREEN_BUTTON:"view360-controls-fullscreen",FULLSCREEN_EXIT_BUTTON:"view360-controls-fullscreen-exit",VR_BUTTON:"view360-controls-vr",GYRO_ENABLED:"view360-controls-gyro-enabled",GYRO_DISABLED:"view360-controls-gyro-disabled",VIDEO_TIME_DISPLAY:"view360-controls-time",PIEVIEW_ROOT:"view360-controls-pie",FIXED:"view360-controls-fixed",UNAVAILABLE:"view360-controls-unavailable",HIDDEN:"view360-controls-hidden"},ve={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",MAIN_TOP:"main-top",MAIN_BOTTOM:"main-bottom",MAIN_LEFT:"main-left",MAIN_RIGHT:"main-right"};class Ee extends n.default{constructor(){super(),this._onHold=({srcEvent:t,isTouch:e})=>{var s;const i=this._bbox;if(!i)return;const n=e?t.touches[0].pageX:t.pageX,o=i.x+(null!==(s=window.scrollX)&&void 0!==s?s:window.pageXOffset),r=Ot(n,o,o+i.width),a=(r-o)/i.width;this._motion.reset(r),this.thumbEl.classList.add(this._fixedClass),this.trigger(ot,a)},this._onChange=({delta:t})=>{var e;const s=this._motion,i=this._bbox;if(!i)return;s.setNewEndByDelta(t.x),s.update(1);const n=i.x+(null!==(e=window.scrollX)&&void 0!==e?e:window.pageXOffset),o=(Ot(s.val,n,n+i.width)-n)/i.width;this.trigger(rt,o)},this._onRelease=()=>{this._bbox&&(this.thumbEl.classList.remove(this._fixedClass),this.trigger(at))};const t=document.createElement(V),e=document.createElement(V),s=document.createElement(V),i=document.createElement(V);t.draggable=!1,e.appendChild(i),e.appendChild(s),t.appendChild(e),this.rootEl=t,this.trackEl=e,this.thumbEl=s,this.fillerEl=i,this._mouseInput=new Gt,this._touchInput=new kt,this._motion=new Ft({duration:1,range:pt,easing:t=>t}),this._bbox={x:0,y:0,width:0,height:0,left:0,right:0,bottom:0,top:0},this._fixedClass=ge.FIXED}init(t){const e=this._mouseInput,s=this._touchInput;this.rootEl.classList.add(t.RANGE_ROOT),this.trackEl.classList.add(t.RANGE_TRACK),this.thumbEl.classList.add(t.RANGE_THUMB),this.fillerEl.classList.add(t.RANGE_FILLER),this._fixedClass=t.FIXED,e.on(ot,this._onHold),s.on(ot,this._onHold),e.on(at,this._onRelease),s.on(at,this._onRelease),e.on(rt,this._onChange),s.on(rt,this._onChange),e.enable(this.rootEl),s.enable(this.rootEl),this.resize()}destroy(){const t=this._mouseInput,e=this._touchInput;this.rootEl.className="",this.trackEl.className="",this.thumbEl.className="",this.fillerEl.className="",t.off(),e.off(),t.disable(),e.disable()}resize(){this._bbox=this.trackEl.getBoundingClientRect()}updateStyle(t){const e=this._bbox.width,s=Ot(t,0,1);this.fillerEl.style.width=100*s+"%",this.thumbEl.style.transform=`translateX(${s*e}px)`}}class Te extends pe{get element(){return this._rangeControl.rootEl}constructor({position:t=ve.MAIN_TOP,order:e=9999}={}){super({position:t,order:e}),this._onResize=()=>{this._rangeControl.resize()},this._onTimeUpdate=()=>{const t=this._video;t&&(this._currentTime=t.source.currentTime,this._rangeControl.updateStyle(this._currentTime/this._duration))},this._onDurationChange=()=>{const t=this._video;t&&(this._duration=t.source.duration,this._rangeControl.updateStyle(this._currentTime/this._duration))},this._onHold=t=>{const e=this._video,s=this._controlBar;if(!e||!s)return;const i=e.isPaused();e.source.pause();const n=e.source.duration*t;e.source.currentTime=n,e.source.dispatchEvent(new CustomEvent(Tt,{detail:{time:n}})),s.rootEl.classList.add(s.className.FIXED),this._wasPaused=!this._playPromise&&i},this._onControl=t=>{const e=this._video;if(!e)return;const s=e.source.duration*t;e.source.currentTime=s,e.source.dispatchEvent(new CustomEvent(Tt,{detail:{time:s}}))},this._onRelease=()=>{const t=this._video,e=this._controlBar;t&&e&&(this._wasPaused||this._playPromise||(this._playPromise=t.source.play().catch((()=>{})),this._playPromise.then((()=>{this._playPromise=null})),e.rootEl.classList.remove(e.className.FIXED))),this._wasPaused=!1},this.position=t,this.order=e,this._controlBar=null,this._rangeControl=new Ee,this._video=null,this._wasPaused=!1,this._currentTime=0,this._duration=0,this._playPromise=null}init(t,e){var s;const i=null===(s=t.mesh)||void 0===s?void 0:s.getTexture(),n=this.element,o=this._rangeControl,r=e.className.UNAVAILABLE;i&&i.isVideo()?(n.classList.remove(r),n.classList.add(e.className.PROGRESS_ROOT),t.on(tt.RESIZE,this._onResize),i.source.addEventListener(D,this._onTimeUpdate),i.source.addEventListener(U,this._onDurationChange),i.source.addEventListener(Tt,this._onTimeUpdate),o.init(e.className),o.on(ot,this._onHold),o.on(rt,this._onControl),o.on(at,this._onRelease),this._video=i,this._currentTime=i.source.currentTime,this._duration=i.source.duration,this._controlBar=e,o.updateStyle(this._currentTime/this._duration)):n.classList.add(r)}destroy(t){const e=this._video;t.off(tt.RESIZE,this._onResize),e&&(e.source.removeEventListener(D,this._onTimeUpdate),e.source.removeEventListener(U,this._onDurationChange),e.source.removeEventListener(Tt,this._onTimeUpdate)),this._rangeControl.destroy(),this._video=null,this._playPromise=null}}class be extends pe{constructor({position:t=ve.MAIN_LEFT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{const t=this._video;t&&(this._paused?t.source.play():t.source.pause())},this._onPlay=()=>{if(!this._controlBar)return;const t=this.element,e=this._controlBar.className;t.classList.add(e.PAUSE_BUTTON),t.classList.remove(e.PLAY_BUTTON),t.title="Pause Video",this._paused=!1},this._onPause=()=>{if(!this._controlBar)return;const t=this.element,e=this._controlBar.className;t.classList.add(e.PLAY_BUTTON),t.classList.remove(e.PAUSE_BUTTON),t.title="Play Video",this._paused=!0},this.element=document.createElement(G),this._video=null,this._paused=!0,this._controlBar=null}init(t,e){var s;const i=this.element,n=null===(s=t.mesh)||void 0===s?void 0:s.getTexture(),o=e.className,r=o.UNAVAILABLE;if(!n||!n.isVideo())return void i.classList.add(r);i.classList.add(o.CONTROLS_BUTTON),i.classList.remove(r);const a=n.isPaused();this._video=n,this._paused=a,this._controlBar=e,a?this._onPause():this._onPlay(),i.addEventListener(y,this._onClick),n.source.addEventListener(S,this._onPlay),n.source.addEventListener(P,this._onPause)}destroy(){const t=this._video,e=this.element;t&&(e.className="",e.removeEventListener(y,this._onClick),t.source.removeEventListener(S,this._onPlay),t.source.removeEventListener(P,this._onPause),this._video=null,this._paused=!0,this._controlBar=null)}}class fe extends pe{get element(){return this._rootEl}constructor({position:t=ve.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onResize=()=>{this._rangeControl.resize(),this._updateDisplay()},this._onClick=()=>{const t=this._video;t&&!this._rootEl.disabled&&(t.source.muted=!t.source.muted)},this._onVolumeChange=()=>{const t=this._buttonEl,e=this._video,s=this._controlBar;if(!e||!s)return;const i=s.className;e.source.muted||0===e.source.volume?(t.classList.add(i.MUTED_BUTTON),t.classList.remove(i.UNMUTED_BUTTON)):(t.classList.add(i.UNMUTED_BUTTON),t.classList.remove(i.MUTED_BUTTON)),this._updateDisplay()},this._onHold=t=>{const e=this._video,s=this._controlBar;if(!e||!s)return;const i=s.className;e.source.volume=t,this._rootEl.classList.add(i.FIXED),s.containerEl.classList.add(i.FIXED),this._updateDisplay()},this._onChange=t=>{const e=this._video;e&&(e.source.volume=t,e.source.muted=!(t>0),this._updateDisplay())},this._onRelease=()=>{const t=this._controlBar;if(!t)return;const e=t.className;this._rootEl.classList.remove(e.FIXED),t.containerEl.classList.remove(e.FIXED)},this._updateDisplay=()=>{const t=this._video,e=this._rootEl;if(!t)return;if(!t.hasAudio())return void(e.disabled=!0);e.disabled=!1;const s=t.source.muted?0:t.source.volume;this._rangeControl.updateStyle(s)},this._controlBar=null,this._rangeControl=new Ee,this._createElements(),this._video=null}init(t,e){var s;const i=null===(s=t.mesh)||void 0===s?void 0:s.getTexture(),n=this._rootEl,o=this._buttonEl,r=this._rangeControl,a=e.className,h=a.UNAVAILABLE;i&&i.isVideo()?(n.classList.remove(h),n.classList.add(a.CONTROLS_BUTTON),n.classList.add(a.VOLUME_ROOT),o.classList.add(a.CONTROLS_BUTTON),i.source.muted?o.classList.add(a.MUTED_BUTTON):o.classList.add(a.UNMUTED_BUTTON),t.on(tt.RESIZE,this._onResize),n.addEventListener(F,this._onResize),o.addEventListener(y,this._onClick),i.source.addEventListener(M,this._onVolumeChange),i.source.addEventListener(N,this._updateDisplay),i.source.addEventListener(B,this._updateDisplay),r.init(a),r.on(ot,this._onHold),r.on(rt,this._onChange),r.on(at,this._onRelease),this._controlBar=e,this._video=i,this._updateDisplay()):n.classList.add(h)}destroy(t){const e=this._video,s=this._buttonEl,i=this._rootEl;i.className="",s.className="",t.off(tt.RESIZE,this._onResize),i.removeEventListener(F,this._onResize),s.removeEventListener(y,this._onClick),e&&(e.source.removeEventListener(M,this._onVolumeChange),e.source.removeEventListener(N,this._updateDisplay),e.source.removeEventListener(B,this._updateDisplay)),this._controlBar=null,this._rangeControl.destroy(),this._video=null}_createElements(){const t=document.createElement(G),e=document.createElement(V);t.appendChild(this._rangeControl.rootEl),t.appendChild(e),t.title="Toggle Mute",this._rootEl=t,this._buttonEl=e}}class Re extends pe{constructor({position:t=ve.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{const t=this._targetEl;t&&(Mt()?this._exitFullscreen():this._requestFullscreen(t))},this._onFullscreenChange=()=>{const t=this.element,e=this._controlBar;if(!e)return;const s=e.className;Mt()?(t.classList.add(s.FULLSCREEN_EXIT_BUTTON),t.classList.remove(s.FULLSCREEN_BUTTON)):(t.classList.add(s.FULLSCREEN_BUTTON),t.classList.remove(s.FULLSCREEN_EXIT_BUTTON))},this.element=document.createElement(G),this.element.title="Toggle Fullscreen",this._controlBar=null,this._targetEl=null}init(t,e){const s=this.element,i=e.className;this._fullscreenAvailable()?(s.classList.add(i.CONTROLS_BUTTON),s.classList.remove(i.UNAVAILABLE),s.addEventListener(y,this._onClick),this._addFullscreenHandlers(),Mt()?s.classList.add(i.FULLSCREEN_EXIT_BUTTON):s.classList.add(i.FULLSCREEN_BUTTON),this._controlBar=e,this._targetEl=t.rootEl):s.classList.add(i.UNAVAILABLE)}destroy(){const t=this.element;t.className="",t.removeEventListener(y,this._onClick),this._removeFullscreenHandlers(),this._controlBar=null,this._targetEl=null}_fullscreenAvailable(){return K.some((t=>!!document[t]))}_requestFullscreen(t){for(const e of K){const s=t[e];if(s)return void s.call(t)}}_exitFullscreen(){for(const t of $){const e=document[t];if(e)return void e.call(document)}}_addFullscreenHandlers(){Q.forEach((t=>{document.addEventListener(t,this._onFullscreenChange)}))}_removeFullscreenHandlers(){Q.forEach((t=>{document.removeEventListener(t,this._onFullscreenChange)}))}}class we extends pe{constructor({position:t=ve.MAIN_LEFT,order:e=9999}={}){super({position:t,order:e}),this._onTimeUpdate=()=>{const t=this._video;t&&(this._currentTime=t.source.currentTime,this._updateDisplay())},this._onDurationChange=()=>{const t=this._video;t&&(this._duration=t.source.duration,this._updateDisplay())},this._onCustomTimeChange=t=>{this._currentTime=t.detail.time,this._updateDisplay()},this.element=document.createElement(V),this._video=null,this._currentTime=0,this._duration=0}init(t,e){var s;const i=null===(s=t.mesh)||void 0===s?void 0:s.getTexture(),n=this.element,o=e.className;i&&i.isVideo()?(n.classList.add(o.VIDEO_TIME_DISPLAY),n.classList.remove(o.UNAVAILABLE),i.source.addEventListener(D,this._onTimeUpdate),i.source.addEventListener(U,this._onDurationChange),i.source.addEventListener(Tt,this._onCustomTimeChange),this._video=i,this._currentTime=i.source.currentTime,this._duration=i.source.duration,this._updateDisplay()):n.classList.add(o.UNAVAILABLE)}destroy(){const t=this._video;t&&(this.element.className="",t.source.removeEventListener(D,this._onTimeUpdate),t.source.removeEventListener(U,this._onDurationChange),t.source.removeEventListener(Tt,this._onCustomTimeChange),this._video=null)}_updateDisplay(){const t=this._currentTime,e=Math.floor(t/60),s=Math.floor(t-60*e),i=s<10?`0${s}`:s,n=this._duration,o=Math.floor(n/60),r=Math.floor(n-60*o),a=r<10?`0${r}`:r;this.element.innerText=`${e}:${i} / ${o}:${a}`}}class ye extends pe{constructor({resetCamera:t=!0,position:e=ve.TOP_RIGHT,order:s=9999}={}){super({position:e,order:s}),this._onClick=()=>{const t=this._viewer,e=this.resetCamera;if(!t||!e)return;const{yaw:s=t.initialYaw,pitch:i=t.initialPitch,zoom:n=t.initialZoom,duration:o=500}=St(e);t.camera.animateTo({yaw:s,pitch:i,zoom:n,duration:o})},this._updatePie=({target:t})=>{const e=this._piePathEl,s=this._rangeCircleEl,i=t.camera,n=i.getHorizontalFov(),o=i.getYawRange(i.zoom),r=.5*n,a=24*Math.PI,h=a*n/360,l=a*(i.yaw+r+90)/360;if(e.setAttribute("stroke-dasharray",`${h} ${a-h}`),e.setAttribute("stroke-dashoffset",`${l}`),isFinite(o.min)&&isFinite(o.max)){const t=45*Math.PI,e=(It(o.min,-180,180)-r)/360,i=(It(o.max,-180,180)+r)/360,n=t*Math.abs(i-e),a=-t*(e-.25);s.setAttribute("stroke-dasharray",`${n} ${t-n}`),s.setAttribute("stroke-dashoffset",`${a}`)}else s.setAttribute("stroke-dasharray",""),s.setAttribute("stroke-dashoffset","")},this.element=document.createElement(V),this.element.title="Reset view",this.resetCamera=t,this._createPieElements(),this._viewer=null}init(t,e){const s=this.element;t.initialized?this._updatePie({target:t}):t.once(tt.READY,this._updatePie);const i=e.className.PIEVIEW_ROOT;s.classList.add(i),this.resetCamera&&s.addEventListener(y,this._onClick),t.on(tt.VIEW_CHANGE,this._updatePie),this._viewer=t}destroy(t){const e=this.element;e.removeEventListener(y,this._onClick),e.className="",t.off(tt.READY,this._updatePie),t.off(tt.VIEW_CHANGE,this._updatePie),this._viewer=null}_createPieElements(){const t=this.element,e=document.createElementNS(bt,"svg");e.setAttribute("viewBox","0 0 48 48"),e.setAttribute("width","100%"),e.setAttribute("height","100%");const s=document.createElementNS(bt,"circle");s.setAttribute("stroke","currentColor"),s.setAttribute("fill","transparent"),s.setAttribute("cx","24"),s.setAttribute("cy","24"),s.setAttribute("r","12"),s.setAttribute("stroke-width","24"),e.appendChild(s);const i=document.createElementNS(bt,"circle");i.setAttribute("stroke","currentColor"),i.setAttribute("fill","transparent"),i.setAttribute("cx","24"),i.setAttribute("cy","24"),i.setAttribute("r","22.5"),i.setAttribute("stroke-width","3"),e.appendChild(i),t.appendChild(e),this._piePathEl=s,this._rangeCircleEl=i}}class Le extends pe{constructor({position:t=ve.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{const t=this._viewer;t&&t.vr.enter()},this.element=document.createElement(G),this.element.title="Enter VR",this._viewer=null}init(t,e){const s=this.element,i=e.className;s.classList.add(i.UNAVAILABLE),s.classList.add(i.VR_BUTTON),s.classList.add(i.CONTROLS_BUTTON),t.vr.isAvailable().then((t=>{t&&s.classList.remove(i.UNAVAILABLE)})),s.addEventListener(y,this._onClick),this._viewer=t}destroy(){const t=this.element;t.className="",t.removeEventListener(y,this._onClick),this._viewer=null}}class Ce extends pe{constructor({position:t=ve.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{const t=this._viewer,e=this._controlBar;if(!t||!e)return;const s=t.control.gyro;s.enabled?s.disable():Zt.requestSensorPermission().then((t=>{t?s.enable():this.element.classList.add(e.className.UNAVAILABLE)}))},this._updateStyle=()=>{const t=this.element,e=this._viewer,s=this._controlBar;if(!e||!s)return;const i=e.control.gyro,n=s.className;i.enabled?(t.classList.add(n.GYRO_ENABLED),t.classList.remove(n.GYRO_DISABLED)):(t.classList.add(n.GYRO_DISABLED),t.classList.remove(n.GYRO_ENABLED))},this.element=document.createElement(V),this.element.title="Toggle gyroscope control"}init(t,e){const s=this.element,i=e.className;s.addEventListener(y,this._onClick),s.classList.add(i.CONTROLS_BUTTON),s.classList.add(i.UNAVAILABLE);const n=()=>{s.classList.remove(i.UNAVAILABLE),t.control.gyro.on(ht,this._updateStyle),t.control.gyro.on(lt,this._updateStyle)};Dt()?n():Zt.isAvailable().then((t=>{t&&n()})),this._controlBar=e,this._viewer=t,this._updateStyle()}destroy(t){const e=this.element;t.control.gyro.off(ht,this._updateStyle),t.control.gyro.off(lt,this._updateStyle),e.removeEventListener(y,this._onClick),e.className="",this._controlBar=null,this._viewer=null}}class Oe{get enabled(){return!!this._targetEl}get hidden(){return this._controlBar.containerEl.classList.contains(this._hiddenClass)}get _hiddenClass(){return this._controlBar.className.HIDDEN}get _fixedClass(){return this._controlBar.className.FIXED}constructor(t,{initialDelay:e=3e3,delay:s=0,idleDelay:i=3e3}){this._onMouseEnter=()=>{this._isCursorInside=!0,this.show()},this._onMouseLeave=()=>{this._isCursorInside=!1,this._hideAfterDelay()},this._onMouseMove=()=>{this._isFullscreen&&this.showTemporaliy()},this._onHold=t=>{this._isGrabbing=!0,"mouse"===t.pointerType&&(this._isCursorInside=!0),window.addEventListener(d,this._onRelease),this.show()},this._onRelease=()=>{this._isGrabbing=!1,window.removeEventListener(d,this._onRelease),this._hideAfterDelay()},this._onVideoPlay=()=>{this._targetEl&&this._controlBar.containerEl.classList.remove(this._fixedClass)},this._onVideoPause=()=>{this._targetEl&&this._controlBar.containerEl.classList.add(this._fixedClass)},this._onFullscreenChange=()=>{this._isFullscreen=Mt(),this._isFullscreen&&this._hideAfterDelay()},this._controlBar=t,this._initialDelay=e,this._delay=s,this._idleDelay=i,this._timer=-1,this._isCursorInside=!1,this._isGrabbing=!1,this._isFullscreen=!1,this._video=null,this._targetEl=null}enable(t){var e;this._targetEl&&this.disable(t);const s=this._initialDelay,i=t.rootEl;this._targetEl=t.rootEl,this._timer=window.setTimeout((()=>{this.hide()}),s),i.addEventListener(u,this._onHold),i.addEventListener(b,this._onMouseEnter),i.addEventListener(_,this._onMouseMove),i.addEventListener(f,this._onMouseLeave),this._addFullscreenHandlers();const n=null===(e=t.mesh)||void 0===e?void 0:e.getTexture();n&&n.isVideo()&&(n.isPaused()&&this._controlBar.containerEl.classList.add(this._fixedClass),n.source.addEventListener(S,this._onVideoPlay),n.source.addEventListener(P,this._onVideoPause),this._video=n)}disable(t){if(!this._targetEl)return;const e=this._controlBar,s=t.rootEl,i=this._video;s.removeEventListener(u,this._onHold),window.removeEventListener(d,this._onRelease),s.removeEventListener(b,this._onMouseEnter),s.removeEventListener(_,this._onMouseMove),s.removeEventListener(f,this._onMouseLeave),this._removeFullscreenHandlers(),window.clearTimeout(this._timer),e.containerEl.classList.remove(this._fixedClass),i&&(i.source.removeEventListener(S,this._onVideoPlay),i.source.removeEventListener(P,this._onVideoPause)),this._isCursorInside=!1,this._isGrabbing=!1,this._video=null,this._targetEl=null}show(){this._clearHideTimer(),this._controlBar.containerEl.classList.remove(this._hiddenClass)}showTemporaliy(){this.show(),this._hideAfterDelay(this._idleDelay)}hide(){this._clearHideTimer(),this._controlBar.containerEl.classList.add(this._hiddenClass)}_clearHideTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=-1)}_hideAfterDelay(t=this._delay){this._isGrabbing||!this._isFullscreen&&this._isCursorInside||(this._clearHideTimer(),t<=0?this.hide():this._timer=window.setTimeout((()=>{this.hide()}),t))}_addFullscreenHandlers(){Q.forEach((t=>{document.addEventListener(t,this._onFullscreenChange)}))}_removeFullscreenHandlers(){Q.forEach((t=>{document.removeEventListener(t,this._onFullscreenChange)}))}}class xe{constructor(){this._onKeyDown=t=>{const e=this._video;if(!e)return;t.preventDefault(),t.stopPropagation();const s=e.source,i=null!=t.keyCode?q[t.keyCode]:j[t.key];switch(i){case"LEFT":case"RIGHT":return this._changeVideoTime(s,"RIGHT"===i);case"UP":case"DOWN":return this._changeVideoVolume(s,"UP"===i)}(32===t.keyCode||" "===t.key)&&this._toggleVideo(e)}}enable(t,e){this._video=e,t.addEventListener(R,this._onKeyDown,!0)}disable(t){this._video=null,t.removeEventListener(R,this._onKeyDown,!0)}_changeVideoTime(t,e){const s=e?5:-5;t.currentTime+=s,t.dispatchEvent(new CustomEvent(Tt,{detail:{time:t.currentTime}}))}_changeVideoVolume(t,e){const s=e?.1:-.1;t.muted?t.volume=Ot(s,0,1):t.volume=Ot(t.volume+s,0,1),t.volume>0?t.muted=!1:t.muted=!0}_toggleVideo(t){t.isPaused()?t.source.play():t.source.pause()}}class Ie{get rootEl(){return this._rootEl}get containerEl(){return this._containerEl}get backgroundEl(){return this._bgEl}get items(){return this._items}get customItems(){return this._customItems}constructor({autoHide:t,showBackground:e,clickToPlay:s=!0,keyboardControls:i=!0,progressBar:n=!0,playButton:o=!0,volumeButton:r=!0,fullscreenButton:a=!0,videoTime:h=!0,pieView:l=!0,vrButton:c=!0,gyroButton:u=!0,className:_={},customItems:d=[]}={}){var m;this._onStaticClick=({target:t,isTouch:e})=>{var s;const i=this._autoHider;if(e){if(!i.enabled)return;i.hidden?i.showTemporaliy():i.hide()}else{if(!this.clickToPlay)return;const e=null===(s=t.mesh)||void 0===s?void 0:s.getTexture();if(!e||!e.isVideo())return;e.isPaused()?e.source.play():e.source.pause()}},this._onNewSrcLoad=({target:t})=>{const e=this._items;this._updateBackground(t),this._updateAutoHide(t),this._updateKeyboardHandler(t),Object.keys(e).forEach((s=>{e[s].forEach((e=>{e.destroy(t,this),e.init(t,this)}))}))},this.autoHide=t,this.showBackground=e,this.clickToPlay=s,this.keyboardControls=i,this.progressBar=n,this.playButton=o,this.volumeButton=r,this.fullscreenButton=a,this.videoTime=h,this.pieView=l,this.vrButton=c,this.gyroButton=u,this.className=Object.assign(Object.assign({},Ie.DEFAULT_CLASS),_);const p=null!==(m=_.CONTROLS_ROOT)&&void 0!==m?m:Ie.DEFAULT_CLASS.CONTROLS_ROOT;this._rootEl=Lt(p),this._createPositionWrappers(),this._items=Object.keys(Ie.POSITION).reduce(((t,e)=>(t[Ie.POSITION[e]]=[],t)),{}),this._customItems=d,this._autoHider=new Oe(this,St(t)),this._videoControl=new xe,d.forEach((t=>{this._items[t.position].push(t)}))}init(t){const e=t.rootEl,s=this._rootEl,i=this._createDefaultItems();this._updateBackground(t),this._updateAutoHide(t),this._updateKeyboardHandler(t),e.appendChild(s),this._addItem(t,i),this._addItem(t,this._customItems),t.on(tt.PROJECTION_CHANGE,this._onNewSrcLoad),t.on(tt.STATIC_CLICK,this._onStaticClick)}destroy(t){const e=t.rootEl,s=this._rootEl,i=this._items;s.parentElement===e&&e.removeChild(s),Object.keys(i).forEach((e=>{i[e].forEach((e=>{e.destroy(t,this)})),i[e]=[]})),this._clearItemElements(),this._autoHider.disable(t),this._videoControl.disable(e),t.off(tt.PROJECTION_CHANGE,this._onNewSrcLoad),t.off(tt.STATIC_CLICK,this._onStaticClick)}_addItem(t,e){for(const s of e){const e=this._items[s.position],i=this._wrapperEl[s.position],n=At(e,(t=>t.order>s.order));if(n>=0){const t=e[n].element;e.splice(n,0,s),i.insertBefore(s.element,t)}else e.push(s),i.appendChild(s.element);s.init(t,this)}}_createPositionWrappers(){const t=Object.assign(Object.assign({},Ie.DEFAULT_CLASS),this.className),e=this._rootEl,s=Lt(t.CONTROLS_BG),i=Lt(t.CONTROLS_FLOAT_LEFT),n=Lt(t.CONTROLS_FLOAT_RIGHT);e.appendChild(i),e.appendChild(n);const o=Lt(t.CONTROLS_MAIN),r=Lt(t.CONTROLS_TOP),a=Lt(t.CONTROLS_BOTTOM),h=Lt(t.CONTROLS_MID),l=Lt(t.CONTROLS_LEFT),c=Lt(t.CONTROLS_RIGHT);h.appendChild(l),h.appendChild(c),o.appendChild(s),o.appendChild(r),o.appendChild(h),o.appendChild(a),e.appendChild(o),this._bgEl=s,this._containerEl=o,this._wrapperEl={[Ie.POSITION.MAIN_TOP]:r,[Ie.POSITION.MAIN_LEFT]:l,[Ie.POSITION.MAIN_RIGHT]:c,[Ie.POSITION.MAIN_BOTTOM]:a,[Ie.POSITION.TOP_LEFT]:i,[Ie.POSITION.TOP_RIGHT]:n}}_clearItemElements(){Object.keys(Ie.POSITION).map((t=>Ie.POSITION[t])).map((t=>this._wrapperEl[t])).forEach((t=>{for(;t.firstChild;)t.removeChild(t.firstChild)}))}_updateAutoHide(t){var e;const s=this.autoHide,i=this._autoHider;if(null!=s)s?i.enable(t):i.disable(t);else{const s=null===(e=t.mesh)||void 0===e?void 0:e.getTexture();s&&s.isVideo()?i.enable(t):i.disable(t)}}_updateBackground(t){var e,s;const i=this._bgEl,n=this.showBackground,o=null!==(e=this.className.HIDDEN)&&void 0!==e?e:Ie.DEFAULT_CLASS.HIDDEN;if(null!=n)n?i.classList.remove(o):i.classList.add(o);else{const e=null===(s=t.mesh)||void 0===s?void 0:s.getTexture();e&&e.isVideo()?i.classList.remove(o):i.classList.add(o)}}_updateKeyboardHandler(t){var e;const s=t.rootEl,i=this._videoControl,n=null===(e=t.mesh)||void 0===e?void 0:e.getTexture();this.keyboardControls&&n&&n.isVideo()?i.enable(s,n):i.disable(s)}_createDefaultItems(){const t=[];return this.progressBar&&t.push(new Te(St(this.progressBar))),this.playButton&&t.push(new be(St(this.playButton))),this.volumeButton&&t.push(new fe(St(this.volumeButton))),this.gyroButton&&t.push(new Ce(St(this.gyroButton))),this.vrButton&&t.push(new Le(St(this.vrButton))),this.fullscreenButton&&t.push(new Re(St(this.fullscreenButton))),this.videoTime&&t.push(new we(St(this.videoTime))),this.pieView&&t.push(new ye(St(this.pieView))),t}}Ie.DEFAULT_CLASS=ge,Ie.POSITION=ve;class Ae{constructor({src:t,video:e=!1}){this.src=t,this.video=e}updateCamera(t){t.resetRange()}updateControl(t){t.ignoreZoomScale=!1}}class Se{constructor(){this.needsUpdate=!0}destroy(t){}}class Pe extends Se{constructor(t,e,s){super(),this.texture=e,this._webglTexture=t.createWebGLCubeTexture(e,e.width),this._cubemapOrder=s}destroy(t){this.texture.destroy(),t.deleteTexture(this._webglTexture)}update(t,e,s){const i=this.texture;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i.flipY),t.uniform1i(e,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this._webglTexture);Nt(i.sources,this._cubemapOrder).forEach(((e,i)=>{s?t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)})),i.isVideo()||(this.needsUpdate=!1)}}class Ne{get size(){return this._size}constructor(t,e){var s;this.texture=t,this._renderingOrder=Nt(!(s=6)||s<=0?[]:Array.apply(0,Array(s)).map(((t,e)=>e)),e);const i=document.createElement("canvas");this._calcRenderingSize(),i.width=this._size,i.height=this._size,this._canvas=i,this._ctx=i.getContext("2d")}destroy(){const t=this._canvas;t.width=1,t.height=1,this._canvas=null}draw(t,e){const s=this._size,i=this.texture;let n=0;for(let o=0;o<this._row;o++)for(let r=0;r<this._column;r++){const a=s*r,h=s*o,l=this._renderingOrder[n];this._ctx.drawImage(i.source,a,h,s,s,0,0,s,s),e?t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this._canvas):t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._canvas),n++}}_calcRenderingSize(){const{width:t,height:e}=this.texture,s=t/e;s===1/6?(this._size=t,this._row=6,this._column=1):6===s?(this._size=e,this._row=1,this._column=6):s===2/3?(this._size=.5*t,this._row=3,this._column=2):(this._size=t/3,this._row=2,this._column=3)}}class Me extends Se{get texture(){return this._painter.texture}constructor(t,e,s){super(),this._painter=new Ne(e,s),this._webglTexture=t.createWebGLCubeTexture(e,this._painter.size)}destroy(t){t.deleteTexture(this._webglTexture),this._painter.destroy()}update(t,e,s){const i=this.texture;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.uniform1i(e,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this._webglTexture),this._painter.draw(t,s),i.isVideo()||(this.needsUpdate=!1)}}class De extends de{constructor(t,e){super(),this.vao=t,this.program=e}destroy(t){t.releaseVAO(this.vao),t.releaseShaderResources(this.program)}getTexture(){return this.program.uniforms.uTexture.texture}}class Ue{constructor(t,e,s,i){this.program=t.createProgram(e,s),this.uniforms=i,this.uniformLocations=t.getUniformLocations(this.program,i)}}class Be{constructor(t,e){this.data=t,this.itemSize=e,this.count=t.length/e}}class Fe{constructor(t,e,s){this.vertices=new Be(new Float32Array(t),3),this.indicies=new Be(new Uint16Array(e),1),this.uvs=new Be(new Float32Array(s),2)}}class ze extends Fe{constructor({order:t,rotateUV:e}){const s=1/3,i=[];for(let t=1;t>=0;t--)for(let e=0;e<3;e++){const n=[e*s,.5*t,(e+1)*s,.5*t,(e+1)*s,.5*(t+1),e*s,.5*(t+1)];i.push(n)}e&&e.forEach(((t,e)=>{if(t===Et.ZERO)return;const s=i[e];let n;n=t===Et.CW_90?[1,2,3,0]:t===Et.CCW_90?[3,0,1,2]:[2,3,0,1];const o=Array(s.length);for(let t=0;t<s.length/2;t++)o[2*t+0]=s[2*n[t]+0],o[2*t+1]=s[2*n[t]+1];i[e]=o}));super([1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1],[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],Nt(i,t,"BFUDRL").reduce(((t,e)=>t.concat(e)),[]))}}class Ve extends Se{constructor(t,e){super(),this.texture=e,this._webglTexture=t.createWebGLTexture(e)}destroy(t){this.texture.destroy(),t.deleteTexture(this._webglTexture)}update(t,e,s){const i=this.texture,n=i.isVideo();t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i.flipY),t.uniform1i(e,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._webglTexture),!n&&s?t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,i.source):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.source),n||(this.needsUpdate=!1)}}var Ge="#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying highp vec2 vUV;void main(){vUV=uv;gl_Position=uPMatrix*uMVMatrix*vec4(position,1.0);}",ke="#define GLSLIFY 1\nuniform sampler2D uTexture;varying highp vec2 vUV;void main(){gl_FragColor=texture2D(uTexture,vUV.st);}";class He extends Fe{constructor(t){const e=[],s=[],i=[],n=[-.5,.5],o=1/60,r=t*o;for(let a=0;a<2;a++){const h=n[a];for(let n=0;n<=60;n++){const l=n*r+Math.PI-.5*t,c=Math.cos(l),u=Math.sin(l),_=n*o,d=a;if(i.push(_,d),e.push(c,h,u),0===a&&n<60){const t=n,e=t+60+1;s.push(t,e,t+1,e,e+1,t+1)}}}super(e,s,i)}}class Ye extends Fe{constructor(){const t=60,e=-.5*Math.PI,s=[],i=[],n=[];let o,r;for(o=0;o<=60;o++){const a=(o/60-.5)*Math.PI,h=Math.sin(a),l=Math.cos(a);for(r=0;r<=t;r++){const a=2*(r/t-.5)*Math.PI+e,c=Math.sin(a),u=Math.cos(a)*l,_=h,d=c*l,m=r/t,p=o/60;if(s.push(m,p),i.push(u,_,d),r!==t&&60!==o){const e=61*o+r,s=e+t+1;n.push(e,e+1,s,s,e+1,s+1)}}}super(i,n,s)}}class Xe extends Se{constructor(t){super(),this.val=t}update(t,e){t.uniform1f(e,this.val),this.needsUpdate=!1}}class We extends Fe{constructor(t=2,e=2,s=-1){const i=.5*t,n=.5*e;super([-i,-n,s,i,-n,s,-i,n,s,i,n,s],[0,1,2,2,1,3],[0,0,1,0,0,1,1,1])}}class qe extends Se{constructor(t){super(),this.val=t}update(t,e){t.uniform4fv(e,this.val.reduce(((t,e)=>[...t,...e]),[])),this.needsUpdate=!1}}class je extends Ae{constructor(t){super(t),this._mode=t.mode}createMesh(t,e){let s,i;if(this._mode===je.MODE.LEFT_RIGHT)s=[.5,1,0,0],i=[.5,1,.5,0];else s=[1,.5,0,0],i=[1,.5,0,.5];const n={uTexture:new Ve(t,e),uEye:new Xe(0),uTexScaleOffset:new qe([s,i])},o=new Ye,r=new Ue(t,"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform vec4 uTexScaleOffset[2];uniform float uEye;varying highp vec2 vUV;void main(){vec4 scaleOffset=uTexScaleOffset[int(uEye)];vUV=uv.xy*scaleOffset.xy+scaleOffset.zw;gl_Position=uPMatrix*uMVMatrix*vec4(position,1.0);}",ke,n),a=t.createVAO(o,r);return new De(a,r)}}je.MODE={LEFT_RIGHT:"left_right",TOP_BOTTOM:"top_bottom"};var Ke={__proto__:null,default:_e,Autoplay:oe,AutoResizer:ne,Camera:Vt,CameraAnimation:zt,Motion:Ft,Object3D:de,View360Error:a,WebGLRenderer:ue,XRManager:re,PanoControl:$t,RotateControl:Yt,ZoomControl:qt,GyroControl:Zt,ControlBar:Ie,ControlBarItem:pe,FullscreenButton:Re,PieView:ye,PlayButton:be,ProgressBar:Te,VideoTime:we,VolumeControl:fe,LoadingSpinner:me,Projection:Ae,CubemapProjection:class extends Ae{constructor(t){super(t);const{cubemapOrder:e="RLUDFB",cubemapFlipX:s=!1}=t;this._cubemapOrder=e,this._cubemapFlipX=s}createMesh(t,e){const s=this._cubemapOrder,i=this._cubemapFlipX,n={uTexture:e.isCube()?new Pe(t,e,s):new Me(t,e,s)},o=new ze({order:s}),r=new Ue(t,"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying highp vec3 vPos;void main(){vPos=position;gl_Position=uPMatrix*uMVMatrix*vec4(position,1.0);}","#define GLSLIFY 1\nuniform samplerCube uTexture;varying highp vec3 vPos;void main(){gl_FragColor=textureCube(uTexture,vec3(vPos.x,vPos.y,-vPos.z));}",n),a=t.createVAO(o,r),h=new De(a,r);return i&&(h.scale[0]=-1),h.updateMatrix(),h}},CubestripProjection:class extends Ae{constructor(t){super(t);const{cubemapOrder:e="RLUDFB",cubemapFlipX:s=!1}=t;this._cubemapOrder=e,this._cubemapFlipX=s}createMesh(t,e){const s=this._cubemapOrder,i=this._cubemapFlipX,n={uTexture:new Ve(t,e)},o=new ze({order:s}),r=new Ue(t,Ge,ke,n),a=t.createVAO(o,r),h=new De(a,r);return i&&(h.scale[0]=-1),h.updateMatrix(),h}},CylindricalProjection:class extends Ae{constructor(t){super(t);const{partial:e=!1}=t;this._partial=e,this._aspect=1,this._halfHeight=0,this._mesh=null}createMesh(t,s){if(this._mesh)return this._mesh;const i=this._partial,{width:n,height:o}=s,r=n/o,a=180/r,h=i?1:2*Math.tan(a*ut),l=i?r:2*Math.PI,c=new He(l),u=new Ue(t,Ge,ke,{uTexture:new Ve(t,s)}),_=t.createVAO(c,u),d=new De(_,u);return d.scale[1]=h,e.quat.identity(d.rotation),e.quat.rotateY(d.rotation,d.rotation,-Math.PI/2),d.updateMatrix(),this._aspect=r,this._halfHeight=.5*h,this._mesh=d,d}updateCamera(t){super.updateCamera(t);const e=this._mesh,s=this._aspect,i=this._halfHeight;if(!e)return;if(this._partial){const e=.5*s*_t;t.restrictYawRange(-e,e)}const n=Math.atan2(i,1)*_t,o=Math.tan(t.fov*ut*.5)/(i*t.aspect);t.restrictPitchRange(-n,n),t.restrictZoomRange(o,1/0),t.restrictRenderHeight(2*i)}},EquiangularProjection:class extends Ae{createMesh(t,e){const s={uTexture:new Ve(t,e)},i=new ze({order:"LFRDBU",rotateUV:[Et.ZERO,Et.ZERO,Et.ZERO,Et.CW_90,Et.CCW_90,Et.CW_90]}),n=new Ue(t,Ge,"#define PI 3.14159265359\nprecision mediump float;\n#define GLSLIFY 1\nuniform sampler2D uTexture;varying highp vec2 vUV;const vec2 OPERATE_COORDS_RANGE=vec2(-1.0,1.0);const vec2 TEXTURE_COORDS_RANGE=vec2(0.0,1.0);const float ONE_THIRD=1.0/3.0;const float EAC_CONST=2.0/PI;float scale(vec2 domainRange,vec2 targetRange,float val){float unit=1.0/(domainRange[1]-domainRange[0]);return targetRange[0]+(targetRange[1]-targetRange[0])*(val-domainRange[0])*unit;}void main(void){float transformedCoordX;float transformedCoordY;float texRangeXStart=floor(vUV.s*3.)*ONE_THIRD;float texRangeYStart=floor(vUV.t*2.)*0.5;vec2 orgTextureRangeX=vec2(texRangeXStart,texRangeXStart+ONE_THIRD);vec2 orgTextureRangeY=vec2(texRangeYStart,texRangeYStart+0.5);float px=scale(orgTextureRangeX,OPERATE_COORDS_RANGE,vUV.s);float py=scale(orgTextureRangeY,OPERATE_COORDS_RANGE,vUV.t);float qu=EAC_CONST*atan(px)+0.5;float qv=EAC_CONST*atan(py)+0.5;transformedCoordX=scale(TEXTURE_COORDS_RANGE,orgTextureRangeX,qu);transformedCoordY=scale(TEXTURE_COORDS_RANGE,orgTextureRangeY,qv);gl_FragColor=texture2D(uTexture,vec2(transformedCoordX,transformedCoordY));}",s),o=t.createVAO(i,n);return new De(o,n)}},EquirectProjection:class extends Ae{constructor(t){super(t)}createMesh(t,e){const s={uTexture:new Ve(t,e)},i=new Ye,n=new Ue(t,Ge,ke,s),o=t.createVAO(i,n);return new De(o,n)}},LittlePlanetProjection:class extends Ae{constructor(t){super(t)}createMesh(t,e){e.wrapS=WebGLRenderingContext.REPEAT,e.wrapT=WebGLRenderingContext.REPEAT;const s={uTexture:new Ve(t,e),uYaw:new Xe(0),uPitch:new Xe(.5),uZoom:new Xe(1)},i=new We,n=new Ue(t,"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying highp vec2 vUV;void main(){vUV=uv;gl_Position=vec4(position,1.0);}","precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D uTexture;uniform float uYaw;uniform float uPitch;uniform float uZoom;varying highp vec2 vUV;const float PI=3.1415926536;const float PI_2=PI*0.5;vec2 toStereographicUV(in vec2 uv,in vec2 center){float R=1.*uZoom;vec2 texLatLon=(uv*2.-1.)*vec2(PI,PI_2);vec2 central=(center*2.-1.)*vec2(PI,PI_2)+vec2(PI,0);float x=texLatLon.x;float y=texLatLon.y;float rou=sqrt(x*x+y*y);float c=2.0*atan(rou,R*0.5);float sin_c=sin(c);float cos_c=cos(c);float sin_cy=sin(central.y);float cos_cy=cos(central.y);float lat=asin(cos_c*sin_cy+(y*sin_c*cos_cy)/rou);float lon=central.x+atan(x*sin_c,rou*cos_cy*cos_c-y*sin_cy*sin_c);float u=(lon/PI+1.0)*0.5;float v=(lat/PI_2+1.0)*0.5;return vec2(u,v);}void main(){vec2 central=vec2(uYaw,uPitch);vec2 uv=toStereographicUV(vUV,central);gl_FragColor=texture2D(uTexture,uv);}",s),o=t.createVAO(i,n),r=new De(o,n);return r.on(nt,(({camera:t})=>{const e=r.program.uniforms;e.uYaw.val=t.yaw/360,e.uPitch.val=t.pitch/180+.5,e.uZoom.val=t.zoom,e.uYaw.needsUpdate=!0,e.uPitch.needsUpdate=!0,e.uZoom.needsUpdate=!0})),r}updateControl(t){t.ignoreZoomScale=!0}},StereoEquiProjection:je,Hotspot:ae,HotspotRenderer:he,ERROR_CODES:h,DEFAULT_CLASS:J,EVENTS:tt,EASING:et,getValidProps:t=>Object.keys(t).reduce(((e,s)=>(null!=t[s]&&(e[s]=t[s]),e)),{}),VIEW360_METHODS:["destroy","init","load","resize","addPlugins","removePlugins","renderFrame","on","hasOn","once","off","trigger"],withMethods:(t,e)=>{[n.default.prototype,_e.prototype].forEach((s=>{Object.getOwnPropertyNames(s).filter((t=>"_"!==t.charAt(0)&&"constructor"!==t)).forEach((i=>{const n=Object.getOwnPropertyDescriptor(s,i);if(n.value)Object.defineProperty(t,i,{value:function(...t){return n.value.call(this[e],...t)}});else{const s={};n.get&&(s.get=function(){var t;return this[e]&&(null===(t=n.get)||void 0===t?void 0:t.call(this[e]))}),n.set&&(s.set=function(...t){var s;return null===(s=n.set)||void 0===s?void 0:s.call(this[e],...t)}),Object.defineProperty(t,i,s)}}))}))}};return((t,...e)=>{e.forEach((e=>{Object.keys(e).forEach((s=>{const i=e[s];Array.isArray(t[s])&&Array.isArray(i)?t[s]=[...t[s],...i]:t[s]=i}))}))})(_e,Ke),_e}));
//# sourceMappingURL=view360.min.js.map
