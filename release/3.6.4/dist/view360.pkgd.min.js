/*
Copyright (c) 2017-present NAVER Corp.
name: @egjs/view360
license: MIT
author: NAVER Corp.
repository: https://github.com/naver/egjs-view360
version: 3.6.4
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).eg=t.eg||{},t.eg.view360=e())}(this,function(){"use strict";var i="3.6.4",r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var h=function(){return(h=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function n(t,a,s,u){return new(s=s||Promise)(function(n,e){function i(t){try{o(u.next(t))}catch(t){e(t)}}function r(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(i,r)}o((u=u.apply(t,a||[])).next())})}function o(n,i){var r,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=i.call(n,s)}catch(t){e=[6,t],o=0}finally{r=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function d(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(i=o.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}(arguments[e]));return t}function c(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(i=o.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}(arguments[e]));return t}function l(t){return void 0===t}var u=function(){function t(t,e){var n,i;if(this._canceled=!1,e)try{for(var r=c(Object.keys(e)),o=r.next();!o.done;o=r.next()){var a=o.value;this[a]=e[a]}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}this.eventType=t}var e=t.prototype;return e.stop=function(){this._canceled=!0},e.isCanceled=function(){return this._canceled},t}(),_=function(){function t(){this._eventHandler={}}var e=t.prototype;return e.trigger=function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var i=e instanceof u?e.eventType:e,i=a(this._eventHandler[i]||[]);return i.length<=0||(e instanceof u?(e.currentTarget=this,i.forEach(function(t){t(e)})):i.forEach(function(t){t.apply(void 0,a(n))})),this},e.once=function(n,i){var r,o=this;if("object"==typeof n&&l(i)){var t,e=n;for(t in e)this.once(t,e[t]);return this}return"string"==typeof n&&"function"==typeof i&&(r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.apply(void 0,a(t)),o.off(n,r)},this.on(n,r)),this},e.hasOn=function(t){return!!this._eventHandler[t]},e.on=function(t,e){if("object"==typeof t&&l(e)){var n,i=t;for(n in i)this.on(n,i[n]);return this}var r;return"string"==typeof t&&"function"==typeof e&&(r=this._eventHandler[t],l(r)&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(e)),this},e.off=function(t,e){var n,i;if(l(t))return this._eventHandler={},this;if(l(e)){if("string"==typeof t)return delete this._eventHandler[t],this;var r,o=t;for(r in o)this.off(r,o[r]);return this}var a=this._eventHandler[t];if(a){var s=0;try{for(var u=c(a),h=u.next();!h.done;h=u.next()){if(h.value===e){a.splice(s,1),a.length<=0&&delete this._eventHandler[t];break}s++}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}return this},t.VERSION="3.0.2",t}(),p=u;var e=setTimeout;function v(t){return Boolean(t&&void 0!==t.length)}function g(){}function m(t){if(!(this instanceof m))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],R(t,this)}function y(n,i){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,m._immediateFn(function(){var t,e=1===n._state?i.onFulfilled:i.onRejected;if(null!==e){try{t=e(n._value)}catch(t){return void x(i.promise,t)}E(i.promise,t)}else(1===n._state?E:x)(i.promise,n._value)})):n._deferreds.push(i)}function E(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof m)return e._state=3,e._value=t,void w(e);if("function"==typeof n)return void R((i=n,r=t,function(){i.apply(r,arguments)}),e)}e._state=1,e._value=t,w(e)}catch(t){x(e,t)}var i,r}function x(t,e){t._state=2,t._value=e,w(t)}function w(t){2===t._state&&0===t._deferreds.length&&m._immediateFn(function(){t._handled||m._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)y(t,t._deferreds[e]);t._deferreds=null}function T(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function R(t,e){var n=!1;try{t(function(t){n||(n=!0,E(e,t))},function(t){n||(n=!0,x(e,t))})}catch(t){if(n)return;n=!0,x(e,t)}}function b(t,e){for(var n=t.length,i=0;i<n;++i)if(e(t[i],i))return!0;return!1}function C(t,e){for(var n=t.length,i=0;i<n;++i)if(e(t[i],i))return t[i];return null}function P(t,e){try{return new RegExp(t,"g").exec(e)}catch(t){return null}}function M(t){return t.replace(/_/g,".")}function I(t,n){var i=null,r="-1";return b(t,function(t){var e=P("("+t.test+")((?:\\/|\\s|:)([0-9|\\.|_]+))?",n);return e&&!t.brand&&(i=t,r=e[3]||"-1",t.versionAlias?r=t.versionAlias:t.versionTest&&(t=t.versionTest.toLowerCase(),r=((t=P("("+t+")((?:\\/|\\s|:)([0-9|\\.|_]+))?",t=n))?t[3]:"")||r),r=M(r),1)}),{preset:i,version:r}}function O(t,e){return C(t,function(t){t=t.brand;return P(""+e.test,t.toLowerCase())})}m.prototype.catch=function(t){return this.then(null,t)},m.prototype.then=function(t,e){var n=new this.constructor(g);return y(this,new T(t,e,n)),n},m.prototype.finally=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})},m.all=function(e){return new m(function(r,o){if(!v(e))return o(new TypeError("Promise.all accepts an array"));var a=Array.prototype.slice.call(e);if(0===a.length)return r([]);var s=a.length;for(var t=0;t<a.length;t++)!function e(n,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if("function"==typeof i)return void i.call(t,function(t){e(n,t)},o)}a[n]=t,0==--s&&r(a)}catch(t){o(t)}}(t,a[t])})},m.allSettled=function(n){return new this(function(r,t){if(!n||void 0===n.length)return t(new TypeError(typeof n+" "+n+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var o=Array.prototype.slice.call(n);if(0===o.length)return r([]);var a=o.length;for(var e=0;e<o.length;e++)!function e(n,t){if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if("function"==typeof i)return void i.call(t,function(t){e(n,t)},function(t){o[n]={status:"rejected",reason:t},0==--a&&r(o)})}o[n]={status:"fulfilled",value:t},0==--a&&r(o)}(e,o[e])})},m.resolve=function(e){return e&&"object"==typeof e&&e.constructor===m?e:new m(function(t){t(e)})},m.reject=function(n){return new m(function(t,e){e(n)})},m.race=function(r){return new m(function(t,e){if(!v(r))return e(new TypeError("Promise.race accepts an array"));for(var n=0,i=r.length;n<i;n++)m.resolve(r[n]).then(t,e)})},m._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){e(t,0)},m._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var A=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],S=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",brand:!0}],D=[{test:"applewebkit",id:"webkit"}],V=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],L=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"mac os x",id:"mac"},{test:"android",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function F(t){var e=function(t){if(void 0===t){if("undefined"==typeof navigator||!navigator)return"";t=navigator.userAgent||""}return t.toLowerCase()}(t),n=!!/mobi/g.exec(e),i={name:"unknown",version:"-1",majorVersion:-1,webview:!!I(V,e).preset,chromium:!!I(S,e).preset,webkit:!1},r={name:"unknown",version:"-1",majorVersion:-1},o=I(A,e),a=o.preset,s=o.version,t=I(L,e),o=t.preset,t=t.version;return i.webkit=!i.chromium&&!!I(D,e).preset,o&&(r.name=o.id,r.version=t,r.majorVersion=parseInt(t,10)),a&&(i.name=a.id,i.version=s,i.webview&&"ios"===r.name&&"safari"!==i.name&&(i.webview=!1)),i.majorVersion=parseInt(i.version,10),{browser:i,os:r,isMobile:n,isHints:!1}}function N(t){return void 0===t&&function(){if("undefined"!=typeof navigator&&navigator&&navigator.userAgentData){var t=navigator.userAgentData,t=t.brands||t.uaList;return t&&t.length}}()?(i=((s=navigator.userAgentData).uaList||s.brands).slice(),r=s.mobile||!1,o=i[0],a={name:o.brand,version:o.version,majorVersion:-1,webkit:!1,webview:b(V,function(t){return O(i,t)}),chromium:b(S,function(t){return O(i,t)})},s={name:"unknown",version:"-1",majorVersion:-1},a.webkit=!a.chromium&&b(D,function(t){return O(i,t)}),n&&(e=n.platform.toLowerCase(),o=C(L,function(t){return new RegExp(""+t.test,"g").exec(e)}),s.name=o?o.id:e,s.version=n.platformVersion),b(A,function(t){var e=O(i,t);return e&&(a.name=t.id,a.version=n?n.uaFullVersion:e.version,1)}),"Linux armv8l"===navigator.platform?s.name="android":a.webkit&&(s.name=r?"ios":"mac"),"ios"===s.name&&a.webview&&(a.version="-1"),s.version=M(s.version),a.version=M(a.version),s.majorVersion=parseInt(s.version,10),a.majorVersion=parseInt(a.version,10),{browser:a,os:s,isMobile:r,isHints:!0}):F(t);var n,e,i,r,o,a,s}var k="undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),U=k.document,Q=k.navigator,t=N(),B=t.os.name,z=t.browser.name,W="ios"===B,X="mac"===B&&"safari"===z;k.Float32Array=void 0!==k.Float32Array?k.Float32Array:k.Array;k.Float32Array,k.getComputedStyle;var j=k.navigator&&k.navigator.userAgent,G="ontouchstart"in k,Y="ondevicemotion"in k,H=k.DeviceMotionEvent,q=k.devicePixelRatio,K=function(){for(var t,e=null!==(t=null==U?void 0:U.documentElement.style)&&void 0!==t?t:{},n=["transform","webkitTransform","msTransform","mozTransform"],i=0,r=n.length;i<r;i++)if(n[i]in e)return n[i];return""}(),Z=k.CSS&&k.CSS.supports&&k.CSS.supports("will-change","transform"),J=!1,$=function(){var t=window.navigator;t.xr&&(t.xr.isSessionSupported?t.xr.isSessionSupported("immersive-vr").then(function(t){J=t}).catch(function(){}):t.xr.supportsSession&&t.xr.supportsSession("immersive-vr").then(function(t){J=t}).catch(function(){}))};var tt="__observers__",et=function(){function t(t){this._emitter=new _,this._current=t}var e=t.prototype;return Object.defineProperty(e,"current",{get:function(){return this._current},set:function(t){var e=t!==this._current;this._current=t,e&&this._emitter.trigger("update",t)},enumerable:!1,configurable:!0}),e.subscribe=function(t){this._emitter.on("update",t)},e.unsubscribe=function(t){this._emitter.off("update",t)},t}();function nt(t){return t[tt]||(t[tt]={}),t[tt]}function it(t,e,n){t=nt(t);return t[e]||(t[e]=new et(n)),t[e]}function rt(t){t.subscribe=function(t,e){it(this,t).subscribe(e)},t.unsubscribe=function(t,e){var n,i=this;if(!t)return n=nt(this),void Object.keys(n).forEach(function(t){i.unsubscribe(t)});t in this&&it(this,t).unsubscribe(e)}}function ot(t){rt(t.prototype)}var at=function(t,e){return(at=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function st(t,e){function n(){this.constructor=t}at(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ut,ht=function(){return(ht=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};ut="undefined"==typeof window?{navigator:{userAgent:""}}:window;function ct(t){for(var e=[],n=0,i=t.length;n<i;n++)e.push(t[n]);return e}var lt,dt,ft="left",_t="right",pt="middle",vt="ontouchstart"in ut&&"safari"===N().browser.name,gt=function(){if("undefined"==typeof document)return"";for(var t=(document.head||document.getElementsByTagName("head")[0]).style,e=["transform","webkitTransform","msTransform","mozTransform"],n=0,i=e.length;n<i;n++)if(e[n]in t)return e[n];return""}(),mt={"user-select":"none","-webkit-user-drag":"none"},yt=function(t,e){var n;return void 0===e&&(e=!1),"string"==typeof t?(n=t.match(/^<([a-z]+)\s*([^>]*)>/)?((n=document.createElement("div")).innerHTML=t,ct(n.childNodes)):ct(document.querySelectorAll(t)),e||(n=1<=n.length?n[0]:void 0)):t===ut?n=t:"value"in t||"current"in t?n=t.value||t.current:!t.nodeName||1!==t.nodeType&&9!==t.nodeType?"jQuery"in ut&&t instanceof jQuery||t.constructor.prototype.jquery?n=e?t.toArray():t.get(0):Array.isArray(t)&&(n=t.map(function(t){return yt(t)}),e||(n=1<=n.length?n[0]:void 0)):n=t,n},Et=ut.requestAnimationFrame||ut.webkitRequestAnimationFrame,xt=ut.cancelAnimationFrame||ut.webkitCancelAnimationFrame;Et&&!xt?(lt={},dt=Et,Et=function(e){var n=dt(function(t){lt[n]&&e(t)});return lt[n]=!0,n},xt=function(t){delete lt[t]}):Et&&xt||(Et=function(t){return ut.setTimeout(function(){t(ut.performance&&ut.performance.now&&ut.performance.now()||(new Date).getTime())},16)},xt=ut.clearTimeout);function wt(t,e){var n,i={};for(n in t)n&&(i[n]=e(t[n],n));return i}function Tt(t,e){var n,i={};for(n in t)n&&e(t[n],n)&&(i[n]=t[n]);return i}function Rt(t,e){for(var n in t)if(n&&!e(t[n],n))return!1;return!0}function bt(t,n){return Rt(t,function(t,e){return t===n[e]})}function Ct(t,e){return Bt[e]||(Bt[e]=zt(e)),Bt[e](t)}function Pt(t,n){return t&&n?wt(t,function(t,e){return Ct(t,"number"==typeof n?n:n[e])}):t}function Mt(t){if(!isFinite(t))return 0;var e="".concat(t);if(0<=e.indexOf("e")){for(var n=0,i=1;Math.round(t*i)/i!==t;)i*=10,n++;return n}return 0<=e.indexOf(".")?e.length-e.indexOf(".")-1:0}function It(e){var n=!0;return Object.keys(mt).forEach(function(t){e&&e[t]===mt[t]||(n=!1)}),n}function Ot(t,e){return t&&e?30:t?6:e?24:1}function At(t,e,n){return n?!!(30===e||e&t&&n&t):!!(e&t)}function St(e,t,n){var i,r=((r={})[1]="auto",r[30]="none",r[24]="pan-x",r[6]="pan-y",r),o={};return e&&e.style&&(n=t.touchAction||r[n],i=ht(ht({},mt),{"touch-action":"none"===e.style["touch-action"]?"none":n}),Object.keys(i).forEach(function(t){o[t]=e.style[t],e.style[t]=i[t]})),o}function Dt(e,n){e&&e.style&&n&&Object.keys(n).forEach(function(t){e.style[t]=n[t]})}function Vt(t,e,n,i){return e=[!n[0]&&i?e[0]-i[0]:e[0],!n[1]&&i?e[1]+i[1]:e[1]],t=Math.max(e[0],t),t=Math.min(e[1],t)}function Lt(t,e){return t<e[0]||t>e[1]}function Ft(t,e,n){return n[1]&&t>e[1]||n[0]&&t<e[0]}function Nt(t,e,n){var i=t,r=e[0],o=e[1],e=o-r;return n[1]&&o<t&&(i=(i-o)%e+r),n[0]&&t<r&&(i=(i-r)%e+o),i}function kt(t,e){return!!(!e||-1<e.indexOf("any")||-1<e.indexOf("none")&&!t.shiftKey&&!t.ctrlKey&&!t.altKey&&!t.metaKey||-1<e.indexOf("shift")&&t.shiftKey||-1<e.indexOf("ctrl")&&t.ctrlKey||-1<e.indexOf("alt")&&t.altKey||-1<e.indexOf("meta")&&t.metaKey)}function Ut(i,t){return t.reduce(function(t,e,n){return i[n]&&(t[i[n]]=e),t},{})}function Qt(t){void 0===t&&(t=[]);var e=!1,n=!1,i=!1;return t.forEach(function(t){switch(t){case"mouse":n=!0;break;case"touch":e=Gt;break;case"pointer":i=qt}}),i?new Jt:e&&n?new $t:e?new Zt:n?new Kt:null}var Bt={},zt=function(e){var n=e<1?Math.pow(10,Mt(e)):1;return function(t){return 0===e?0:Math.round(Math.round(t/e)*e*n)/n}},Wt=function(){function t(t){this._axes=t}var e=t.prototype;return e.hold=function(t,e){t=this._getRoundPos(t).roundPos;this._axes.trigger(new p("hold",{pos:t,input:e.input||null,inputEvent:e.event||null,isTrusted:!0}))},e.triggerRelease=function(t){var e=this._getRoundPos(t.destPos,t.depaPos),n=e.roundPos,e=e.roundDepa;t.destPos=n,t.depaPos=e,t.setTo=this._createUserControll(t.destPos,t.duration),this._axes.trigger(new p("release",ht(ht({},t),{bounceRatio:this._getBounceRatio(n)})))},e.triggerChange=function(t,e,n,i){var r=this;void 0===i&&(i=!1);var o=this.animationManager,a=o.axisManager,o=o.getEventInfo(),t=this._getRoundPos(t,e),e=t.roundPos,t=t.roundDepa,s=a.moveTo(e,t),t=(null==n?void 0:n.event)||(null==o?void 0:o.event)||null,n={pos:s.pos,delta:s.delta,bounceRatio:this._getBounceRatio(s.pos),holding:i,inputEvent:t,isTrusted:!!t,input:(null==n?void 0:n.input)||(null==o?void 0:o.input)||null,set:t?this._createUserControll(s.pos):function(){}},o=new p("change",n);return this._axes.trigger(o),Object.keys(s.pos).forEach(function(t){var e=s.pos[t];it(r._axes,t,e).current=e}),t&&a.set(n.set().destPos),!o.isCanceled()},e.triggerAnimationStart=function(t){var e=this._getRoundPos(t.destPos,t.depaPos),n=e.roundPos,e=e.roundDepa;t.destPos=n,t.depaPos=e,t.setTo=this._createUserControll(t.destPos,t.duration);t=new p("animationStart",t);return this._axes.trigger(t),!t.isCanceled()},e.triggerAnimationEnd=function(t){void 0===t&&(t=!1),this._axes.trigger(new p("animationEnd",{isTrusted:t}))},e.triggerFinish=function(t){void 0===t&&(t=!1),this._axes.trigger(new p("finish",{isTrusted:t}))},e.setAnimationManager=function(t){this.animationManager=t},e.destroy=function(){this._axes.off()},e._createUserControll=function(t,e){void 0===e&&(e=0);var n={destPos:ht({},t),duration:e};return function(t,e){return t&&(n.destPos=ht({},t)),void 0!==e&&(n.duration=e),n}},e._getRoundPos=function(t,e){var n=this._axes.options.round;return{roundPos:Pt(t,n),roundDepa:Pt(e,n)}},e._getBounceRatio=function(t){return this._axes.axisManager.map(t,function(t,e){return t<e.range[0]&&0!==e.bounce[0]?(e.range[0]-t)/e.bounce[0]:t>e.range[1]&&0!==e.bounce[1]?(t-e.range[1])/e.bounce[1]:0})},t}(),Xt=function(){function t(t){this._options=t,this._prevented=!1}var e=t.prototype;return e.isInterrupting=function(){return this._options.interruptable||this._prevented},e.isInterrupted=function(){return!this._options.interruptable&&this._prevented},e.setInterrupt=function(t){this._options.interruptable||(this._prevented=t)},t}(),jt=function(){function t(t){var n=this;this._axis=t,this._complementOptions(),this._pos=Object.keys(this._axis).reduce(function(t,e){return t[e]=n._axis[e].startPos,t},{})}var e=t.prototype;return e.getDelta=function(t,e){var n=this.get(t);return wt(this.get(e),function(t,e){return t-n[e]})},e.get=function(t){var n=this;return t&&Array.isArray(t)?t.reduce(function(t,e){return e&&e in n._pos&&(t[e]=n._pos[e]),t},{}):ht(ht({},this._pos),t||{})},e.moveTo=function(n,i){void 0===i&&(i=this._pos);var t=wt(this._pos,function(t,e){return e in n&&e in i?n[e]-i[e]:0});return this.set(this.map(n,function(t,e){return e?Nt(t,e.range,e.circular):0})),{pos:ht({},this._pos),delta:t}},e.set=function(t){for(var e in t)e&&e in this._pos&&(this._pos[e]=t[e])},e.every=function(t,n){var i=this._axis;return Rt(t,function(t,e){return n(t,i[e],e)})},e.filter=function(t,n){var i=this._axis;return Tt(t,function(t,e){return n(t,i[e],e)})},e.map=function(t,n){var i=this._axis;return wt(t,function(t,e){return n(t,i[e],e)})},e.isOutside=function(t){return!this.every(t?this.get(t):this._pos,function(t,e){return!Lt(t,e.range)})},e.getAxisOptions=function(t){return this._axis[t]},e.setAxis=function(e){var n=this;Object.keys(e).forEach(function(t){if(!n._axis[t])throw new Error("Axis ".concat(t," does not exist in Axes instance"));n._axis[t]=ht(ht({},n._axis[t]),e[t])}),this._complementOptions()},e._complementOptions=function(){var r=this;Object.keys(this._axis).forEach(function(i){r._axis[i]=ht({range:[0,100],startPos:r._axis[i].range[0],bounce:[0,0],circular:[!1,!1]},r._axis[i]),["bounce","circular"].forEach(function(t){var e=r._axis,n=e[i][t];/string|number|boolean/.test(typeof n)&&(e[i][t]=[n,n])})})},t}(),Gt="ontouchstart"in ut,Yt="PointerEvent"in ut,Ht="MSPointerEvent"in ut,qt=Yt||Ht,t=function(){function t(){var e=this;this._stopContextMenu=function(t){t.preventDefault(),ut.removeEventListener("contextmenu",e._stopContextMenu)}}var e=t.prototype;return e.extendEvent=function(t){var e=this.prevEvent,n=this._getCenter(t),i=e?this._getMovement(t):{x:0,y:0},r=e?this._getScale(t):1,o=e?(d=n.x-e.center.x,l=n.y-e.center.y,180*Math.atan2(l,d)/Math.PI):0,a=e?e.deltaX+i.x:i.x,s=e?e.deltaY+i.y:i.y,u=i.x,h=i.y,c=this._latestInterval,l=Date.now(),d=c?l-c.timestamp:0,i=e?e.velocityX:0,e=e?e.velocityY:0;return(!c||16<=d)&&(c&&(i=(d=[(a-c.deltaX)/d,(s-c.deltaY)/d])[0],e=d[1]),this._latestInterval={timestamp:l,deltaX:a,deltaY:s}),{srcEvent:t,scale:r,angle:o,center:n,deltaX:a,deltaY:s,offsetX:u,offsetY:h,velocityX:i,velocityY:e,preventSystemEvent:!0}},e._getDistance=function(t,e){var n=e.clientX-t.clientX,t=e.clientY-t.clientY;return Math.sqrt(n*n+t*t)},e._getButton=function(t){var e={1:ft,2:_t,4:pt},t=this._isTouchEvent(t)?ft:e[t.buttons];return t||null},e._isTouchEvent=function(t){return t.type&&-1<t.type.indexOf("touch")},e._isValidButton=function(t,e){return-1<e.indexOf(t)},e._isValidEvent=function(t,e,n){return(!e||kt(t,e))&&(!n||this._isValidButton(this._getButton(t),n))},e._preventMouseButton=function(t,e){e===_t?ut.addEventListener("contextmenu",this._stopContextMenu):e===pt&&t.preventDefault()},t}(),Kt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.start=["mousedown"],t.move=["mousemove"],t.end=["mouseup"],t}st(t,e);var n=t.prototype;return n.onEventStart=function(t,e,n){var i=this._getButton(t);return this._isValidEvent(t,e,n)?(this._preventMouseButton(t,i),this.extendEvent(t)):null},n.onEventMove=function(t,e,n){return this._isValidEvent(t,e,n)?this.extendEvent(t):null},n.onEventEnd=function(){},n.onRelease=function(){this.prevEvent=null},n.getTouches=function(t,e){if(e){var n={1:ft,2:pt,3:_t};return this._isValidButton(n[t.which],e)&&-1===this.end.indexOf(t.type)?1:0}return 0},n._getScale=function(){return 1},n._getCenter=function(t){return{x:t.clientX,y:t.clientY}},n._getMovement=function(t){var e=this.prevEvent.srcEvent;return{x:t.clientX-e.clientX,y:t.clientY-e.clientY}},t}(t),Zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.start=["touchstart"],t.move=["touchmove"],t.end=["touchend","touchcancel"],t}st(t,e);var n=t.prototype;return n.onEventStart=function(t,e){return this._baseTouches=t.touches,this._isValidEvent(t,e)?this.extendEvent(t):null},n.onEventMove=function(t,e){return this._isValidEvent(t,e)?this.extendEvent(t):null},n.onEventEnd=function(t){this._baseTouches=t.touches},n.onRelease=function(){this.prevEvent=null,this._baseTouches=null},n.getTouches=function(t){return t.touches.length},n._getScale=function(t){return 2!==t.touches.length||this._baseTouches.length<2?null:this._getDistance(t.touches[0],t.touches[1])/this._getDistance(this._baseTouches[0],this._baseTouches[1])},n._getCenter=function(t){return{x:t.touches[0].clientX,y:t.touches[0].clientY}},n._getMovement=function(t){var e=this.prevEvent.srcEvent;return t.touches[0].identifier!==e.touches[0].identifier?{x:0,y:0}:{x:t.touches[0].clientX-e.touches[0].clientX,y:t.touches[0].clientY-e.touches[0].clientY}},t}(t),Jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.start=Yt?["pointerdown"]:["MSPointerDown"],t.move=Yt?["pointermove"]:["MSPointerMove"],t.end=Yt?["pointerup","pointercancel"]:["MSPointerUp","MSPointerCancel"],t._firstInputs=[],t._recentInputs=[],t}st(t,e);var n=t.prototype;return n.onEventStart=function(t,e,n){var i=this._getButton(t);return this._isValidEvent(t,e,n)?(this._preventMouseButton(t,i),this._updatePointerEvent(t),this.extendEvent(t)):null},n.onEventMove=function(t,e,n){return this._isValidEvent(t,e,n)?(this._updatePointerEvent(t),this.extendEvent(t)):null},n.onEventEnd=function(t){this._removePointerEvent(t)},n.onRelease=function(){this.prevEvent=null,this._firstInputs=[],this._recentInputs=[]},n.getTouches=function(){return this._recentInputs.length},n._getScale=function(){return 2!==this._recentInputs.length?null:this._getDistance(this._recentInputs[0],this._recentInputs[1])/this._getDistance(this._firstInputs[0],this._firstInputs[1])},n._getCenter=function(t){return{x:t.clientX,y:t.clientY}},n._getMovement=function(t){var e=this.prevEvent.srcEvent;return t.pointerId!==e.pointerId?{x:0,y:0}:{x:t.clientX-e.clientX,y:t.clientY-e.clientY}},n._updatePointerEvent=function(n){var i=this,r=!1;this._recentInputs.forEach(function(t,e){t.pointerId===n.pointerId&&(r=!0,i._recentInputs[e]=n)}),r||(this._firstInputs.push(n),this._recentInputs.push(n))},n._removePointerEvent=function(e){this._firstInputs=this._firstInputs.filter(function(t){return t.pointerId!==e.pointerId}),this._recentInputs=this._recentInputs.filter(function(t){return t.pointerId!==e.pointerId})},t}(t),$t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.start=["mousedown","touchstart"],t.move=["mousemove","touchmove"],t.end=["mouseup","touchend","touchcancel"],t}st(t,e);var n=t.prototype;return n.onEventStart=function(t,e,n){var i=this._getButton(t);return this._isTouchEvent(t)&&(this._baseTouches=t.touches),this._isValidEvent(t,e,n)?(this._preventMouseButton(t,i),this.extendEvent(t)):null},n.onEventMove=function(t,e,n){return this._isValidEvent(t,e,n)?this.extendEvent(t):null},n.onEventEnd=function(t){this._isTouchEvent(t)&&(this._baseTouches=t.touches)},n.onRelease=function(){this.prevEvent=null,this._baseTouches=null},n.getTouches=function(t){return this._isTouchEvent(t)?t.touches.length:0},n._getScale=function(t){return this._isTouchEvent(t)?2!==t.touches.length||this._baseTouches.length<2?1:this._getDistance(t.touches[0],t.touches[1])/this._getDistance(this._baseTouches[0],this._baseTouches[1]):this.prevEvent.scale},n._getCenter=function(t){return this._isTouchEvent(t)?{x:t.touches[0].clientX,y:t.touches[0].clientY}:{x:t.clientX,y:t.clientY}},n._getMovement=function(t){var e=this,n=[t,this.prevEvent.srcEvent].map(function(t){return e._isTouchEvent(t)?{id:t.touches[0].identifier,x:t.touches[0].clientX,y:t.touches[0].clientY}:{id:null,x:t.clientX,y:t.clientY}}),t=n[0],n=n[1];return t.id===n.id?{x:t.x-n.x,y:t.y-n.y}:{x:0,y:0}},t}(t);function te(t){return-1<t.indexOf("touch")&&{passive:!1}}function ee(t,e,n){return Math.max(Math.min(t,n),e)}var ne=function(){function t(t){var e=t.options,n=t.interruptManager,i=t.eventManager,r=t.axisManager,t=t.animationManager;this._isOutside=!1,this._moveDistance=null,this._isStopped=!1,this.options=e,this._interruptManager=n,this._eventManager=i,this._axisManager=r,this._animationManager=t}var e=t.prototype;return e.get=function(t){return this._axisManager.get(t.axes)},e.hold=function(t,e){!this._interruptManager.isInterrupted()&&t.axes.length&&(e={input:t,event:e},this._isStopped=!1,this._interruptManager.setInterrupt(!0),this._animationManager.stopAnimation(e),this._moveDistance||this._eventManager.hold(this._axisManager.get(),e),this._isOutside=this._axisManager.isOutside(t.axes),this._moveDistance=this._axisManager.get(t.axes))},e.change=function(t,e,n,i){var r,o,a;this._isStopped||!this._interruptManager.isInterrupting()||this._axisManager.every(n,function(t){return 0===t})||((r=e.srcEvent||e).__childrenAxesAlreadyChanged||(o=this._moveDistance||this._axisManager.get(t.axes),a=wt(o,function(t,e){return t+(n[e]||0)}),this._moveDistance&&(this._moveDistance=this._axisManager.map(a,function(t,e){var n=e.circular,e=e.range;return n&&(n[0]||n[1])?Nt(t,e,n):t})),this._isOutside&&this._axisManager.every(o,function(t,e){return!Lt(t,e.range)})&&(this._isOutside=!1),o=this._atOutside(o),a=this._atOutside(a),this.options.nested&&this._isEndofAxis(n,o,a)||(r.__childrenAxesAlreadyChanged=!0),e={input:t,event:e},i?(i=this._animationManager.getDuration(a,o),this._animationManager.animateTo(a,i,e)):this._eventManager.triggerChange(a,o,e,!0)||(this._isStopped=!0,this._moveDistance=null,this._animationManager.finish(!1))))},e.release=function(t,e,n,i){var r,o,a;!this._isStopped&&this._interruptManager.isInterrupting()&&this._moveDistance&&((r=e.srcEvent||e).__childrenAxesAlreadyReleased&&(n=n.map(function(){return 0})),o=this._axisManager.get(t.axes),a=this._axisManager.get(),n=this._animationManager.getDisplacement(n),n=Ut(t.axes,n),n=this._axisManager.get(this._axisManager.map(n,function(t,e,n){return e.circular&&(e.circular[0]||e.circular[1])?o[n]+t:Vt(o[n]+t,e.range,e.circular,e.bounce)})),r.__childrenAxesAlreadyReleased=!0,0===(i=this._animationManager.getDuration(n,o,i))&&(n=ht({},a)),n={depaPos:a,destPos:n,duration:i,delta:this._axisManager.getDelta(a,n),inputEvent:e,input:t,isTrusted:!0},this._eventManager.triggerRelease(n),this._moveDistance=null,n=this._animationManager.getUserControl(n),t={input:t,event:e},(e=bt(n.destPos,a))||0===n.duration?(e||this._eventManager.triggerChange(n.destPos,a,t,!0),this._interruptManager.setInterrupt(!1),this._axisManager.isOutside()?this._animationManager.restore(t):this._eventManager.triggerFinish(!0)):this._animationManager.animateTo(n.destPos,n.duration,t))},e._atOutside=function(t){var o=this;return this._isOutside?this._axisManager.map(t,function(t,e){var n=e.range[0]-e.bounce[0],e=e.range[1]+e.bounce[1];return e<t?e:t<n?n:t}):this._axisManager.map(t,function(t,e){var n=e.range[0],i=e.range[1],r=e.bounce,e=e.circular;return e[0]&&t<n||e[1]&&i<t?t:t<n?n-o._animationManager.interpolate(n-t,r[0]):i<t?i+o._animationManager.interpolate(t-i,r[1]):t})},e._isEndofAxis=function(r,o,a){return this._axisManager.every(o,function(t,e,n){return 0===r[n]||o[n]===a[n]&&(i=t,n=e.range,t=e.bounce,!(e=e.circular)[0]&&i===n[0]-t[0]||!e[1]&&i===n[1]+t[1]);var i})},t}(),ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._useDuration=!0,t}st(t,e);var n=t.prototype;return n.interpolate=function(t,e){var n=this._easing(1e-5)/1e-5;return this._easing(t/(e*n))*e},n.updateAnimation=function(t){var e,n,i,r,o=this._animateParam;o&&(e=(new Date).getTime()-o.startTime,n=(null==t?void 0:t.destPos)||o.destPos,i=null!==(r=null==t?void 0:t.duration)&&void 0!==r?r:o.duration,null!=t&&t.restart||i<=e?this.setTo(n,i-e):(null!=t&&t.destPos&&(r=this.axisManager.get(),this._initialEasingPer=this._prevEasingPer,o.delta=this.axisManager.getDelta(r,n),o.destPos=n),null!=t&&t.duration&&(t=(e+this._durationOffset)/o.duration,this._durationOffset=t*i-e,o.duration=i)))},n._initState=function(t){return this._initialEasingPer=0,this._prevEasingPer=0,this._durationOffset=0,{pos:t.depaPos,easingPer:0,finished:!1}},n._getNextState=function(t){var r=this,o=this._animateParam,a=t.pos,s=o.destPos,u=wt(a,function(t,e){return t<=s[e]?1:-1}),h=((new Date).getTime()-o.startTime+this._durationOffset)/o.duration,c=this._easing(h);return{pos:this.axisManager.map(a,function(t,e,n){var i=1<=h?s[n]:t+o.delta[n]*(c-r._prevEasingPer)/(1-r._initialEasingPer),t=Nt(i,e.range,e.circular);return i!==t&&(e=u[n]*(e.range[1]-e.range[0]),s[n]-=e,a[n]-=e),t}),easingPer:this._prevEasingPer=c,finished:1<=c}},n._easing=function(t){return 1<t?1:this._options.easing(t)},t}(function(){function t(t){var e=t.options,n=t.interruptManager,i=t.eventManager,t=t.axisManager;this._options=e,this.interruptManager=n,this.eventManager=i,this.axisManager=t,this.animationEnd=this.animationEnd.bind(this)}var e=t.prototype;return e.getDuration=function(n,t,e){var i,r=this;return t=void 0!==e?e:(i=wt(t,function(t,e){return function(t,e){e=Math.sqrt(t/e*2);return e<100?0:e}(Math.abs(t-n[e]),r._options.deceleration)}),Object.keys(i).reduce(function(t,e){return Math.max(t,i[e])},-1/0)),ee(t,this._options.minimumDuration,this._options.maximumDuration)},e.getDisplacement=function(t){var e=Math.pow(t.reduce(function(t,e){return t+e*e},0),1/t.length),n=Math.abs(e/-this._options.deceleration);return t.map(function(t){return t/2*n})},e.stopAnimation=function(t){var n,e;this._animateParam&&(n=this.axisManager.get(),e=this.axisManager.map(n,function(t,e){return Nt(t,e.range,e.circular)}),Rt(e,function(t,e){return n[e]===t})||this.eventManager.triggerChange(e,n,t,!!t),this._animateParam=null,this._raf&&(e=this._raf,xt(e)),this._raf=null,this.eventManager.triggerAnimationEnd(!(null==t||!t.event)))},e.getEventInfo=function(){return this._animateParam&&this._animateParam.input&&this._animateParam.inputEvent?{input:this._animateParam.input,event:this._animateParam.inputEvent}:null},e.restore=function(t){var e=this.axisManager.get(),n=this.axisManager.map(e,function(t,e){return Math.min(e.range[1],Math.max(e.range[0],t))});this.stopAnimation(),this.animateTo(n,this.getDuration(e,n),t)},e.animationEnd=function(){var t=this.getEventInfo();this._animateParam=null;var e=this.axisManager.filter(this.axisManager.get(),function(t,e){return Ft(t,e.range,e.circular)});0<Object.keys(e).length&&this.setTo(this.axisManager.map(e,function(t,e){return Nt(t,e.range,e.circular)})),this.interruptManager.setInterrupt(!1),this.eventManager.triggerAnimationEnd(!!t),this.axisManager.isOutside()?this.restore(t):this.finish(!!t)},e.finish=function(t){this._animateParam=null,this.interruptManager.setInterrupt(!1),this.eventManager.triggerFinish(t)},e.getUserControl=function(t){t=t.setTo();return t.destPos=this.axisManager.get(t.destPos),t.duration=ee(t.duration,this._options.minimumDuration,this._options.maximumDuration),t},e.animateTo=function(t,e,n){var i=this;this.stopAnimation();var r=this._createAnimationParam(t,e,n),t=ht({},r.depaPos),e=this.eventManager.triggerAnimationStart(r),r=this.getUserControl(r);!e&&this.axisManager.every(r.destPos,function(t,e){return Ft(t,e.range,e.circular)})&&console.warn("You can't stop the 'animation' event when 'circular' is true."),e&&!bt(r.destPos,t)&&(e=(null==n?void 0:n.event)||null,this._animateLoop({depaPos:t,destPos:r.destPos,duration:r.duration,delta:this.axisManager.getDelta(t,r.destPos),isTrusted:!!e,inputEvent:e,input:(null==n?void 0:n.input)||null},function(){return i.animationEnd()}))},e.setTo=function(t,e){void 0===e&&(e=0);var n=Object.keys(t),i=this.axisManager.get(n);if(bt(t,i))return this;this.interruptManager.setInterrupt(!0);t=Tt(t,function(t,e){return i[e]!==t});return Object.keys(t).length?(t=this.axisManager.map(t,function(t,e){var n=e.range,e=e.circular;return e&&(e[0]||e[1])?t:Vt(t,n,e)}),bt(t,i)||(0<e?this.animateTo(t,e):(this.stopAnimation(),this.eventManager.triggerChange(t),this.finish(!1))),this):this},e.setBy=function(n,t){return void 0===t&&(t=0),this.setTo(wt(this.axisManager.get(Object.keys(n)),function(t,e){return t+n[e]}),t)},e._createAnimationParam=function(t,e,n){var i=this.axisManager.get(),r=t,t=(null==n?void 0:n.event)||null;return{depaPos:i,destPos:r,duration:ee(e,this._options.minimumDuration,this._options.maximumDuration),delta:this.axisManager.getDelta(i,r),inputEvent:t,input:(null==n?void 0:n.input)||null,isTrusted:!!t,done:this.animationEnd}},e._animateLoop=function(t,i){var r,o,a,s=this;t.duration?(this._animateParam=ht(ht({},t),{startTime:(new Date).getTime()}),r=wt(t.destPos,function(t){return t}),o=this._initState(this._animateParam),(a=function(){s._raf=null;var t=s._animateParam,e=s._getNextState(o),n=!s.eventManager.triggerChange(e.pos,o.pos);(o=e).finished?(t.destPos=s._getFinalPos(t.destPos,r),bt(t.destPos,s.axisManager.get(Object.keys(t.destPos)))||s.eventManager.triggerChange(t.destPos,e.pos),i()):n?s.finish(!1):s._raf=Et(a)})()):(this.eventManager.triggerChange(t.destPos),i())},e._getFinalPos=function(t,n){var i=this;return wt(t,function(t,e){if(t>=n[e]-1e-6&&t<=n[e]+1e-6)return n[e];e=i._getRoundUnit(t,e);return Ct(t,e)})},e._getRoundUnit=function(t,e){var n=this._options.round,i=null;return n||(e=this.axisManager.getAxisOptions(e),t=Math.max(Mt(e.range[0]),Mt(e.range[1]),Mt(t)),i=1/Math.pow(10,t)),i||n},t}()),re=function(r){function t(t,e,n){void 0===t&&(t={}),void 0===e&&(e={}),void 0===n&&(n={});var i=r.call(this)||this;return i.axis=t,i._inputs=[],i.options=ht({easing:function(t){return 1-Math.pow(1-t,3)},interruptable:!0,maximumDuration:1/0,minimumDuration:0,deceleration:6e-4,round:null,nested:!1},e),Object.keys(n).forEach(function(t){i.axis[t].startPos=n[t]}),i.interruptManager=new Xt(i.options),i.axisManager=new jt(i.axis),i.eventManager=new Wt(i),i.animationManager=new ie(i),i.inputObserver=new ne(i),i.eventManager.setAnimationManager(i.animationManager),i.eventManager.triggerChange(i.axisManager.get()),i}st(t,r);var e=t.prototype;return e.connect=function(t,e){t="string"==typeof t?t.split(" "):t.concat();return~this._inputs.indexOf(e)&&this.disconnect(e),e.mapAxes(t),e.connect(this.inputObserver),this._inputs.push(e),this},e.disconnect=function(t){return t?0<=(t=this._inputs.indexOf(t))&&(this._inputs[t].disconnect(),this._inputs.splice(t,1)):(this._inputs.forEach(function(t){return t.disconnect()}),this._inputs=[]),this},e.get=function(t){return this.axisManager.get(t)},e.setTo=function(t,e){return void 0===e&&(e=0),this.animationManager.setTo(t,e),this},e.setBy=function(t,e){return void 0===e&&(e=0),this.animationManager.setBy(t,e),this},e.setOptions=function(t){return this.options=ht(ht({},this.options),t),this},e.setAxis=function(t){return this.axisManager.setAxis(t),this},e.stopAnimation=function(){return this.animationManager.stopAnimation(),this.animationManager.finish(!1),this},e.updateAnimation=function(t){return this.animationManager.updateAnimation(t),this},e.isBounceArea=function(t){return this.axisManager.isOutside(t)},e.destroy=function(){this.disconnect(),this.eventManager.destroy()},t.VERSION="3.8.3",t.TRANSFORM=gt,t.DIRECTION_NONE=1,t.DIRECTION_LEFT=2,t.DIRECTION_RIGHT=4,t.DIRECTION_UP=8,t.DIRECTION_DOWN=16,t.DIRECTION_HORIZONTAL=6,t.DIRECTION_VERTICAL=24,t.DIRECTION_ALL=30,function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(a=(o<3?r(a):3<o?r(e,n,a):r(e,n))||a);return 3<o&&a&&Object.defineProperty(e,n,a),a}([ot],t)}(_),oe=function(){function t(t,e){var n=this;this.axes=[],this.element=null,this._enabled=!1,this._activeEvent=null,this._atRightEdge=!1,this._rightEdgeTimer=0,this._dragged=!1,this._isOverThreshold=!1,this._preventClickWhenDragged=function(t){n._dragged&&(t.preventDefault(),t.stopPropagation()),n._dragged=!1},this._voidFunction=function(){},this.element=yt(t),this.options=ht({inputType:["touch","mouse","pointer"],inputKey:["any"],inputButton:[ft],scale:[1,1],thresholdAngle:45,threshold:0,preventClickOnDrag:!1,iOSEdgeSwipeThreshold:30,releaseOnScroll:!1,touchAction:null},e),this._onPanstart=this._onPanstart.bind(this),this._onPanmove=this._onPanmove.bind(this),this._onPanend=this._onPanend.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this._direction=Ot(!!t[0],!!t[1]),this.axes=t},e.connect=function(t){return this._activeEvent&&(this._detachElementEvent(),this._detachWindowEvent(this._activeEvent)),this._attachElementEvent(t),this._originalCssProps=St(this.element,this.options,this._direction),this},e.disconnect=function(){return this._detachElementEvent(),this._detachWindowEvent(this._activeEvent),It(this._originalCssProps)||Dt(this.element,this._originalCssProps),this._direction=1,this},e.destroy=function(){this.disconnect(),this.element=null},e.enable=function(){return this._enabled=!0,this},e.disable=function(){return this._enabled=!1,this},e.isEnabled=function(){return this._enabled},e.release=function(){var t=this._activeEvent,e=t.prevEvent;return t.onRelease(),this._observer.release(this,e,[0,0]),this._detachWindowEvent(t),this},e._onPanstart=function(t){var e=this.options,n=e.inputKey,i=e.inputButton,e=this._activeEvent,n=e.onEventStart(t,n,i);!n||!this._enabled||1<e.getTouches(t,i)||!1!==n.srcEvent.cancelable&&(i=this.options.iOSEdgeSwipeThreshold,this._dragged=!1,this._isOverThreshold=!1,this._observer.hold(this,n),this._atRightEdge=vt&&n.center.x>window.innerWidth-i,this._attachWindowEvent(e),e.prevEvent=n)},e._onPanmove=function(t){var e=this,n=this.options,i=n.iOSEdgeSwipeThreshold,r=n.preventClickOnDrag,o=n.releaseOnScroll,a=n.inputKey,s=n.inputButton,u=n.threshold,h=n.thresholdAngle,n=this._activeEvent,a=n.onEventMove(t,a,s),s=n.getTouches(t,s);if(0===s||o&&a&&!a.srcEvent.cancelable)this._onPanend(t);else if(a&&this._enabled&&!(1<s)){s=function(t,e){if(e<0||90<e)return 1;t=Math.abs(t);return e<t&&t<180-e?24:6}(a.angle,h),h=At(6,this._direction,s),s=At(24,this._direction,s);if(n.prevEvent&&vt){if(a.center.x<0)return void this.release();this._atRightEdge&&(clearTimeout(this._rightEdgeTimer),a.deltaX<-i?this._atRightEdge=!1:this._rightEdgeTimer=window.setTimeout(function(){return e.release()},100))}i=this._getDistance([a.deltaX,a.deltaY],[h,s]),h=this._getOffset([a.offsetX,a.offsetY],[h,s]),s=h.some(function(t){return 0!==t});s&&(!1!==a.srcEvent.cancelable&&a.srcEvent.preventDefault(),a.srcEvent.stopPropagation()),(a.preventSystemEvent=s)&&(this._isOverThreshold||u<=i)&&(this._dragged=r,this._isOverThreshold=!0,this._observer.change(this,a,Ut(this.axes,h))),n.prevEvent=a}},e._onPanend=function(t){var e=this.options.inputButton,n=this._activeEvent;n.onEventEnd(t),this._enabled&&0===n.getTouches(t,e)&&(this._detachWindowEvent(n),clearTimeout(this._rightEdgeTimer),t=n.prevEvent,e=this._isOverThreshold?this._getOffset([Math.abs(t.velocityX)*(t.offsetX<0?-1:1),Math.abs(t.velocityY)*(t.offsetY<0?-1:1)],[At(6,this._direction),At(24,this._direction)]):[0,0],n.onRelease(),this._observer.release(this,t,e))},e._attachWindowEvent=function(t){var e=this;null!=t&&t.move.forEach(function(t){window.addEventListener(t,e._onPanmove,te(t))}),null!=t&&t.end.forEach(function(t){window.addEventListener(t,e._onPanend,te(t))})},e._detachWindowEvent=function(t){var e=this;null!=t&&t.move.forEach(function(t){window.removeEventListener(t,e._onPanmove)}),null!=t&&t.end.forEach(function(t){window.removeEventListener(t,e._onPanend)})},e._getOffset=function(t,e){var n=this.options.scale;return[e[0]?t[0]*n[0]:0,e[1]?t[1]*n[1]:0]},e._getDistance=function(t,e){return Math.sqrt(Number(e[0])*Math.pow(t[0],2)+Number(e[1])*Math.pow(t[1],2))},e._attachElementEvent=function(t){var e=this,n=Qt(this.options.inputType),i=this.element;if(n){if(!i)throw new Error("Element to connect input does not exist.");this._observer=t,this._enabled=!0,this._activeEvent=n,i.addEventListener("click",this._preventClickWhenDragged,!0),n.start.forEach(function(t){i.addEventListener(t,e._onPanstart)}),n.move.forEach(function(t){i.addEventListener(t,e._voidFunction)})}},e._detachElementEvent=function(){var e=this,t=this._activeEvent,n=this.element;n&&(n.removeEventListener("click",this._preventClickWhenDragged,!0),null!=t&&t.start.forEach(function(t){n.removeEventListener(t,e._onPanstart)}),null!=t&&t.move.forEach(function(t){n.removeEventListener(t,e._voidFunction)})),this._enabled=!1,this._observer=null},t}(),ae=function(){function t(t,e){this.axes=[],this.element=null,this._pinchFlag=!1,this._enabled=!1,this._activeEvent=null,this._isOverThreshold=!1,this.element=yt(t),this.options=ht({scale:1,threshold:0,inputType:["touch","pointer"],touchAction:"none"},e),this._onPinchStart=this._onPinchStart.bind(this),this._onPinchMove=this._onPinchMove.bind(this),this._onPinchEnd=this._onPinchEnd.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this._activeEvent&&this._detachEvent(),this._attachEvent(t),this._originalCssProps=St(this.element,this.options,30),this},e.disconnect=function(){return this._detachEvent(),It(this._originalCssProps)||Dt(this.element,this._originalCssProps),this},e.destroy=function(){this.disconnect(),this.element=null},e.enable=function(){return this._enabled=!0,this},e.disable=function(){return this._enabled=!1,this},e.isEnabled=function(){return this._enabled},e._onPinchStart=function(t){var e=this._activeEvent,n=e.onEventStart(t);n&&this._enabled&&2===e.getTouches(t)&&(this._baseValue=this._observer.get(this)[this.axes[0]],this._observer.hold(this,t),this._pinchFlag=!0,this._isOverThreshold=!1,e.prevEvent=n)},e._onPinchMove=function(t){var e,n,i=this.options.threshold,r=this._activeEvent,o=r.onEventMove(t);o&&this._pinchFlag&&this._enabled&&2===r.getTouches(t)&&(e=this._getDistance(o.scale),n=this._getOffset(o.scale,r.prevEvent.scale),(this._isOverThreshold||i<=e)&&(this._isOverThreshold=!0,this._observer.change(this,t,Ut(this.axes,[n]))),r.prevEvent=o)},e._onPinchEnd=function(t){var e=this._activeEvent;e.onEventEnd(t),!this._pinchFlag||!this._enabled||2<=e.getTouches(t)||(e.onRelease(),this._observer.release(this,t,[0],0),this._baseValue=null,this._pinchFlag=!1)},e._attachEvent=function(t){var e=this,n=Qt(this.options.inputType),i=this.element;if(n){if(!i)throw new Error("Element to connect input does not exist.");this._observer=t,this._enabled=!0,(this._activeEvent=n).start.forEach(function(t){i.addEventListener(t,e._onPinchStart,!1)}),n.move.forEach(function(t){i.addEventListener(t,e._onPinchMove,!1)}),n.end.forEach(function(t){i.addEventListener(t,e._onPinchEnd,!1)})}},e._detachEvent=function(){var e=this,t=this._activeEvent,n=this.element;n&&(null!=t&&t.start.forEach(function(t){n.removeEventListener(t,e._onPinchStart,!1)}),null!=t&&t.move.forEach(function(t){n.removeEventListener(t,e._onPinchMove,!1)}),null!=t&&t.end.forEach(function(t){n.removeEventListener(t,e._onPinchEnd,!1)})),this._enabled=!1,this._observer=null},e._getOffset=function(t,e){return void 0===e&&(e=1),this._baseValue*(t-e)*this.options.scale},e._getDistance=function(t){return Math.abs(t-1)},t}(),se=function(){function t(t,e){this.axes=[],this.element=null,this._enabled=!1,this._holding=!1,this._timer=null,this.element=yt(t),this.options=ht({inputKey:["any"],scale:1,releaseDelay:300,useNormalized:!0,useAnimation:!1},e),this._onWheel=this._onWheel.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this._direction=Ot(!!t[1],!!t[0]),this.axes=t},e.connect=function(t){return this._detachEvent(),this._attachEvent(t),this},e.disconnect=function(){return this._detachEvent(),this},e.destroy=function(){this.disconnect(),this.element=null},e.enable=function(){return this._enabled=!0,this},e.disable=function(){return this._enabled=!1,this},e.isEnabled=function(){return this._enabled},e._onWheel=function(t){var e,n=this;this._enabled&&kt(t,this.options.inputKey)&&(0===(e=this._getOffset([t.deltaY,t.deltaX],[At(24,this._direction),At(6,this._direction)]))[0]&&0===e[1]||(t.preventDefault(),this._holding||(this._observer.hold(this,t),this._holding=!0),this._observer.change(this,t,Ut(this.axes,e),this.options.useAnimation),clearTimeout(this._timer),this._timer=setTimeout(function(){n._holding&&(n._holding=!1,n._observer.release(n,t,[0]))},this.options.releaseDelay)))},e._getOffset=function(t,e){var n=this.options.scale,i=this.options.useNormalized;return[e[0]&&t[0]?(0<t[0]?-1:1)*(i?1:Math.abs(t[0]))*n:0,e[1]&&t[1]?(0<t[1]?-1:1)*(i?1:Math.abs(t[1]))*n:0]},e._attachEvent=function(t){var e=this.element;if(!e)throw new Error("Element to connect input does not exist.");this._observer=t,e.addEventListener("wheel",this._onWheel),this._enabled=!0},e._detachEvent=function(){this.element&&this.element.removeEventListener("wheel",this._onWheel),this._enabled=!1,this._observer=null,this._timer&&(clearTimeout(this._timer),this._timer=null)},t}(),ue=function(){function t(t,e){this.axes=[],this.element=null,this._enabled=!1,this._holding=!1,this._timer=null,this.element=yt(t),this.options=ht({scale:[1,1]},e),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this._detachEvent(),"0"!==this.element.getAttribute("tabindex")&&this.element.setAttribute("tabindex","0"),this._attachEvent(t),this},e.disconnect=function(){return this._detachEvent(),this},e.destroy=function(){this.disconnect(),this.element=null},e.enable=function(){return this._enabled=!0,this},e.disable=function(){return this._enabled=!1,this},e.isEnabled=function(){return this._enabled},e._onKeydown=function(t){if(this._enabled){var e,n=!0,i=1,r=-1;switch(t.keyCode){case 37:case 65:i=-1;break;case 39:case 68:break;case 40:case 83:i=-1,r=1;break;case 38:case 87:r=1;break;default:n=!1}(-1===r&&!this.axes[0]||1===r&&!this.axes[1])&&(n=!1),n&&(t.preventDefault(),e=-1===r?[+this.options.scale[0]*i,0]:[0,+this.options.scale[1]*i],this._holding||(this._observer.hold(this,t),this._holding=!0),clearTimeout(this._timer),this._observer.change(this,t,Ut(this.axes,e)))}},e._onKeyup=function(t){var e=this;this._holding&&(clearTimeout(this._timer),this._timer=setTimeout(function(){e._observer.release(e,t,[0,0]),e._holding=!1},80))},e._attachEvent=function(t){var e=this.element;if(!e)throw new Error("Element to connect input does not exist.");this._observer=t,e.addEventListener("keydown",this._onKeydown,!1),e.addEventListener("keypress",this._onKeydown,!1),e.addEventListener("keyup",this._onKeyup,!1),this._enabled=!0},e._detachEvent=function(){var t=this.element;t&&(t.removeEventListener("keydown",this._onKeydown,!1),t.removeEventListener("keypress",this._onKeydown,!1),t.removeEventListener("keyup",this._onKeyup,!1)),this._enabled=!1,this._observer=null},t}(),he=1e-6,ce="undefined"!=typeof Float32Array?Float32Array:Array,le=Math.PI/180;function de(t){return t*le}function fe(){var t=new ce(9);return ce!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _e(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function pe(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=c*a-s*h,d=-c*o+s*u,f=h*o-a*u,e=n*l+i*d+r*f;return e?(e=1/e,t[0]=l*e,t[1]=(-c*i+r*h)*e,t[2]=(s*i-r*a)*e,t[3]=d*e,t[4]=(c*n-r*u)*e,t[5]=(-s*n+r*o)*e,t[6]=f*e,t[7]=(-h*n+i*u)*e,t[8]=(a*n-i*o)*e,t):null}function ve(){var t=new ce(16);return ce!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ge(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],n=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+h*i,t[5]=a*r+c*i,t[6]=s*r+l*i,t[7]=u*r+n*i,t[8]=h*r-o*i,t[9]=c*r-a*i,t[10]=l*r-s*i,t[11]=n*r-u*i,t}function me(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],n=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-h*i,t[1]=a*r-c*i,t[2]=s*r-l*i,t[3]=u*r-n*i,t[8]=o*i+h*r,t[9]=a*i+c*r,t[10]=s*i+l*r,t[11]=u*i+n*r,t}function ye(t,e,n,i,r){e=1/Math.tan(e/2);return t[0]=e/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(e=1/(i-r),t[10]=(r+i)*e,t[14]=2*r*i*e):(t[10]=-1,t[14]=-2*i),t}function Ee(){var t=new ce(3);return ce!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function xe(t){var e=t[0],n=t[1],t=t[2];return Math.hypot(e,n,t)}function we(t,e,n){var i=new ce(3);return i[0]=t,i[1]=e,i[2]=n,i}function Te(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Re(t,e){var n=e[0],i=e[1],r=e[2],r=n*n+i*i+r*r;return 0<r&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function be(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ce(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],e=n[1],n=n[2];return t[0]=r*n-o*e,t[1]=o*a-i*n,t[2]=i*e-r*a,t}function Pe(t,e,n){var i=e[0],r=e[1],e=e[2];return t[0]=i*n[0]+r*n[3]+e*n[6],t[1]=i*n[1]+r*n[4]+e*n[7],t[2]=i*n[2]+r*n[5]+e*n[8],t}function Me(t,e,n){var i=n[0],r=n[1],o=n[2],a=n[3],s=e[0],u=e[1],h=e[2],c=r*h-o*u,l=o*s-i*h,n=i*u-r*s,e=r*n-o*l,o=o*c-i*n,r=i*l-r*c,a=2*a;return c*=a,l*=a,n*=a,e*=2,o*=2,r*=2,t[0]=s+c+e,t[1]=u+l+o,t[2]=h+n+r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ie,Oe=xe;Ie=Ee();var Ae,Se;Ae=new ce(4),ce!=Float32Array&&(Ae[0]=0,Ae[1]=0,Ae[2]=0,Ae[3]=0),Se=Ae;function De(){var t=new ce(4);return ce!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ve(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function Le(t,e,n,i){var r,o=e[0],a=e[1],s=e[2],u=e[3],h=n[0],c=n[1],l=n[2],d=n[3],e=o*h+a*c+s*l+u*d;return e<0&&(e=-e,h=-h,c=-c,l=-l,d=-d),i=he<1-e?(n=Math.acos(e),e=Math.sin(n),r=Math.sin((1-i)*n)/e,Math.sin(i*n)/e):(r=1-i,i),t[0]=r*o+i*h,t[1]=r*a+i*c,t[2]=r*s+i*l,t[3]=r*u+i*d,t}var Fe,Ne,ke,Ue,Qe,Be,ze=function(t){var e=new ce(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},We=function(t,e,n,i){var r=new ce(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r},Xe=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},je=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3];return 0<(e=n*n+i*i+r*r+o*o)&&(e=1/Math.sqrt(e)),t[0]=n*e,t[1]=i*e,t[2]=r*e,t[3]=o*e,t},Ge=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ye=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],a=e[0],s=e[1],t=e[2],e=e[3];return Math.abs(n-a)<=he*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=he*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-t)<=he*Math.max(1,Math.abs(r),Math.abs(t))&&Math.abs(o-e)<=he*Math.max(1,Math.abs(o),Math.abs(e))};Fe=Ee(),Ne=we(1,0,0),ke=we(0,1,0),Ue=De(),Qe=De(),Be=fe();function He(t,e){var n=new ce(2);return n[0]=t,n[1]=e,n}function qe(t,e){return t[0]=e[0],t[1]=e[1],t}function Ke(t,e){var n=e[0],i=e[1],i=n*n+i*i;return 0<i&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Ze(t){return 180*t/Math.PI}Je=new ce(2),ce!=Float32Array&&(Je[0]=0,Je[1]=0),$e=Je;var Je,$e,tn={isPowerOfTwo:function(t){return t&&0==(t&t-1)}};tn.extractPitchFromQuat=function(t){var e,t=(e=t,Me(t=we(0,0,1),t,e),t);return-1*Math.atan2(t[1],Math.sqrt(Math.pow(t[0],2)+Math.pow(t[2],2)))},tn.hypot=Math.hypot||function(t,e){return Math.sqrt(t*t+e*e)};var en={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};en[en.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},en[en.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},en[en.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]};function nn(t,e){var n=t[0]*e[1]-e[0]*t[1];return-Math.atan2(n,(e=e,(t=t)[0]*e[0]+t[1]*e[1]))}tn.yawOffsetBetween=function(t,e){t=He(t[0],t[2]),e=He(e[0],e[2]);return Ke(t,t),Ke(e,e),-nn(t,e)},tn.sign=function(t){return Math.sign?Math.sign(t):Number(0<t)-Number(t<0)||+t},tn.toDegree=Ze,tn.getRotationDelta=function(t,e,n){var i=we(en[n].targetAxis[0],en[n].targetAxis[1],en[n].targetAxis[2]),r=en[n].meshPoint,o=ze(t),a=ze(e);je(o,o),je(a,a);var s=we(0,0,1),u=we(0,0,1);Me(s,s,o),Me(u,u,a),Me(i,i,a);var h=0<be(i,Ce(Ee(),s,u))?1:-1,c=we(r[0],r[1],r[2]),t=n!==en.YAW_DELTA_BY_YAW?we(0,h,0):we(h,0,0);Me(c,c,a),Me(t,t,a);e=c,i=t,c=Ee();Ce(c,e,i),Re(c,c);t=c[0],e=c[1],i=c[2];Me(u=we(r[0],r[1],r[2]),u,a),Me(s=we(r[0],r[1],r[2]),s,o);a=Math.abs(s[0]*t+s[1]*e+s[2]*i),r=Ee();Te(r,s,(o=Ee(),s=c,c=a,o[0]=s[0]*c,o[1]=s[1]*c,o[2]=s[2]*c,o));o=(r[0]*u[0]+r[1]*u[1]+r[2]*u[2])/(xe(r)*xe(u));1<o&&(o=1);var o=Math.acos(o),r=Ce(Ee(),u,r),a=t*r[0]+e*r[1]+i*r[2],a=n!==en.YAW_DELTA_BY_YAW?0<a?1:-1:a<0?1:-1;return Ze(o*a*h)},tn.angleBetweenVec2=nn;B=-1,z=null,Ht=null,t=/Chrome\/([0-9]+)\.(?:[0-9]*)\.([0-9]*)\.([0-9]*)/i.exec(j);t&&(B=parseInt(t[1],10),z=t[2],Ht=t[3]);var rn,on,an=B,sn=65===B&&"3325"===z&&parseInt(Ht,10)<148,un=/Android/i.test(j),hn=[.2,.2],cn={NONE:"none",YAWPITCH:"yawPitch",VR:"VR"},ln=k.MathUtil||{};ln.degToRad=Math.PI/180,ln.radToDeg=180/Math.PI,ln.Vector2=function(t,e){this.x=t||0,this.y=e||0},ln.Vector2.prototype={constructor:ln.Vector2,set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},ln.Vector3=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0},ln.Vector3.prototype={constructor:ln.Vector3,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=this.length();return 0!==t?(t=1/t,this.multiplyScalar(t)):(this.x=0,this.y=0,this.z=0),this},multiplyScalar:function(t){this.x*=t,this.y*=t,this.z*=t},applyQuaternion:function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,s=t.w,u=s*e+o*i-a*n,h=s*n+a*e-r*i,t=s*i+r*n-o*e,i=-r*e-o*n-a*i;return this.x=u*s+i*-r+h*-a-t*-o,this.y=h*s+i*-o+t*-r-u*-a,this.z=t*s+i*-a+u*-o-h*-r,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossVectors:function(t,e){var n=t.x,i=t.y,r=t.z,o=e.x,t=e.y,e=e.z;return this.x=i*e-r*t,this.y=r*o-n*e,this.z=n*t-i*o,this}},ln.Quaternion=function(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==i?i:1},ln.Quaternion.prototype={constructor:ln.Quaternion,set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEulerXYZ:function(t,e,n){var i=Math.cos(t/2),r=Math.cos(e/2),o=Math.cos(n/2),t=Math.sin(t/2),e=Math.sin(e/2),n=Math.sin(n/2);return this.x=t*r*o+i*e*n,this.y=i*e*o-t*r*n,this.z=i*r*n+t*e*o,this.w=i*r*o-t*e*n,this},setFromEulerYXZ:function(t,e,n){var i=Math.cos(t/2),r=Math.cos(e/2),o=Math.cos(n/2),t=Math.sin(t/2),e=Math.sin(e/2),n=Math.sin(n/2);return this.x=t*r*o+i*e*n,this.y=i*e*o-t*r*n,this.z=i*r*n-t*e*o,this.w=i*r*o+t*e*n,this},setFromAxisAngle:function(t,e){var n=e/2,e=Math.sin(n);return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this.w=Math.cos(n),this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var n=t.x,i=t.y,r=t.z,o=t.w,a=e.x,s=e.y,t=e.z,e=e.w;return this.x=n*e+o*a+i*t-r*s,this.y=i*e+o*s+r*a-n*t,this.z=r*e+o*t+n*s-i*a,this.w=o*e-n*a-i*s-r*t,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this.x,i=this.y,r=this.z,o=this.w,a=o*t.w+n*t.x+i*t.y+r*t.z;if(a<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),1<=a)return this.w=o,this.x=n,this.y=i,this.z=r,this;var s=Math.acos(a),t=Math.sqrt(1-a*a);if(Math.abs(t)<.001)return this.w=.5*(o+this.w),this.x=.5*(n+this.x),this.y=.5*(i+this.y),this.z=.5*(r+this.z),this;a=Math.sin((1-e)*s)/t,t=Math.sin(e*s)/t;return this.w=o*a+this.w*t,this.x=n*a+this.x*t,this.y=i*a+this.y*t,this.z=r*a+this.z*t,this},setFromUnitVectors:function(t,e){return void 0===rn&&(rn=new ln.Vector3),(on=t.dot(e)+1)<1e-6?(on=0,Math.abs(t.x)>Math.abs(t.z)?rn.set(-t.y,t.x,0):rn.set(0,-t.z,t.y)):rn.crossVectors(t,e),this.x=rn.x,this.y=rn.y,this.z=rn.z,this.w=on,this.normalize(),this}};var dn,fn,_n,pn,vn,gn,mn,yn,En,xn=null!==(z=null==Q?void 0:Q.userAgent)&&void 0!==z?z:"",wn=k.Util||{};function Tn(t,e,n,i,r){c=t,a=i?i.fieldOfView:null,o=r.depthNear,h=r.depthFar,l=Math.tan(a?a.upDegrees*gn:mn),u=Math.tan(a?a.downDegrees*gn:mn),f=Math.tan(a?a.leftDegrees*gn:mn),d=Math.tan(a?a.rightDegrees*gn:mn),s=2/(f+d),a=2/(l+u),c[0]=s,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a,c[6]=0,c[7]=0,c[8]=-(f-d)*s*.5,c[9]=(l-u)*a*.5,c[10]=h/(o-h),c[11]=-1,c[12]=0,c[13]=0,c[14]=h*o/(o-h),c[15]=0;var o,a,s,u,h,c,l,d,f,_,p,v,g,m,y,E,x,w,T,R,b,C,P,M,I,O,t=n.orientation||yn,r=n.position||En;f=e,d=r,l=(s=t)[0],u=s[1],a=s[2],o=s[3],c=l*(h=l+l),r=l*(n=u+u),s=l*(t=a+a),l=u*n,u*=t,a*=t,h*=o,n*=o,t*=o,f[0]=1-(l+a),f[1]=r+t,f[2]=s-n,f[3]=0,f[4]=r-t,f[5]=1-(c+a),f[6]=u+h,f[7]=0,f[8]=s+n,f[9]=u-h,f[10]=1-(c+l),f[11]=0,f[12]=d[0],f[13]=d[1],f[14]=d[2],f[15]=1,i&&(b=I=e,R=i.offset,M=R[0],P=R[1],C=R[2],b===I?(I[12]=b[0]*M+b[4]*P+b[8]*C+b[12],I[13]=b[1]*M+b[5]*P+b[9]*C+b[13],I[14]=b[2]*M+b[6]*P+b[10]*C+b[14],I[15]=b[3]*M+b[7]*P+b[11]*C+b[15]):(_=b[0],g=b[1],E=b[2],w=b[3],p=b[4],m=b[5],O=b[6],T=b[7],v=b[8],y=b[9],x=b[10],R=b[11],I[0]=_,I[1]=g,I[2]=E,I[3]=w,I[4]=p,I[5]=m,I[6]=O,I[7]=T,I[8]=v,I[9]=y,I[10]=x,I[11]=R,I[12]=_*M+p*P+v*C+b[12],I[13]=g*M+m*P+y*C+b[13],I[14]=E*M+O*P+x*C+b[14],I[15]=w*M+T*P+R*C+b[15])),a=(t=r=e)[0],s=t[1],n=t[2],u=t[3],h=t[4],c=t[5],l=t[6],d=t[7],f=t[8],i=t[9],_=t[10],p=t[11],v=t[12],g=t[13],m=t[14],y=t[15],(t=(E=a*c-s*h)*(O=_*y-p*m)-(x=a*l-n*h)*(I=i*y-p*g)+(w=a*d-u*h)*(M=i*m-_*g)+(T=s*l-n*c)*(P=f*y-p*v)-(R=s*d-u*c)*(C=f*m-_*v)+(b=n*d-u*l)*(e=f*g-i*v))&&(t=1/t,r[0]=(c*O-l*I+d*M)*t,r[1]=(n*I-s*O-u*M)*t,r[2]=(g*b-m*R+y*T)*t,r[3]=(_*R-i*b-p*T)*t,r[4]=(l*P-h*O-d*C)*t,r[5]=(a*O-n*P+u*C)*t,r[6]=(m*w-v*b-y*x)*t,r[7]=(f*b-_*w+p*x)*t,r[8]=(h*I-c*P+d*e)*t,r[9]=(s*P-a*I-u*e)*t,r[10]=(v*R-g*w+y*E)*t,r[11]=(i*w-f*R-p*E)*t,r[12]=(c*C-h*M-l*e)*t,r[13]=(a*M-s*C+n*e)*t,r[14]=(g*x-v*T-m*E)*t,r[15]=(f*T-i*x+_*E)*t)}wn.MIN_TIMESTEP=.001,wn.MAX_TIMESTEP=1,wn.base64=function(t,e){return"data:"+t+";base64,"+e},wn.clamp=function(t,e,n){return Math.min(Math.max(e,t),n)},wn.lerp=function(t,e,n){return t+(e-t)*n},wn.isIOS=(dn=/iPad|iPhone|iPod/.test(null==Q?void 0:Q.platform),function(){return dn}),wn.isWebViewAndroid=(fn=-1!==xn.indexOf("Version")&&-1!==xn.indexOf("Android")&&-1!==xn.indexOf("Chrome"),function(){return fn}),wn.isSafari=(_n=/^((?!chrome|android).)*safari/i.test(xn),function(){return _n}),wn.isFirefoxAndroid=(pn=-1!==xn.indexOf("Firefox")&&-1!==xn.indexOf("Android"),function(){return pn}),wn.isR7=(vn=-1!==xn.indexOf("R7 Build"),function(){return vn}),wn.isLandscapeMode=function(){var t=90===k.orientation||-90===k.orientation;return wn.isR7()?!t:t},wn.isTimestampDeltaValid=function(t){return!isNaN(t)&&(!(t<=wn.MIN_TIMESTEP)&&!(t>wn.MAX_TIMESTEP))},wn.getScreenWidth=function(){return Math.max(k.screen.width,k.screen.height)*k.devicePixelRatio},wn.getScreenHeight=function(){return Math.min(k.screen.width,k.screen.height)*k.devicePixelRatio},wn.requestFullscreen=function(t){if(wn.isWebViewAndroid())return!1;if(t.requestFullscreen)t.requestFullscreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else{if(!t.msRequestFullscreen)return!1;t.msRequestFullscreen()}return!0},wn.exitFullscreen=function(){if(U.exitFullscreen)U.exitFullscreen();else if(U.webkitExitFullscreen)U.webkitExitFullscreen();else if(U.mozCancelFullScreen)U.mozCancelFullScreen();else{if(!U.msExitFullscreen)return!1;U.msExitFullscreen()}return!0},wn.getFullscreenElement=function(){return U.fullscreenElement||U.webkitFullscreenElement||U.mozFullScreenElement||U.msFullscreenElement},wn.linkProgram=function(t,e,n,i){var r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e),t.compileShader(r);e=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(e,n),t.compileShader(e);var o,a=t.createProgram();for(o in t.attachShader(a,r),t.attachShader(a,e),i)t.bindAttribLocation(a,i[o],o);return t.linkProgram(a),t.deleteShader(r),t.deleteShader(e),a},wn.getProgramUniforms=function(t,e){for(var n={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r="",o=0;o<i;o++)n[r=t.getActiveUniform(e,o).name.replace("[0]","")]=t.getUniformLocation(e,r);return n},wn.orthoMatrix=function(t,e,n,i,r,o,a){var s=1/(e-n),u=1/(i-r),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*u,t[14]=(a+o)*h,t[15]=1,t},wn.copyArray=function(t,e){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]},wn.isMobile=function(){var t,e=!1;return t=xn||(null==Q?void 0:Q.vendor)||k.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},wn.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},wn.safariCssSizeWorkaround=function(t){var e,n;wn.isIOS()&&(e=t.style.width,n=t.style.height,t.style.width=parseInt(e)+1+"px",t.style.height=parseInt(n)+"px",setTimeout(function(){t.style.width=e,t.style.height=n},100)),k.Util=wn,k.canvas=t},wn.isDebug=function(){return wn.getQueryParameter("debug")},wn.getQueryParameter=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},wn.frameDataFromPose=(gn=Math.PI/180,mn=.25*Math.PI,yn=new Float32Array([0,0,0,1]),En=new Float32Array([0,0,0]),function(t,e,n){return!(!t||!e)&&(t.pose=e,t.timestamp=e.timestamp,Tn(t.leftProjectionMatrix,t.leftViewMatrix,e,n.getEyeParameters("left"),n),Tn(t.rightProjectionMatrix,t.rightViewMatrix,e,n.getEyeParameters("right"),n),!0)}),wn.isInsideCrossDomainIFrame=function(){var t=k.self!==k.top,e=wn.getDomainFromUrl(U.referrer),n=wn.getDomainFromUrl(k.location.href);return t&&e!==n},wn.getDomainFromUrl=function(t){t=-1<t.indexOf("://")?t.split("/")[2]:t.split("/")[0];return t=t.split(":")[0]};var Rn=function(){function t(t){this.predictionTimeS=t,this.previousQ=new ln.Quaternion,this.previousTimestampS=null,this.deltaQ=new ln.Quaternion,this.outQ=new ln.Quaternion}return t.prototype.getPrediction=function(t,e,n){if(!this.previousTimestampS)return this.previousQ.copy(t),this.previousTimestampS=n,t;var i=new ln.Vector3;i.copy(e),i.normalize();e=e.length();if(e<20*ln.degToRad)return wn.isDebug()&&console.log("Moving slowly, at %s deg/s: no prediction",(ln.radToDeg*e).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;this.previousTimestampS;e*=this.predictionTimeS;return this.deltaQ.setFromAxisAngle(i,e),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(t),this.previousTimestampS=n,this.outQ},t}(),bn=function(e){function t(){var t=e.call(this)||this;return t._onDeviceMotion=t._onDeviceMotion.bind(t),t._onDeviceOrientation=t._onDeviceOrientation.bind(t),t._onChromeWithoutDeviceMotion=t._onChromeWithoutDeviceMotion.bind(t),t.isWithoutDeviceMotion=sn,t.isAndroid=un,t.stillGyroVec=Ee(),t.rawGyroVec=Ee(),t.adjustedGyroVec=Ee(),t._timer=-1,t.lastDevicemotionTimestamp=0,t._isEnabled=!1,t.enable(),t}s(t,e);var n=t.prototype;return n.enable=function(){this.isAndroid&&k.addEventListener("deviceorientation",this._onDeviceOrientation),this.isWithoutDeviceMotion?k.addEventListener("deviceorientation",this._onChromeWithoutDeviceMotion):k.addEventListener("devicemotion",this._onDeviceMotion),this._isEnabled=!0},n.disable=function(){k.removeEventListener("deviceorientation",this._onDeviceOrientation),k.removeEventListener("deviceorientation",this._onChromeWithoutDeviceMotion),k.removeEventListener("devicemotion",this._onDeviceMotion),this._isEnabled=!1},n._onChromeWithoutDeviceMotion=function(t){var e=t.alpha,n=t.beta,t=t.gamma;null!==e&&(e=(e||0)*Math.PI/180,n=(n||0)*Math.PI/180,t=(t||0)*Math.PI/180,this.trigger(new p("devicemotion",{inputEvent:{deviceorientation:{alpha:e,beta:n,gamma:-t}}})))},n._onDeviceOrientation=function(){var n=this;this._timer&&clearTimeout(this._timer),this._timer=k.setTimeout(function(){var t,e;(new Date).getTime()-n.lastDevicemotionTimestamp<200&&(t=n.stillGyroVec,e=n.rawGyroVec,t[0]=e[0],t[1]=e[1],t[2]=e[2])},200)},n._onDeviceMotion=function(t){var e,n,i=!(null==t.rotationRate.alpha),r=!(null==t.accelerationIncludingGravity.x);0!==t.interval&&i&&r&&((e=h({},t)).interval=t.interval,e.timeStamp=t.timeStamp,e.type=t.type,e.rotationRate={alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma},e.accelerationIncludingGravity={x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.z},e.acceleration={x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z},this.isAndroid&&(n=this.rawGyroVec,i=t.rotationRate.alpha||0,r=t.rotationRate.beta||0,t=t.rotationRate.gamma||0,n[0]=i,n[1]=r,n[2]=t,Te(this.adjustedGyroVec,this.rawGyroVec,this.stillGyroVec),this.lastDevicemotionTimestamp=(new Date).getTime(),e.adjustedRotationRate={alpha:this.adjustedGyroVec[0],beta:this.adjustedGyroVec[1],gamma:this.adjustedGyroVec[2]}),this.trigger(new p("devicemotion",{inputEvent:e})))},t}(_),Cn=function(){function t(t,e){this.set(t,e)}var e=t.prototype;return e.set=function(t,e){this.sample=t,this.timestampS=e},e.copy=function(t){this.set(t.sample,t.timestampS)},t}(),Pn=function(){function t(t){this.addGyroMeasurement=function(t,e){this.currentGyroMeasurement.set(t,e);e-=this.previousGyroMeasurement.timestampS;wn.isTimestampDeltaValid(e)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},this.kFilter=t,this.currentAccelMeasurement=new Cn,this.currentGyroMeasurement=new Cn,this.previousGyroMeasurement=new Cn,wn.isIOS()?this.filterQ=new ln.Quaternion(-1,0,0,1):this.filterQ=new ln.Quaternion(1,0,0,1),this.previousFilterQ=new ln.Quaternion,this.previousFilterQ.copy(this.filterQ),this.accelQ=new ln.Quaternion,this.isOrientationInitialized=!1,this.estimatedGravity=new ln.Vector3,this.measuredGravity=new ln.Vector3,this.gyroIntegralQ=new ln.Quaternion}var e=t.prototype;return e.addAccelMeasurement=function(t,e){this.currentAccelMeasurement.set(t,e)},e.getOrientation=function(){return this.filterQ},e.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,e=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(e),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(e);t=new ln.Quaternion;t.copy(this.filterQ),t.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(t),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();e=new ln.Quaternion;e.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),e.inverse(),wn.isDebug()&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",ln.radToDeg*wn.getQuaternionAngle(e),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));t=new ln.Quaternion;t.copy(this.filterQ),t.multiply(e),this.filterQ.slerp(t,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},e.accelToQuaternion_=function(t){var e=new ln.Vector3;e.copy(t),e.normalize();t=new ln.Quaternion;return t.setFromUnitVectors(new ln.Vector3(0,0,-1),e),t.inverse(),t},e.gyroToQuaternionDelta_=function(t,e){var n=new ln.Quaternion,i=new ln.Vector3;return i.copy(t),i.normalize(),n.setFromAxisAngle(i,t.length()*e),n},t}();Pn.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,e=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(e),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(e);t=new ln.Quaternion;t.copy(this.filterQ),t.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(t),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();e=new ln.Quaternion;e.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),e.inverse();t=new ln.Quaternion;t.copy(this.filterQ),t.multiply(e),this.filterQ.slerp(t,1-this.kFilter),this.previousFilterQ.copy(this.filterQ),this.isFilterQuaternionInitialized||(this.isFilterQuaternionInitialized=!0)},Pn.prototype.getOrientation=function(){return this.isFilterQuaternionInitialized?this.filterQ:null};var Mn=function(e){function t(){var t=e.call(this)||this;return t.deviceMotion=new bn,t.accelerometer=new ln.Vector3,t.gyroscope=new ln.Vector3,t._onDeviceMotionChange=t._onDeviceMotionChange.bind(t),t._onScreenOrientationChange=t._onScreenOrientationChange.bind(t),t.filter=new Pn(.98),t.posePredictor=new Rn(.04),t.filterToWorldQ=new ln.Quaternion,t.isFirefoxAndroid=wn.isFirefoxAndroid(),t.isIOS=W||X,t.isChromeUsingDegrees=66<=an,t._isEnabled=!1,t.isIOS?t.filterToWorldQ.setFromAxisAngle(new ln.Vector3(1,0,0),Math.PI/2):t.filterToWorldQ.setFromAxisAngle(new ln.Vector3(1,0,0),-Math.PI/2),t.inverseWorldToScreenQ=new ln.Quaternion,t.worldToScreenQ=new ln.Quaternion,t.originalPoseAdjustQ=new ln.Quaternion,t.originalPoseAdjustQ.setFromAxisAngle(new ln.Vector3(0,0,1),-k.orientation*Math.PI/180),t._setScreenTransform(),wn.isLandscapeMode()&&t.filterToWorldQ.multiply(t.inverseWorldToScreenQ),t.resetQ=new ln.Quaternion,t.deviceMotion.on("devicemotion",t._onDeviceMotionChange),t.enable(),t}s(t,e);var n=t.prototype;return n.enable=function(){this.isEnabled()||(this.deviceMotion.enable(),this._isEnabled=!0,k.addEventListener("orientationchange",this._onScreenOrientationChange))},n.disable=function(){this.isEnabled()&&(this.deviceMotion.disable(),this._isEnabled=!1,k.removeEventListener("orientationchange",this._onScreenOrientationChange))},n.isEnabled=function(){return this._isEnabled},n.destroy=function(){this.disable(),this.deviceMotion=null},n.getOrientation=function(){var t,e=this;if(this.deviceMotion.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||(new ln.Quaternion).setFromAxisAngle(new ln.Vector3(0,1,0),-e._alpha),t=this._deviceOrientationQ,(i=new ln.Quaternion).copy(t),i.multiply(this.filterToWorldQ),i.multiply(this.resetQ),i.multiply(this.worldToScreenQ),i.multiplyQuaternions(this.deviceOrientationFixQ,i);var n=We(i.x,i.y,i.z,i.w);return je(n,n)}if(!(t=this.filter.getOrientation()))return null;var i=this._convertFusionToPredicted(t),n=We(i.x,i.y,i.z,i.w);return je(n,n)},n._triggerChange=function(){var t=this.getOrientation();t&&(this._prevOrientation?Ye(this._prevOrientation,t)||this.trigger(new p("change",{quaternion:t})):this._prevOrientation=t)},n._convertFusionToPredicted=function(t){this.predictedQ=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);t=new ln.Quaternion;return t.copy(this.filterToWorldQ),t.multiply(this.resetQ),t.multiply(this.predictedQ),t.multiply(this.worldToScreenQ),t},n._onDeviceMotionChange=function(t){var e=t.inputEvent,n=e.deviceorientation,i=e.accelerationIncludingGravity,t=e.adjustedRotationRate||e.rotationRate,e=e.timeStamp/1e3;n?(this._alpha||(this._alpha=n.alpha),this._deviceOrientationQ=this._deviceOrientationQ||new ln.Quaternion,this._deviceOrientationQ.setFromEulerYXZ(n.beta,n.alpha,n.gamma),this._triggerChange()):(this.isFirefoxAndroid&&(e/=1e3),this.accelerometer.set(-i.x,-i.y,-i.z),this.gyroscope.set(t.alpha,t.beta,t.gamma),(this.isIOS||this.isFirefoxAndroid||this.isChromeUsingDegrees)&&this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,e),this.filter.addGyroMeasurement(this.gyroscope,e),this._triggerChange(),this.previousTimestampS=e)},n._onScreenOrientationChange=function(){this._setScreenTransform()},n._setScreenTransform=function(){this.worldToScreenQ.set(0,0,0,1);var t=k.orientation;switch(t){case 0:break;case 90:case-90:case 180:this.worldToScreenQ.setFromAxisAngle(new ln.Vector3(0,0,1),t/-180*Math.PI)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},t}(_),In=function(i){function t(t,e){void 0===e&&(e={});var n=i.call(this)||this;return n.element=t,n._prevQuaternion=null,n._quaternion=null,n.fusionPoseSensor=null,n.options=h({scale:1,threshold:0},e),n._onPoseChange=n._onPoseChange.bind(n),n}s(t,i);var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this.observer||(this.observer=t,this.fusionPoseSensor=new Mn,this.fusionPoseSensor.enable(),this._attachEvent()),this},e.disconnect=function(){return this.observer&&(this._dettachEvent(),this.fusionPoseSensor.disable(),this.fusionPoseSensor.destroy(),this.fusionPoseSensor=null,this.observer=null),this},e.destroy=function(){this.disconnect(),this.element=null,this.options=null,this.axes=null,this._prevQuaternion=null,this._quaternion=null},e._onPoseChange=function(t){if(!this._prevQuaternion)return this._prevQuaternion=ze(t.quaternion),void(this._quaternion=ze(t.quaternion));var i,e,n;Xe(this._prevQuaternion,this._quaternion),Xe(this._quaternion,t.quaternion),this.observer.change(this,t,(i=this.axes,[(e=this._prevQuaternion,n=this._quaternion,t=tn.getRotationDelta(e,n,en.YAW_DELTA_BY_YAW),tn.getRotationDelta(e,n,en.YAW_DELTA_BY_ROLL)*Math.sin(tn.extractPitchFromQuat(n))+t),(n=this._prevQuaternion,t=this._quaternion,tn.getRotationDelta(n,t,en.PITCH_DELTA))].reduce(function(t,e,n){return i[n]&&(t[i[n]]=e),t},{})))},e._attachEvent=function(){this.fusionPoseSensor.on("change",this._onPoseChange)},e._dettachEvent=function(){this.fusionPoseSensor.off("change",this._onPoseChange)},t}(_),On=null,An=0,Sn=function(){function t(){if(An++,On)return On;(On=this)._onDeviceOrientation=this._onDeviceOrientation.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._spinR=0,this._screenOrientationAngle=0,k.addEventListener("deviceorientation",this._onDeviceOrientation),k.addEventListener("orientationchange",this._onOrientationChange)}var e=t.prototype;return e.getRadian=function(){return this._spinR+de(this._screenOrientationAngle)},e.unref=function(){0<--An||(k.removeEventListener("deviceorientation",this._onDeviceOrientation),k.removeEventListener("orientationchange",this._onOrientationChange),this._spinR=0,this._screenOrientationAngle=0,On=null,An=0)},e._onDeviceOrientation=function(t){var e;null!==t.beta&&null!==t.gamma&&(e=de(t.beta),t=de(t.gamma),this._spinR=Math.atan2(Math.cos(e)*Math.sin(t),Math.sin(e)))},e._onOrientationChange=function(){k.screen&&k.screen.orientation&&void 0!==k.screen.orientation.angle?this._screenOrientationAngle=screen.orientation.angle:void 0!==k.orientation&&(this._screenOrientationAngle=0<=k.orientation?k.orientation:360+k.orientation)},t}(),Dn=function(r){function t(t,e){void 0===e&&(e={});t=r.call(this,t,e)||this;return t._useRotation=!1,t._screenRotationAngle=null,t.setUseRotation(!(!e||!e.useRotation)),t._userDirection=re.DIRECTION_ALL,t}s(t,r);var e=t.prototype;return e.setUseRotation=function(t){this._useRotation=t,this._screenRotationAngle&&(this._screenRotationAngle.unref(),this._screenRotationAngle=null),this._useRotation&&(this._screenRotationAngle=new Sn)},e.connect=function(t){return this._userDirection=this._direction,this._useRotation&&this._direction&re.DIRECTION_ALL&&(this._direction=re.DIRECTION_HORIZONTAL),r.prototype.connect.call(this,t)},e.destroy=function(){this._useRotation&&this._screenRotationAngle&&this._screenRotationAngle.unref(),r.prototype.destroy.call(this)},e._getOffset=function(t,e){if(!1===this._useRotation)return r.prototype._getOffset.call(this,t,e);var n=r.prototype._getOffset.call(this,t,[!0,!0]),i=[0,0],e=this._screenRotationAngle.getRadian(),t=Math.cos(e),e=Math.sin(e);return i[0]=n[0]*t-n[1]*e,i[1]=n[1]*t+n[0]*e,this._userDirection&re.DIRECTION_HORIZONTAL?this._userDirection&re.DIRECTION_VERTICAL||(i[1]=0):i[0]=0,i},t}(oe),Vn=we(0,1,0),Ln=function(t){function e(){var e=t.call(this)||this;return e._fusionPoseSensor=new Mn,e._quaternion=De(),e._fusionPoseSensor.enable(),e._fusionPoseSensor.on("change",function(t){e._quaternion=t.quaternion,e.trigger(new p("change",{isTrusted:!0}))}),e}s(e,t);var n=e.prototype;return n.getCombinedQuaternion=function(t){var e,n,i,r,o,a,s=Ve(De(),Vn,-t*le),u=(a=De(),o=this._quaternion,a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a);return e=De(),i=s,r=(n=u)[0],t=n[1],o=n[2],a=n[3],s=i[0],u=i[1],n=i[2],i=i[3],e[0]=r*i+a*s+t*n-o*u,e[1]=t*i+a*u+o*s-r*n,e[2]=o*i+a*n+r*u-t*s,e[3]=a*i-r*s-t*u-o*n,e},n.destroy=function(){this.off(),this._fusionPoseSensor&&(this._fusionPoseSensor.off(),this._fusionPoseSensor.destroy(),this._fusionPoseSensor=null)},e}(_),Fn=[-180,180],Nn=[-90,90],kn=[-180,180],Un=function(n){function t(t){var e=n.call(this)||this;e.options={};t=h({element:null,yaw:0,pitch:0,fov:65,showPolePoint:!1,useZoom:!0,useKeyboard:!0,gyroMode:cn.YAWPITCH,touchDirection:6,yawRange:Fn,pitchRange:Nn,fovRange:[30,110],aspectRatio:1},t);return e._element=t.element,e._initialFov=t.fov,e._enabled=!1,e._isAnimating=!1,e._deviceQuaternion=null,e._initAxes(t),e.option(t),e}s(t,n);var e=t.prototype;return e.updatePanScale=function(t){void 0===t&&(t={});var e=this._axes.get().fov,t=t.height||parseInt(window.getComputedStyle(this._element).height,10),t=hn[0]*e/this._initialFov*320/t;return this._axesPanInput.options.scale=[t,t],this._axes.options.deceleration=.0014*e/110,this},e.option=function(t,e){if(!t)return this._getOptions();if(t&&"string"==typeof t&&void 0===e)return this._getOptions(t);var n={},i=[];return"string"==typeof t?(i.push(t),n[t]=e):(t=t,i=Object.keys(t),n=h({},t)),this._setOptions(this._getValidatedOptions(n)),this._applyOptions(i),this},e.enable=function(){return this._enabled||(this._enabled=!0,this._applyOptions(Object.keys(this.options)),this.updatePanScale()),this},e.disable=function(t){return void 0===t&&(t=!1),this._enabled&&(t||this._resetOrientation(),this._axes.disconnect(),this._enabled=!1),this},e.lookAt=function(t,e){var n=t.yaw,i=t.pitch,r=t.fov,t=this._axes.get(),n=void 0===n?0:n-t.yaw,i=void 0===i?0:i-t.pitch,t=void 0===r?0:r-t.fov;this._axes.options.maximumDuration=1/0,this._axes.setBy({yaw:n,pitch:i,fov:t},e)},e.getYawPitch=function(){var t=this._axes.get();return{yaw:t.yaw,pitch:t.pitch}},e.getFov=function(){return this._axes.get().fov},e.getQuaternion=function(){var t=this._axes.get();return this._deviceQuaternion.getCombinedQuaternion(t.yaw)},e.shouldRenderWithQuaternion=function(){return this.options.gyroMode===cn.VR},e.destroy=function(){this._axes&&this._axes.destroy(),this._axesPanInput&&this._axesPanInput.destroy(),this._axesWheelInput&&this._axesWheelInput.destroy(),this._axesTiltMotionInput&&this._axesTiltMotionInput.destroy(),this._axesPinchInput&&this._axesPinchInput.destroy(),this._axesMoveKeyInput&&this._axesMoveKeyInput.destroy(),this._deviceQuaternion&&this._deviceQuaternion.destroy()},e._initAxes=function(t){var e=this,n=this._updateYawRange(t.yawRange,t.fov,t.aspectRatio),i=this._updatePitchRange(t.pitchRange,t.fov,t.showPolePoint),r=t.gyroMode===cn.VR;this._axesPanInput=new Dn(this._element,{useRotation:r}),this._axesWheelInput=new se(this._element,{scale:-4}),this._axesTiltMotionInput=null,this._axesPinchInput=G?new ae(this._element,{scale:-1}):null,this._axesMoveKeyInput=new ue(this._element,{scale:[-6,6]}),this._axes=new re({yaw:{range:n,circular:this._isCircular(n),bounce:[0,0]},pitch:{range:i,circular:this._isCircular(i),bounce:[0,0]},fov:{range:t.fovRange,circular:[!1,!1],bounce:[0,0]}},{deceleration:.0014,maximumDuration:1e3},{yaw:t.yaw,pitch:t.pitch,fov:t.fov}).on({hold:function(t){e._axes.options.maximumDuration=1e3,e.trigger(new p("hold",{isTrusted:t.isTrusted}))},change:function(t){0!==t.delta.fov&&(e._updateControlScale(t),e.updatePanScale()),e._triggerChange(t)},release:function(t){e._triggerChange(t)},animationEnd:function(t){e.trigger(new p("animationEnd",{isTrusted:t.isTrusted}))}})},e._getValidatedOptions=function(t){return t.yawRange&&(t.yawRange=this._getValidYawRange(t.yawRange,t.fov,t.aspectRatio)),t.pitchRange&&(t.pitchRange=this._getValidPitchRange(t.pitchRange,t.fov)),t},e._getOptions=function(t){var e;return"string"==typeof t?e=this.options[t]:0===arguments.length&&(e=this.options),e},e._setOptions=function(t){for(var e in t)this.options[e]=t[e]},e._applyOptions=function(t){var e,n,i,r=this.options,o=this._axes,a=r.gyroMode===cn.VR,s=r.gyroMode===cn.YAWPITCH,u=a?2&r.touchDirection:r.touchDirection;t.some(function(t){return"showPolePoint"===t||"fov"===t||"aspectRatio"===t||"yawRange"===t||"pitchRange"===t})&&(0<=t.indexOf("fov")&&(o.setTo({fov:r.fov}),this.updatePanScale()),this._updateControlScale()),t.some(function(t){return"fovRange"===t})&&(e=r.fovRange,n=o.get().fov,i=o.get().fov,qe(o.axis.fov.range,e),i<e[0]?i=e[0]:n>e[1]&&(i=e[1]),n!==i&&(o.setTo({fov:i},0),this._updateControlScale(),this.updatePanScale())),t.some(function(t){return"gyroMode"===t})&&Y&&(this._axesTiltMotionInput&&(this._axes.disconnect(this._axesTiltMotionInput),this._axesTiltMotionInput.destroy(),this._axesTiltMotionInput=null),this._deviceQuaternion&&(this._deviceQuaternion.destroy(),this._deviceQuaternion=null),a?this._initDeviceQuaternion():s&&(this._axesTiltMotionInput=new In(this._element),this._axes.connect(["yaw","pitch"],this._axesTiltMotionInput)),this._axesPanInput.setUseRotation(a)),t.some(function(t){return"useKeyboard"===t})&&(r.useKeyboard?o.connect(["yaw","pitch"],this._axesMoveKeyInput):o.disconnect(this._axesMoveKeyInput)),t.some(function(t){return"useZoom"===t})&&(a=r.useZoom,o.disconnect(this._axesWheelInput),a&&o.connect(["fov"],this._axesWheelInput)),this._togglePinchInputByOption(r.touchDirection,r.useZoom),t.some(function(t){return"touchDirection"===t})&&this._enabled&&this._enableTouch(u)},e._togglePinchInputByOption=function(t,e){this._axesPinchInput&&(this._axes.disconnect(this._axesPinchInput),e&&6===t&&-1===this._axes._inputs.indexOf(this._axesPinchInput)&&this._axes.connect(["fov"],this._axesPinchInput))},e._enableTouch=function(t){this._axesPanInput&&this._axes.disconnect(this._axesPanInput);var e=2&t?"yaw":null,t=4&t?"pitch":null;this._axes.connect([e,t],this._axesPanInput)},e._initDeviceQuaternion=function(){var e=this;this._deviceQuaternion=new Ln,this._deviceQuaternion.on("change",function(t){e._triggerChange(t)})},e._getValidYawRange=function(t,e,n){n=this._adjustAspectRatio(n||this.options.aspectRatio||1),n=(e||this._axes.get().fov)*n;return t[1]-t[0]>=n?t:this.options.yawRange||Fn},e._getValidPitchRange=function(t,e){e=e||this._axes.get().fov;return t[1]-t[0]>=e?t:this.options.pitchRange||Nn},e._isCircular=function(t){return t[1]-t[0]<360?[!1,!1]:[!0,!0]},e._updateControlScale=function(t){var e=this.options,n=this._axes.get().fov,i=this._updatePitchRange(e.pitchRange,n,e.showPolePoint),r=this._updateYawRange(e.yawRange,n,e.aspectRatio),n=this._axes.get(),e=n.yaw,n=n.pitch;return qe(this._axes.axis.yaw.range,r),qe(this._axes.axis.pitch.range,i),this._axes.axis.yaw.circular=this._isCircular(r),this._axes.axis.pitch.circular=this._isCircular(i),e<r[0]?e=r[0]:e>r[1]&&(e=r[1]),n<i[0]?n=i[0]:n>i[1]&&(n=i[1]),t&&t.set({yaw:e,pitch:n}),this._axes.setTo({yaw:e,pitch:n},0),this},e._updatePitchRange=function(t,e,n){if(this.options.gyroMode===cn.VR)return kn;var i=t[1]-t[0],e=e/2;return!n||i<180?[t[0]+e,t[1]-e]:t.concat()},e._updateYawRange=function(t,e,n){if(this.options.gyroMode===cn.VR)return Fn;if(360<=t[1]-t[0])return t.concat();e=tn.toDegree(Math.atan2(n,1/Math.tan(e/2*le)));return[t[0]+e,t[1]-e]},e._triggerChange=function(t){var e=this._axes.get(),n=this.options,t={targetElement:n.element,isTrusted:t.isTrusted,yaw:e.yaw,pitch:e.pitch,fov:e.fov,quaternion:null};n.gyroMode===cn.VR&&this._deviceQuaternion&&(t.quaternion=this._deviceQuaternion.getCombinedQuaternion(e.yaw)),this.trigger(new p("change",t))},e._adjustAspectRatio=function(t){for(var e=[.52,.54,.563,.57,.584,.59,.609,.67,.702,.72,.76,.78,.82,.92,.97,1,1.07,1.14,1.19,1.25,1.32,1.38,1.4,1.43,1.53,1.62,1.76,1.77,1.86,1.96,2.26,2.3,2.6,3,5,6],n=[.51,.54,.606,.56,.628,.63,.647,.71,.736,.757,.78,.77,.8,.89,.975,1,1.07,1.1,1.15,1.18,1.22,1.27,1.3,1.33,1.39,1.45,1.54,1.55,1.58,1.62,1.72,1.82,1.92,2,2.24,2.3],i=-1,r=0;r<e.length-1;r++)if(e[r]<=t&&t<=e[r+1]){i=r;break}if(-1===i)return t<e[0]?n[0]:n[n[0].length-1];var o=e[i],a=e[i+1],s=n[i],n=n[i+1];return this._lerp(s,n,(t-o)/(a-o))},e._lerp=function(t,e,n){return t+n*(e-t)},e._resetOrientation=function(){var t=this.options;return this._axes.setTo({yaw:t.yaw,pitch:t.pitch,fov:t.fov},0),this},t.VERSION=i,t.CONTROL_MODE_VR=1,t.CONTROL_MODE_YAWPITCH=2,t.TOUCH_DIRECTION_ALL=6,t.TOUCH_DIRECTION_YAW=2,t.TOUCH_DIRECTION_PITCH=4,t.TOUCH_DIRECTION_NONE=1,t}(_);function Qn(t){return void 0===t}var Ht=function(){function t(){this.options={},this._eventHandler={}}var e=t.prototype;return e.trigger=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(!(0<(a=this._eventHandler[t]||[]).length))return!0;var r=n[0]||{},o=n.slice(1),a=a.concat(),s=!1;r.eventType=t,r.stop=function(){s=!0},r.currentTarget=this;var u=[r];return 1<=o.length&&(u=u.concat(o)),a.forEach(function(t){t.apply(e,u)}),!s},e.once=function(n,i){var r,o=this;if("object"==typeof n&&Qn(i)){var t,e=n;for(t in e)this.once(t,e[t]);return this}return"string"==typeof n&&"function"==typeof i&&(r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.apply(o,t),o.off(n,r)},this.on(n,r)),this},e.hasOn=function(t){return!!this._eventHandler[t]},e.on=function(t,e){if("object"==typeof t&&Qn(e)){var n,i=t;for(n in i)this.on(n,i[n]);return this}var r;return"string"==typeof t&&"function"==typeof e&&(Qn(r=this._eventHandler[t])&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(e)),this},e.off=function(t,e){var n,i;if(Qn(t))return this._eventHandler={},this;if(Qn(e)){if("string"==typeof t)return delete this._eventHandler[t],this;var r,o=t;for(r in o)this.off(r,o[r]);return this}var a=this._eventHandler[t];if(a){var s=0;try{for(var u=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(a),h=u.next();!h.done;h=u.next()){if(h.value===e){a.splice(s,1);break}s++}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}return this},t.VERSION="2.2.2",t}(),Bn=function(t,e){return(Bn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function zn(t,e){function n(){this.constructor=t}Bn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Wn=function(){return(Wn=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};var j="undefined"!=typeof window,z=j?window.navigator.userAgent:"",Xn=j&&!!("getComputedStyle"in window),jn=/MSIE|Trident|Windows Phone|Edge/.test(z),Gn=j&&!!("addEventListener"in document),Yn="width",Hn="height";function qn(t,e){return t.getAttribute(e)||""}function Kn(t){return[].slice.call(t)}function Zn(t){return"loading"in t&&"lazy"===t.getAttribute("loading")}function Jn(t,e,n){Gn?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function $n(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null}function ti(t,e){var n=t["client"+e]||t["offset"+e];return parseFloat(n||(t=t,((Xn?window.getComputedStyle(t):t.currentStyle)||{})[e.toLowerCase()]))||0}function ei(t,e,n){var i=Kn(t.querySelectorAll(function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i}(["["+n+"skip] ["+n+"width]"],e.map(function(t){return["["+n+"skip] "+t,t+"["+n+"skip]","["+n+"width] "+t].join(", ")})).join(", ")));return Kn(t.querySelectorAll("["+n+"width], "+e.join(", "))).filter(function(t){return-1===i.indexOf(t)})}var ni=[];function ii(t,e){ni.length||Jn(window,"resize",oi),t.__PREFIX__=e,ni.push(t),ri(t)}function ri(t,e){void 0===e&&(e="data-");var n,i=t.__PREFIX__||e,r=parseInt(qn(t,""+i+Yn),10)||0,e=parseInt(qn(t,""+i+Hn),10)||0;qn(t,i+"fixed")===Hn?(n=ti(t,"Height")||e,t.style[Yn]=r/e*n+"px"):(n=ti(t,"Width")||r,t.style[Hn]=e/r*n+"px")}function oi(){ni.forEach(function(t){ri(t)})}for(var z=function(o){function t(t,e){void 0===e&&(e={});var n,i,r=o.call(this)||this;return r.isReady=!1,r.isPreReady=!1,r.hasDataSize=!1,r.hasLoading=!1,r.isSkip=!1,r.onCheck=function(t){r.clear(),t&&"error"===t.type&&r.onError(r.element);t=!r.hasDataSize&&!r.hasLoading;r.onReady(t)},r.options=Wn({prefix:"data-"},e),r.element=t,r.hasDataSize=(n=t,void 0===(e=r.options.prefix)&&(e="data-"),!!n.getAttribute(e+"width")),r.hasLoading=Zn(t),r.isSkip=(t=r.element,void 0===i&&(i="data-"),!!t.getAttribute(i+"skip")),r}zn(t,o);var e=t.prototype;return e.check=function(){return this.isSkip||!this.checkElement()?(this.onAlreadyReady(!0),!1):(this.hasDataSize&&ii(this.element,this.options.prefix),(this.hasDataSize||this.hasLoading)&&this.onAlreadyPreReady(),!0)},e.addEvents=function(){var e=this,n=this.element;this.constructor.EVENTS.forEach(function(t){Jn(n,t,e.onCheck)})},e.clear=function(){var e=this,n=this.element;this.constructor.EVENTS.forEach(function(t){$n(n,t,e.onCheck)}),this.removeAutoSizer()},e.destroy=function(){this.clear(),this.off()},e.removeAutoSizer=function(){var t,e,n;this.hasDataSize&&(n=this.options.prefix,t=this.element,e=n,(n=ni.indexOf(t))<0||(e=qn(t,e+"fixed"),delete t.__PREFIX__,t.style[e===Hn?Yn:Hn]="",ni.splice(n,1),ni.length||$n(window,"resize",oi)))},e.onError=function(t){this.trigger("error",{element:this.element,target:t})},e.onPreReady=function(){this.isPreReady||(this.isPreReady=!0,this.trigger("preReady",{element:this.element,hasLoading:this.hasLoading,isSkip:this.isSkip}))},e.onReady=function(t){this.isReady||(t&&(this.isPreReady=!0),this.removeAutoSizer(),this.isReady=!0,this.trigger("ready",{element:this.element,withPreReady:t,hasLoading:this.hasLoading,isSkip:this.isSkip}))},e.onAlreadyError=function(t){var e=this;setTimeout(function(){e.onError(t)})},e.onAlreadyPreReady=function(){var t=this;setTimeout(function(){t.onPreReady()})},e.onAlreadyReady=function(t){var e=this;setTimeout(function(){e.onReady(t)})},t.EVENTS=[],t}(Ht),ai=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}zn(e,t);var n=e.prototype;return n.setHasLoading=function(t){this.hasLoading=t},n.check=function(){return this.isSkip?(this.onAlreadyReady(!0),!1):(this.hasDataSize?(ii(this.element,this.options.prefix),this.onAlreadyPreReady()):this.trigger("requestChildren"),!0)},n.checkElement=function(){return!0},n.destroy=function(){this.clear(),this.trigger("requestDestroy"),this.off()},n.onAlreadyPreReady=function(){t.prototype.onAlreadyPreReady.call(this),this.trigger("reqeustReadyChildren")},e.EVENTS=[],e}(z),j=function(n){function t(t){void 0===t&&(t={});var e=n.call(this)||this;return e.readyCount=0,e.preReadyCount=0,e.totalCount=0,e.totalErrorCount=0,e.isPreReadyOver=!0,e.elementInfos=[],e.options=Wn({loaders:{},prefix:"data-"},t),e}zn(t,n);var e=t.prototype;return e.check=function(t){var o=this,n=this.options.prefix;this.clear(),this.elementInfos=Kn(t).map(function(t,r){var e=o.getLoader(t,{prefix:n});return e.check(),e.on("error",function(t){o.onError(r,t.target)}).on("preReady",function(t){var e=o.elementInfos[r];e.hasLoading=t.hasLoading,e.isSkip=t.isSkip;t=o.checkPreReady(r);o.onPreReadyElement(r),t&&o.onPreReady()}).on("ready",function(t){var e=t.withPreReady,n=t.hasLoading,i=t.isSkip,t=o.elementInfos[r];t.hasLoading=n,t.isSkip=i;t=e&&o.checkPreReady(r),i=o.checkReady(r);e&&o.onPreReadyElement(r),o.onReadyElement(r),t&&o.onPreReady(),i&&o.onReady()}),{loader:e,element:t,hasLoading:!1,hasError:!1,isPreReady:!1,isReady:!1,isSkip:!1}});t=this.elementInfos.length;return(this.totalCount=t)||setTimeout(function(){o.onPreReady(),o.onReady()}),this},e.getTotalCount=function(){return this.totalCount},e.isPreReady=function(){return this.elementInfos.every(function(t){return t.isPreReady})},e.isReady=function(){return this.elementInfos.every(function(t){return t.isReady})},e.hasError=function(){return 0<this.totalErrorCount},e.clear=function(){this.isPreReadyOver=!1,this.totalCount=0,this.preReadyCount=0,this.readyCount=0,this.totalErrorCount=0,this.elementInfos.forEach(function(t){!t.isReady&&t.loader&&t.loader.destroy()}),this.elementInfos=[]},e.destroy=function(){this.clear(),this.off()},e.getLoader=function(e,t){var n=this,i=e.tagName.toLowerCase(),r=this.options.loaders,o=Object.keys(r);if(r[i])return new r[i](e,t);var a=new ai(e,t),s=Kn(e.querySelectorAll(o.join(", ")));a.setHasLoading(s.some(Zn));var u=!1,h=this.clone().on("error",function(t){a.onError(t.target)}).on("ready",function(){a.onReady(u)});return a.on("requestChildren",function(){var t=ei(e,o,n.options.prefix);h.check(t).on("preReady",function(t){(u=t.isReady)||a.onPreReady()})}).on("reqeustReadyChildren",function(){h.check(s)}).on("requestDestroy",function(){h.destroy()}),a},e.clone=function(){return new t(Wn({},this.options))},e.checkPreReady=function(t){return this.elementInfos[t].isPreReady=!0,++this.preReadyCount,!(this.preReadyCount<this.totalCount)},e.checkReady=function(t){return this.elementInfos[t].isReady=!0,++this.readyCount,!(this.readyCount<this.totalCount)},e.onError=function(t,e){var n=this.elementInfos[t];n.hasError=!0,this.trigger("error",{element:n.element,index:t,target:e,errorCount:this.getErrorCount(),totalErrorCount:++this.totalErrorCount})},e.onPreReadyElement=function(t){var e=this.elementInfos[t];this.trigger("preReadyElement",{element:e.element,index:t,preReadyCount:this.preReadyCount,readyCount:this.readyCount,totalCount:this.totalCount,isPreReady:this.isPreReady(),isReady:this.isReady(),hasLoading:e.hasLoading,isSkip:e.isSkip})},e.onPreReady=function(){this.isPreReadyOver=!0,this.trigger("preReady",{readyCount:this.readyCount,totalCount:this.totalCount,isReady:this.isReady(),hasLoading:this.hasLoading()})},e.onReadyElement=function(t){var e=this.elementInfos[t];this.trigger("readyElement",{index:t,element:e.element,hasError:e.hasError,errorCount:this.getErrorCount(),totalErrorCount:this.totalErrorCount,preReadyCount:this.preReadyCount,readyCount:this.readyCount,totalCount:this.totalCount,isPreReady:this.isPreReady(),isReady:this.isReady(),hasLoading:e.hasLoading,isPreReadyOver:this.isPreReadyOver,isSkip:e.isSkip})},e.onReady=function(){this.trigger("ready",{errorCount:this.getErrorCount(),totalErrorCount:this.totalErrorCount,totalCount:this.totalCount})},e.getErrorCount=function(){return this.elementInfos.filter(function(t){return t.hasError}).length},e.hasLoading=function(){return this.elementInfos.some(function(t){return t.hasLoading})},t}(Ht),si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return zn(e,t),e.prototype.checkElement=function(){var t=this.element,e=t.getAttribute("src");return t.complete&&e?(t.naturalWidth||this.onAlreadyError(t),!1):(this.addEvents(),jn&&t.setAttribute("src",e),!0)},e.EVENTS=["load","error"],e}(z),ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return zn(e,t),e.prototype.checkElement=function(){var t=this.element;return!(1<=t.readyState)&&(t.error?(this.onAlreadyError(t),!1):(this.addEvents(),!0))},e.EVENTS=["loadedmetadata","error"],e}(z),hi=function(e){function t(t){return void 0===t&&(t={}),e.call(this,Wn({loaders:{img:si,video:ui}},t))||this}return zn(t,e),t}(j),ci={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,FAIL_BIND_TEXTURE:13,INVALID_RESOURCE:14,RENDERING_CONTEXT_LOST:15},li={READY:"ready",VIEW_CHANGE:"viewChange",ANIMATION_END:"animationEnd",ERROR:"error"},di={EQUIRECTANGULAR:"equirectangular",CUBEMAP:"cubemap",CUBESTRIP:"cubestrip",PANORAMA:"panorama",STEREOSCOPIC_EQUI:"stereoequi"},fi={TOP_BOTTOM:"3dv",LEFT_RIGHT:"3dh",NONE:""},_i="view360-canvas",pi=function(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.forEach(function(n){Object.keys(n).forEach(function(t){var e=n[t];Array.isArray(i[t])&&Array.isArray(e)?i[t]=f(i[t],e):i[t]=e})}),i},vi=function(t,e){var n,i;if("object"==typeof e?(n=e.src,i=e.type):"string"==typeof e&&(n=e),!n)return!1;e=document.createElement("source");e.src=n,i&&(e.type=i),t.appendChild(e)},gi={0:"NO_ERROR",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",37442:"CONTEXT_LOST_WEBGL"},mi=null,yi=function(){function e(){}return e.createShader=function(t,e,n){e=t.createShader(e);return t.shaderSource(e,n),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)?e:(console.error(t.getShaderInfoLog(e)),null)},e.createProgram=function(t,e,n){var i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.deleteShader(e),t.deleteShader(n),t.getProgramParameter(i,t.LINK_STATUS)?i:(t.deleteProgram(i),null)},e.initBuffer=function(t,e,n,i,r){var o=t.createBuffer();return t.bindBuffer(e,o),t.bufferData(e,n,t.STATIC_DRAW),o&&(o.itemSize=i,o.numItems=n.length/i),void 0!==r&&(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,o.itemSize,t.FLOAT,!1,0,0)),o},e.getWebglContext=function(t,e){var n,i,r=null,o=h({preserveDrawingBuffer:!1,antialias:!1},e),e=function(t){return t.statusMessage};t.addEventListener("webglcontextcreationerror",e);try{for(var a=d(["webgl","experimental-webgl","webkit-3d","moz-webgl"]),s=a.next();!s.done;s=a.next()){var u=s.value;try{r=t.getContext(u,o)}catch(t){}if(r)break}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return t.removeEventListener("webglcontextcreationerror",e),r},e.createTexture=function(t,e){var n=t.createTexture();return t.bindTexture(e,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(e,null),n},e.isWebGLAvailable=function(){var t;return null===mi&&(t=document.createElement("canvas"),t=e.getWebglContext(t),mi=!!t,!t||(t=t.getExtension("WEBGL_lose_context"))&&t.loseContext()),!!mi},e.isStableWebGL=function(){var t,e=N(),n=!0;return"android"!==e.os.name||((t=parseFloat(e.os.version))<=4.3&&1<=t||4.4===t&&"chrome"!==e.browser.name)&&(n=!1),n},e.getErrorNameFromWebGLErrorCode=function(t){return t in gi?gi[t]:"UNKNOWN_ERROR"},e.texImage2D=function(t,e,n){try{t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}catch(t){console.error("WebGLUtils.texImage2D error:",t)}},e.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},e}(),Ht=N(),Ei="ie"===Ht.browser.name&&11===Ht.browser.majorVersion,xi={ERROR:"error"},wi=function(e){function t(){var t=e.call(this)||this;return t._forceDimension=null,t._pixelCanvas=null,t._pixelContext=null,t}s(t,e);var n=t.prototype;return n.render=function(t){var e=t.gl,n=t.shaderProgram,i=t.indexBuffer,r=t.mvMatrix,t=t.pMatrix;e.uniformMatrix4fv(n.pMatrixUniform,!1,t),e.uniformMatrix4fv(n.mvMatrixUniform,!1,r),i&&e.drawElements(e.TRIANGLES,i.numItems,e.UNSIGNED_SHORT,0)},n.getDimension=function(t){return{width:t.naturalWidth||t.videoWidth,height:t.naturalHeight||t.videoHeight}},n.updateShaderData=function(t){},n._initPixelSource=function(t,e){var n;void 0===e&&(e=null),(Ei&&t instanceof HTMLVideoElement||e)&&(t=(n=e||this.getDimension(t)).width,n=n.height,this._pixelCanvas=document.createElement("canvas"),this._pixelCanvas.width=t,this._pixelCanvas.height=n,this._pixelContext=this._pixelCanvas.getContext("2d")),this._forceDimension=e},n._getPixelSource=function(t){if(!this._pixelCanvas)return t;var e=this.getDimension(t),n=this._forceDimension||e;return this._pixelCanvas.width!==n.width&&(this._pixelCanvas.width=n.width),this._pixelCanvas.height!==n.height&&(this._pixelCanvas.height=n.height),this._forceDimension?this._pixelContext.drawImage(t,0,0,e.width,e.height,0,0,n.width,n.height):this._pixelContext.drawImage(t,0,0),this._pixelCanvas},n._extractTileConfig=function(t){return(Array.isArray(t.tileConfig)?t.tileConfig:Array.apply(void 0,f(Array(6))).map(function(){return t.tileConfig})).map(function(t){return h({flipHorizontal:!1,rotation:0},t)})},n._triggerError=function(t){console.error("Renderer Error:",t),this.trigger(new p(xi.ERROR,{message:"string"==typeof t?t:t.message}))},t.EVENTS=xi,t}(_),Ti=function(t){function h(){return null!==t&&t.apply(this,arguments)||this}s(h,t);var e=h.prototype;return h.extractOrder=function(t){return t.order||"RLUDBF"},e.getVertexPositionData=function(){return h._VERTEX_POSITION_DATA=null!==h._VERTEX_POSITION_DATA?h._VERTEX_POSITION_DATA:[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]},e.getIndexData=function(){if(h._INDEX_DATA)return h._INDEX_DATA;for(var t=[],e=this.getVertexPositionData(),n=0;n<e.length/3;n+=4)t.push(n,n+2,n+1,n,n+3,n+2);return h._INDEX_DATA=t},e.getTextureCoordData=function(t){var e=this,n=t.image,t=t.imageConfig,i=h.extractOrder(t),u=this.getVertexPositionData(),r=this._extractTileConfig(t),o=t.trim;return"BFUDRL".split("").map(function(t){return r[i.indexOf(t)]}).map(function(t,e){for(var n=Math.floor(t.rotation/90),i=t.flipHorizontal?[0,1,2,3]:[1,0,3,2],r=0;r<Math.abs(n);r++)t.flipHorizontal&&0<n||!t.flipHorizontal&&n<0?i.push(i.shift()):i.unshift(i.pop());for(var o=u.slice(12*e,12*e+12),a=[],s=0;s<4;s++)a[i[s]]=o.splice(0,3);return a}).map(function(t){return e._shrinkCoord({image:n,faceCoords:t,trim:o})}).reduce(function(t,e){return f(t,e.reduce(function(t,e){return f(t,e)},[]))},[])},e.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n  vVertexDirectionVector = aTextureCoord;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},e.getFragmentShaderSource=function(){return"\nprecision highp float;\nuniform samplerCube uSampler;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n  gl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n}"},e.updateTexture=function(t,e,n){var n=h.extractOrder(n),i={};n.split("").forEach(function(t,e){i[t]=e});try{if(e instanceof Array)for(var r=0;r<6;r++){var o=i["RLUDBF"[r]];yi.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,e[o])}else for(var a=this.getMaxCubeMapTextureSize(t,e),r=0;r<6;r++){var o=i["RLUDBF"[r]],s=this.extractTileFromImage(e,o,a);yi.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,s)}}catch(t){this._triggerError(t)}},e.bindTexture=function(t,e,n,i){t.bindTexture(t.TEXTURE_CUBE_MAP,e),this.updateTexture(t,n,i)},e.getSourceTileSize=function(t){var e=this.getDimension(t),n=e.width,t=e.height,e=n/t,n=e==1/6?n:6==e?t:e==2/3?n/2:n/3;return n},e.extractTileFromImage=function(t,e,n){var i=this.getDimension(t).width,r=this.getSourceTileSize(t),o=document.createElement("canvas");o.width=n,o.height=n;var a=o.getContext("2d"),s=i/r,i=r*e%(r*s),s=Math.floor(e/s)*r;return a.drawImage(t,i,s,r,r,0,0,n,n),o},e.getMaxCubeMapTextureSize=function(t,e){var n=N(),i=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),r=this.getSourceTileSize(e);if("ie"===n.browser.name&&11===n.browser.majorVersion&&!tn.isPowerOfTwo(r))for(var o=1;o<i;o*=2)if(!(o<r)){r=o;break}return"ios"===n.os.name&&(9===(n=n.os.majorVersion)&&(r=1024),8===n&&(r=512)),Math.min(i,r)},e._shrinkCoord=function(t){var e=t.image,i=t.faceCoords,n=1-t.trim*(2/(Array.isArray(e)?this.getDimension(e[0]).width:this.getSourceTileSize(e))),r=[0,1,2].map(function(e){var n=tn.sign(i[0][e]);return i.some(function(t){return tn.sign(t[e])!==n})}).map(function(t){return t?n:1});return i.map(function(t){return t.map(function(t,e){return t*r[e]})})},h._VERTEX_POSITION_DATA=null,h._INDEX_DATA=null,h}(wi),Ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}s(e,t);var n=e.prototype;return n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n  vTextureCoord = aTextureCoord;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\n#define PI 3.14159265359\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool uIsEAC;\nconst vec2 OPERATE_COORDS_RANGE = vec2(-1.0, 1.0);\nconst vec2 TEXTURE_COORDS_RANGE = vec2(0.0, 1.0);\n// vector type is used for initializing values instead of array.\nconst vec4 TEXTURE_DIVISION_X = vec4(0.0, 1.0 / 3.0, 2.0 / 3.0, 1.0);\nconst vec3 TEXTURE_DIVISION_Y = vec3(0.0, 1.0 / 2.0, 1.0);\nconst float EAC_CONST = 2.0 / PI;\nfloat scale(vec2 domainRange, vec2 targetRange, float val) {\n  float unit = 1.0 / (domainRange[1] - domainRange[0]);\n  return targetRange[0] + (targetRange[1] - targetRange[0]) * (val - domainRange[0]) * unit;\n}\nvoid main(void) {\n  float transformedCoordX;\n  float transformedCoordY;\n\n  if (uIsEAC) {\n    vec2 orgTextureRangeX;\n    vec2 orgTextureRangeY;\n\n    // Apply EAC transform\n    if (vTextureCoord.s >= TEXTURE_DIVISION_X[2]) {\n      orgTextureRangeX = vec2(TEXTURE_DIVISION_X[2], TEXTURE_DIVISION_X[3]);\n    } else if (vTextureCoord.s >= TEXTURE_DIVISION_X[1]) {\n      orgTextureRangeX = vec2(TEXTURE_DIVISION_X[1], TEXTURE_DIVISION_X[2]);\n    } else {\n      orgTextureRangeX = vec2(TEXTURE_DIVISION_X[0], TEXTURE_DIVISION_X[1]);\n    }\n\n    if (vTextureCoord.t >= TEXTURE_DIVISION_Y[1]) {\n      orgTextureRangeY = vec2(TEXTURE_DIVISION_Y[1], TEXTURE_DIVISION_Y[2]);\n    } else {\n      orgTextureRangeY = vec2(TEXTURE_DIVISION_Y[0], TEXTURE_DIVISION_Y[1]);\n    }\n\n    // scaling coors by the coordinates following the range from -1.0 to 1.0.\n    float px = scale(orgTextureRangeX, OPERATE_COORDS_RANGE, vTextureCoord.s);\n    float py = scale(orgTextureRangeY, OPERATE_COORDS_RANGE, vTextureCoord.t);\n\n    float qu = EAC_CONST * atan(px) + 0.5;\n    float qv = EAC_CONST * atan(py) + 0.5;\n\n    // re-scaling coors by original coordinates ranges\n    transformedCoordX = scale(TEXTURE_COORDS_RANGE, orgTextureRangeX, qu);\n    transformedCoordY = scale(TEXTURE_COORDS_RANGE, orgTextureRangeY, qv);\n  } else {\n    // normal cubemap\n    transformedCoordX = vTextureCoord.s;\n    transformedCoordY = vTextureCoord.t;\n  }\n\n  gl_FragColor = texture2D(uSampler, vec2(transformedCoordX, transformedCoordY));\n}"},n.getVertexPositionData=function(){return this._vertices||(this._vertices=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]),this._vertices},n.getIndexData=function(){var n=this;return function(){for(var t=[],e=0;e<n._vertices.length/3;e+=4)t.push(e,e+1,e+2,e,e+2,e+3);return t}()},n.getTextureCoordData=function(t){for(var n=this,e=t.image,t=t.imageConfig,i=this.getDimension(e),r=t.trim,o=t.order||"RLUDFB",a=[],s=1;0<=s;s--)for(var u=0;u<3;u++){var h=[u/3,s/2,(u+1)/3,s/2,(u+1)/3,(s+1)/2,u/3,(s+1)/2];a.push(h)}var c=this._extractTileConfig(t),a=a.map(function(t){return n._shrinkCoord(t,i,r)}).map(function(t,e){return n._transformCoord(t,c[e])});return"BFUDRL".split("").map(function(t){return o.indexOf(t)}).map(function(t){return a[t]}).reduce(function(t,e){return t.concat(e)},[])},n.updateTexture=function(t,e){yi.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i=this.getDimension(n),r=i.width,o=i.height,i=Math.max(r,o),o=yi.getMaxTextureSize(t);o<i?this._triggerError("Image width("+r+") exceeds device limit("+o+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},n._transformCoord=function(t,e){t=t.slice();return e.flipHorizontal&&(t=this._flipHorizontalCoord(t)),e.rotation&&(t=this._rotateCoord(t,e.rotation)),t},n._shrinkCoord=function(t,e,n){var i=e.width,e=n*(1/e.height),i=n*(1/i);return[t[0]+i,t[1]+e,t[2]-i,t[3]+e,t[4]-i,t[5]-e,t[6]+i,t[7]-e]},n._rotateCoord=function(t,e){var n,e=Math.floor(e/90)%4;if(0==e)return t;return 0<e?(n=t.splice(0,2*e),t.concat(n)):(n=t.splice(2*(4+e),2*-e)).concat(t)},n._flipHorizontalCoord=function(t){return[t[2],t[3],t[0],t[1],t[6],t[7],t[4],t[5]]},e}(wi),bi=-.5*Math.PI,Ci=[],Pi=[],Mi=[],Ii=0;Ii<=60;Ii++)for(var Oi=(Ii/60-.5)*Math.PI,Ai=Math.sin(Oi),Si=Math.cos(Oi),Di=0;Di<=60;Di++){var Vi=2*(Di/60-.5)*Math.PI+bi,Li=Math.sin(Vi),Fi=Math.cos(Vi)*Si,Ni=Ai,ki=Li*Si,Vi=Di/60,Li=Ii/60;Ci.push(Vi,Li),Pi.push(2*Fi,2*Ni,2*ki),60!==Di&&60!==Ii&&(ki=(Ni=61*Ii+Di)+60+1,Mi.push(Ni,ki,Ni+1,ki,ki+1,Ni+1))}var Ui=function(o){function t(t){var e=o.call(this)||this;return e._stereoFormat=t,e}s(t,o);var e=t.prototype;return e.render=function(t){var e,n,i=t.gl,r=t.shaderProgram;switch(this._stereoFormat){case fi.TOP_BOTTOM:e=[1,.5,0,0],n=[1,.5,0,.5];break;case fi.LEFT_RIGHT:e=[.5,1,0,0],n=[.5,1,.5,0];break;default:e=[1,1,0,0],n=[1,1,0,0]}r=i.getUniformLocation(r,"uTexScaleOffset");i.uniform4fv(r,f(e,n)),o.prototype.render.call(this,t)},e.getVertexPositionData=function(){return t._VERTEX_POSITION_DATA},e.getIndexData=function(){return t._INDEX_DATA},e.getTextureCoordData=function(){return t._TEXTURE_COORD_DATA},e.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform float uEye;\nuniform vec4 uTexScaleOffset[2];\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n  vec4 scaleOffset = uTexScaleOffset[int(uEye)];\n  vTextureCoord = aTextureCoord.xy * scaleOffset.xy + scaleOffset.zw;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},e.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord.st);\n}"},e.updateTexture=function(t,e){yi.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},e.bindTexture=function(t,e,n){var i=this.getDimension(n),r=i.width,o=i.height,i=Math.max(r,o),o=yi.getMaxTextureSize(t);o<i?this._triggerError("Image width("+r+") exceeds device limit("+o+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},t._VERTEX_POSITION_DATA=Pi,t._TEXTURE_COORD_DATA=Ci,t._INDEX_DATA=Mi,t}(wi),Qi=[],Bi=[],zi=[],Wi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}s(e,t);var n=e.prototype;return n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},n.getIndexData=function(){return e._INDEX_DATA},n.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n  vTextureCoord = aTextureCoord;\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}"},n.updateTexture=function(t,e){yi.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i,r=this.getDimension(n),o=r.width,a=r.height,s=Math.max(o,a),r=yi.getMaxTextureSize(t);r<s&&(this._triggerError("Image width("+o+") exceeds device texture limit("+r+"))"),i=a<o?{width:r,height:r*a/o}:{width:r*o/a,height:r}),this._initPixelSource(n,i),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n)},n.updateShaderData=function(t){var e,n,i,r=t.imageAspectRatio,t=void 0===r?6:r,r=t<1?(n=!0,1/t):(n=!1,t);r=6<=r?(t=360/r,i=2*Math.PI,Math.tan(t/2*le)):(i=r,.5),Qi.length=0,Bi.length=0,zi.length=0;for(var o=[-r,r],a=Math.PI/2+(2*Math.PI-i)/2,s=0,u=o.length;s<u;s++)for(e=0;e<=60;e++){var h=a+e/60*i,c=Math.cos(h),l=o[s],d=Math.sin(h),f=void 0,h=void 0,h=n?(f=1-s,e/60):(f=e/60,s);Qi.push(f,h),Bi.push(c,l,d),0===s&&e<60&&(d=e+60+1,zi.push(e,d,e+1,d,d+1,e+1))}},e._VERTEX_POSITION_DATA=Bi,e._TEXTURE_COORD_DATA=Qi,e._INDEX_DATA=zi,e}(wi),Xi="vrdisplaypresentchange",ji=[0,0,.5,1],Gi=[.5,0,.5,1],Yi="left",Hi="right",qi=function(){function t(){var e=this;this.destroy=function(){var t=e._vrDisplay;e.removeEndCallback(e.destroy),t&&t.isPresenting&&t.exitPresent(),e._clear()},this._frameData=new window.VRFrameData,this._clear()}var e=t.prototype;return Object.defineProperty(e,"context",{get:function(){return this._vrDisplay},enumerable:!1,configurable:!0}),e.canRender=function(){return Boolean(this._vrDisplay)},e.beforeRender=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null)},e.afterRender=function(){this._vrDisplay.submitFrame()},e.getEyeParams=function(t){var e=this._vrDisplay,n=.5*t.drawingBufferWidth,i=t.drawingBufferHeight,r=this._frameData;e.getFrameData(r);t=r.leftViewMatrix,e=r.rightViewMatrix;return me(t,t,this._yawOffset),me(e,e,this._yawOffset),[{viewport:[0,0,n,i],mvMatrix:t,pMatrix:r.leftProjectionMatrix},{viewport:[n,0,n,i],mvMatrix:e,pMatrix:r.rightProjectionMatrix}]},e.isPresenting=function(){return Boolean(this._vrDisplay&&this._vrDisplay.isPresenting)},e.addEndCallback=function(t){window.addEventListener(Xi,t)},e.removeEndCallback=function(t){window.removeEventListener(Xi,t)},e.requestPresent=function(i){var r=this;return navigator.getVRDisplays().then(function(t){var n=t.length&&t[0];return n?n.capabilities.canPresent?n.requestPresent([{source:i}]).then(function(){var t=n.getEyeParameters(Yi),e=n.getEyeParameters(Hi);i.width=2*Math.max(t.renderWidth,e.renderWidth),i.height=Math.max(t.renderHeight,e.renderHeight),r._setDisplay(n)}):m.reject(new Error("Display lacking capability to present.")):m.reject(new Error("No displays available."))})},e.setYawOffset=function(t){this._yawOffset=t},e._setDisplay=function(t){t=(this._vrDisplay=t).getLayers();t.length&&(t=t[0],this._leftBounds=t.leftBounds,this._rightBounds=t.rightBounds),this.addEndCallback(this.destroy)},e._clear=function(){this._vrDisplay=null,this._leftBounds=ji,this._rightBounds=Gi,this._yawOffset=0},t}(),Ki=function(){function t(t){var e=this;void 0===t&&(t={}),this.destroy=function(){var t=e._xrSession;e.removeEndCallback(e.destroy),t&&t.end().then(function(){},function(){}),e._clear()},this._clear(),this._options=t}var e=t.prototype;return Object.defineProperty(e,"context",{get:function(){return this._xrSession},enumerable:!1,configurable:!0}),e.canRender=function(t){t=t.getViewerPose(this._xrRefSpace);return Boolean(t)},e.beforeRender=function(t,e){e=e.session.renderState.baseLayer;t.bindFramebuffer(t.FRAMEBUFFER,e.framebuffer)},e.afterRender=function(){},e.getEyeParams=function(t,e){var i=this,n=e.session,e=e.getViewerPose(this._xrRefSpace);if(!e)return null;var r=n.renderState.baseLayer;return e.views.map(function(t){var e=r.getViewport(t),n=t.transform.inverse.matrix;return X&&ge(n,n,180*le),me(n,n,i._yawOffset),{viewport:[e.x,e.y,e.width,e.height],mvMatrix:n,pMatrix:t.projectionMatrix}})},e.isPresenting=function(){return this._presenting},e.addEndCallback=function(t){var e;null!==(e=this._xrSession)&&void 0!==e&&e.addEventListener("end",t)},e.removeEndCallback=function(t){var e;null!==(e=this._xrSession)&&void 0!==e&&e.removeEventListener("end",t)},e.requestPresent=function(t,r){return n(this,void 0,void 0,function(){var e,n,i=this;return o(this,function(t){switch(t.label){case 0:return e=pi({requiredFeatures:["local"]},this._options),(n=r.getContextAttributes())&&!0!==n.xrCompatible?[4,r.makeXRCompatible()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2,navigator.xr.requestSession("immersive-vr",e).then(function(e){var n=new window.XRWebGLLayer(e,r);return e.updateRenderState({baseLayer:n}),e.requestReferenceSpace("local").then(function(t){i._setSession(e,n,t)})})]}})})},e.setYawOffset=function(t){this._yawOffset=t},e._setSession=function(t,e,n){this._xrSession=t,this._xrLayer=e,this._xrRefSpace=n,this._presenting=!0,this.addEndCallback(this.destroy)},e._clear=function(){this._xrSession=null,this._xrLayer=null,this._xrRefSpace=null,this._presenting=!1,this._yawOffset=0,this._options={}},t}(),Zi=function(){function t(){var i=this;this._onLoop=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i._callback.apply(i,f(t)),i._rafId=i._context.requestAnimationFrame(i._onLoop)},this._onLoopNextTick=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=performance.now();i._callback.apply(i,f(t));n=performance.now()-n;0<=i._rafTimer&&(clearTimeout(i._rafTimer),i._rafTimer=-1),n<16?i._rafId=i._context.requestAnimationFrame(i._onLoop):i._rafTimer=window.setTimeout(i._onLoop,0)},this._callback=null,this._context=window,this._rafId=-1,this._rafTimer=-1}var e=t.prototype;return e.setCallback=function(t){this._callback=t},e.setContext=function(t){this._context=t},e.start=function(){var t=this._context,e=this._callback;t&&e&&(0<=this._rafId||0<=this._rafTimer||(this._rafId=X?t.requestAnimationFrame(this._onLoopNextTick):t.requestAnimationFrame(this._onLoop)))},e.stop=function(){0<=this._rafId&&this._context.cancelAnimationFrame(this._rafId),0<=this._rafTimer&&clearTimeout(this._rafTimer),this._rafId=-1,this._rafTimer=-1},t}(),Ji=di,$i=q||1;2<$i&&($i=2);function tr(t,r,o){[_.prototype,t.prototype].forEach(function(n){Object.getOwnPropertyNames(n).filter(function(t){return!r[t]&&!t.startsWith("_")&&"constructor"!==t}).forEach(function(t){var e,i=Object.getOwnPropertyDescriptor(n,t);i.value?Object.defineProperty(r,t,{value:function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=i.value).call.apply(t,f([this[o]],e))}}):(e={},i.get&&(e.get=function(){var t;return null===(t=i.get)||void 0===t?void 0:t.call(this[o])}),i.set&&(e.set=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return null===(t=i.set)||void 0===t?void 0:t.call.apply(t,f([this[o]],e))}),Object.defineProperty(r,t,e))})})}var er={BIND_TEXTURE:"bindTexture",IMAGE_LOADED:"imageLoaded",ERROR:"error",RENDERING_CONTEXT_LOST:"renderingContextLost",RENDERING_CONTEXT_RESTORE:"renderingContextRestore"},nr={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,RENDERER_ERROR:13},ir=function(u){function t(t,e,n,i,r,o,a,s){var l=u.call(this)||this;return l.textureCoordBuffer=null,l.vertexBuffer=null,l.indexBuffer=null,l.exitVR=function(){var t=l._vr,e=l.context,n=l._animator;t&&(t.removeEndCallback(l.exitVR),t.destroy(),l._vr=null,W&&l._restoreStyle(),l.updateViewportDimensions(l.width,l.height),l._updateViewport(),e.bindFramebuffer(e.FRAMEBUFFER,null),l._bindBuffers(),l._shouldForceDraw=!0,n.stop(),n.setContext(window),n.setCallback(l._render.bind(l)),n.start())},l._renderStereo=function(t,e){var n,i,r=l._vr,o=l.context,a=r.getEyeParams(o,e);if(a){r.beforeRender(o,e);try{for(var s=d([0,1]),u=s.next();!u.done;u=s.next()){var h=u.value,c=a[h];l.mvMatrix=c.mvMatrix,l.pMatrix=c.pMatrix,o.viewport.apply(o,f(c.viewport)),o.uniform1f(l.shaderProgram.uEye,h),l._bindBuffers(),l._draw()}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}r.afterRender()}},l._onFirstVRFrame=function(t,e){var n,i=l._vr,r=l.context,o=l._animator;i.canRender(e)&&(n=we(0,0,-1),r=i.getEyeParams(r,e)[0],e=_e(fe(),r.mvMatrix),r=_e(fe(),r.pMatrix),e=pe(fe(),e),r=pe(fe(),r),r=Pe(Ee(),n,r),Pe(r,r,e),0!==(r=tn.yawOffsetBetween(r,we(0,0,1)))&&(i.setYawOffset(r),o.setCallback(l._renderStereo)))},l.sphericalConfig=a,l.fieldOfView=a.fieldOfView,l.width=e,l.height=n,l._lastQuaternion=null,l._lastYaw=null,l._lastPitch=null,l._lastFieldOfView=null,l.pMatrix=ve(),l.mvMatrix=ve(),ye(l.pMatrix,de(l.fieldOfView),e/n,.1,100),l.textureCoordBuffer=null,l.vertexBuffer=null,l.indexBuffer=null,l.canvas=l._initCanvas(r,o,e,n),l._setDefaultCanvasStyle(),l._wrapper=null,l._wrapperOrigStyle=null,l._renderingContextAttributes=s,l._image=null,l._imageConfig=null,l._imageIsReady=!1,l._shouldForceDraw=!1,l._keepUpdate=!1,l._onContentLoad=l._onContentLoad.bind(l),l._onContentError=l._onContentError.bind(l),l._animator=new Zi,l._vr=null,t&&l.setImage({image:t,imageType:a.imageType,isVideo:i,cubemapConfig:a.cubemapConfig}),l}s(t,u);var e=t.prototype;return e.setYawPitchControl=function(t){this._yawPitchControl=t},e.getContent=function(){return this._image},e.setImage=function(t){var e=t.image,n=t.imageType,i=t.isVideo,i=void 0!==i&&i,t=t.cubemapConfig;this._imageIsReady=!1,this._isVideo=i,this._imageConfig=h({order:n===Ji.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0},trim:0},t),this._setImageType(n),this._contentLoader&&this._contentLoader.destroy(),this._contentLoader=(new hi).on("ready",this._onContentLoad).on("error",this._onContentError),i?(this._image=function(t){if(t instanceof HTMLVideoElement)return t;var e=document.createElement("video");return e.setAttribute("crossorigin","anonymous"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),t instanceof Array?t.forEach(function(t){return vi(e,t)}):vi(e,t),0<e.querySelectorAll("source").length&&e.readyState<1&&e.load(),e}(e),this._contentLoader.check([this._image]),this._keepUpdate=!0):(this._image=function(t){t=(t instanceof Array?t:[t]).map(function(t){var e=t;return"string"==typeof t&&((e=new Image).crossOrigin="anonymous",e.src=t),e});return 1===t.length?t[0]:t}(e),this._contentLoader.check(Array.isArray(this._image)?this._image:[this._image]),this._keepUpdate=!1)},e.isImageLoaded=function(){return!!this._image&&this._imageIsReady&&(!this._isVideo||2<=this._image.readyState)},e.bindTexture=function(){var i=this;return new m(function(e,n){var t=i._contentLoader;return i._image?t?void(t.isReady()?(i._bindTexture(),e()):(t.check(Array.isArray(i._image)?i._image:[i._image]),t.once("ready",function(t){0<t.errorCount?n("Failed to load images."):(i._bindTexture(),e())}))):n("ImageLoader is not initialized"):n("Image is not defined")})},e.attachTo=function(t){this._hasExternalCanvas||(this.detach(),t.appendChild(this.canvas)),this._wrapper=t},e.forceContextLoss=function(){var t;!this.hasRenderingContext()||(t=this.context.getExtension("WEBGL_lose_context"))&&t.loseContext()},e.detach=function(){!this._hasExternalCanvas&&this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},e.destroy=function(){this._contentLoader&&this._contentLoader.destroy(),this._animator.stop(),this.detach(),this.forceContextLoss(),this.off(),this.canvas.removeEventListener("webglcontextlost",this._onWebglcontextlost),this.canvas.removeEventListener("webglcontextrestored",this._onWebglcontextrestored)},e.hasRenderingContext=function(){var t=this.context;return!(!t||t.isContextLost()||!t.getProgramParameter(this.shaderProgram,t.LINK_STATUS))},e.updateFieldOfView=function(t){this.fieldOfView=t,this._updateViewport()},e.updateViewportDimensions=function(t,e){var n=!1;this.width=t,this.height=e;t*=$i,e*=$i;t!==this.canvas.width&&(this.canvas.width=t,n=!0),e!==this.canvas.height&&(this.canvas.height=e,n=!0),n&&(this._updateViewport(),this._shouldForceDraw=!0)},e.keepUpdate=function(t){t&&!1===this.isImageLoaded()&&(this._shouldForceDraw=!0),this._keepUpdate=t},e.startRender=function(){this._animator.setCallback(this._render.bind(this)),this._animator.start()},e.stopRender=function(){this._animator.stop()},e.renderWithQuaternion=function(t,e){var n,i,r,o,a,s,u,h,c,l;this.isImageLoaded()&&(!1===this._keepUpdate&&this._lastQuaternion&&Ge(this._lastQuaternion,t)&&this.fieldOfView&&this.fieldOfView===e&&!1===this._shouldForceDraw||(void 0!==e&&e!==this.fieldOfView&&this.updateFieldOfView(e),this.mvMatrix=(n=ve(),r=(i=t)[0],o=i[1],a=i[2],s=i[3],u=r*(c=r+r),h=o*c,i=o*(l=o+o),r=a*c,o=a*l,a*=e=a+a,c*=s,l*=s,e*=s,n[0]=1-i-a,n[1]=h+e,n[2]=r-l,n[3]=0,n[4]=h-e,n[5]=1-u-a,n[6]=o+c,n[7]=0,n[8]=r+l,n[9]=o-c,n[10]=1-u-i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n),this._draw(),this._lastQuaternion=ze(t),this._shouldForceDraw&&(this._shouldForceDraw=!1)))},e.renderWithYawPitch=function(t,e,n){this.isImageLoaded()&&(!1===this._keepUpdate&&null!==this._lastYaw&&this._lastYaw===t&&null!==this._lastPitch&&this._lastPitch===e&&this.fieldOfView&&this.fieldOfView===n&&!1===this._shouldForceDraw||(void 0!==n&&n!==this.fieldOfView&&this.updateFieldOfView(n),(n=this.mvMatrix)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,ge(this.mvMatrix,this.mvMatrix,-e*le),me(this.mvMatrix,this.mvMatrix,-t*le),this._draw(),this._lastYaw=t,this._lastPitch=e,this._shouldForceDraw&&(this._shouldForceDraw=!1)))},e.getProjectionRenderer=function(){return this._renderer},e.enterVR=function(t){var e=this._vr;return J||navigator.getVRDisplays?e&&e.isPresenting()?m.resolve("VR already enabled."):this._requestPresent(t):m.reject("VR is not available on this browser.")},e._setImageType=function(t){var e=this;if(t&&this._imageType!==t){switch(this._imageType=t,this._isCubeMap=t===Ji.CUBEMAP,this._renderer&&this._renderer.off(),t){case Ji.CUBEMAP:this._renderer=new Ti;break;case Ji.CUBESTRIP:this._renderer=new Ri;break;case Ji.PANORAMA:this._renderer=new Wi;break;case Ji.STEREOSCOPIC_EQUI:this._renderer=new Ui(this.sphericalConfig.stereoFormat);break;default:this._renderer=new Ui(fi.NONE)}this._renderer.on(wi.EVENTS.ERROR,function(t){e.trigger(new p(er.ERROR,{type:nr.RENDERER_ERROR,message:t.message}))}),this._initWebGL()}},e._initCanvas=function(t,e,n,i){t=t.querySelector("."+e),e=t||this._createCanvas(e);return this._hasExternalCanvas=!!t,e.width=n,e.height=i,this._onWebglcontextlost=this._onWebglcontextlost.bind(this),this._onWebglcontextrestored=this._onWebglcontextrestored.bind(this),e.addEventListener("webglcontextlost",this._onWebglcontextlost),e.addEventListener("webglcontextrestored",this._onWebglcontextrestored),e},e._createCanvas=function(t){var e=document.createElement("canvas");return e.className=t,e},e._setDefaultCanvasStyle=function(){var t=this.canvas;t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.top="0",t.style.margin="auto",t.style.maxHeight="100%",t.style.maxWidth="100%",t.style.outline="none",t.style.position="absolute"},e._onContentError=function(){return this._imageIsReady=!1,this._image=null,this.trigger(new p(er.ERROR,{type:nr.FAIL_IMAGE_LOAD,message:"failed to load image"})),!1},e._triggerContentLoad=function(){this.trigger(new p(er.IMAGE_LOADED,{content:this._image,isVideo:this._isVideo,projectionType:this._imageType}))},e._onContentLoad=function(t){0<t.errorCount||(this._imageIsReady=!0,this._triggerContentLoad())},e._initShaderProgram=function(){var t=this.context;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null);var e=this._renderer,n=e.getVertexShaderSource(),e=e.getFragmentShaderSource(),n=yi.createShader(t,t.VERTEX_SHADER,n),e=yi.createShader(t,t.FRAGMENT_SHADER,e),e=yi.createProgram(t,n,e);if(!e)throw new Error("Failed to initialize shaders: "+yi.getErrorNameFromWebGLErrorCode(t.getError()));t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.pMatrixUniform=t.getUniformLocation(e,"uPMatrix"),e.mvMatrixUniform=t.getUniformLocation(e,"uMVMatrix"),e.samplerUniform=t.getUniformLocation(e,"uSampler"),e.textureCoordAttribute=t.getAttribLocation(e,"aTextureCoord"),e.uEye=t.getUniformLocation(e,"uEye"),t.enableVertexAttribArray(e.vertexPositionAttribute),t.enableVertexAttribArray(e.textureCoordAttribute),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.uniform1i(e.samplerUniform,0),this.shaderProgram=e},e._onWebglcontextlost=function(t){t.preventDefault(),this.trigger(new p(er.RENDERING_CONTEXT_LOST))},e._onWebglcontextrestored=function(){this._initWebGL(),this.trigger(new p(er.RENDERING_CONTEXT_RESTORE))},e._updateViewport=function(){ye(this.pMatrix,de(this.fieldOfView),this.canvas.width/this.canvas.height,.1,100),this.context.viewport(0,0,this.context.drawingBufferWidth,this.context.drawingBufferHeight)},e._initWebGL=function(){var t;try{this._initRenderingContext(),t=this.context,this.updateViewportDimensions(this.width,this.height),this._initShaderProgram()}catch(t){return this.trigger(new p(er.ERROR,{type:nr.NO_WEBGL,message:"no webgl support"})),this.destroy(),void console.error(t)}t.clearColor(0,0,0,0);var e=this._isCubeMap?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;this.texture&&t.deleteTexture(this.texture),this.texture=yi.createTexture(t,e),this._imageType===Ji.CUBESTRIP&&t.enable(t.CULL_FACE)},e._initRenderingContext=function(){if(!this.hasRenderingContext()){if(!window.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");if(this.context=yi.getWebglContext(this.canvas,this._renderingContextAttributes),!this.context)throw new Error("Failed to acquire 3D rendering context")}},e._initBuffers=function(){var t=this._image,e=this._renderer.getVertexPositionData(),n=this._renderer.getIndexData(),i=this._renderer.getTextureCoordData({image:t,imageConfig:this._imageConfig}),t=this.context;this.vertexBuffer=yi.initBuffer(t,t.ARRAY_BUFFER,new Float32Array(e),3,this.shaderProgram.vertexPositionAttribute),this.indexBuffer=yi.initBuffer(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),1),this.textureCoordBuffer=yi.initBuffer(t,t.ARRAY_BUFFER,new Float32Array(i),this._isCubeMap?3:2,this.shaderProgram.textureCoordAttribute),this._bindBuffers()},e._bindTexture=function(){var t,e,n;this._imageType===Ji.CUBESTRIP?(e=(t=this._renderer.getDimension(this._image)).width,n=t.height,t=e&&n&&e/n!=1.5?1:0,this.context.uniform1f(this.context.getUniformLocation(this.shaderProgram,"uIsEAC"),t)):this._imageType===Ji.PANORAMA&&(e=(t=this._renderer.getDimension(this._image)).width,n=t.height,n=e&&n&&e/n,this._renderer.updateShaderData({imageAspectRatio:n})),this._initBuffers(),this._renderer.bindTexture(this.context,this.texture,this._image,this._imageConfig),this._shouldForceDraw=!0,this.trigger(new p(er.BIND_TEXTURE))},e._updateTexture=function(){this._renderer.updateTexture(this.context,this._image,this._imageConfig)},e._render=function(){var t,e=this._yawPitchControl,n=e.getFov();e.shouldRenderWithQuaternion()?(t=e.getQuaternion(),this.renderWithQuaternion(t,n)):(e=e.getYawPitch(),this.renderWithYawPitch(e.yaw,e.pitch,n))},e._bindBuffers=function(){var t=this.context,e=this.shaderProgram,n=this.vertexBuffer,i=this.textureCoordBuffer;t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(e.vertexPositionAttribute),t.vertexAttribPointer(e.vertexPositionAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(e.textureCoordAttribute),t.vertexAttribPointer(e.textureCoordAttribute,i.itemSize,t.FLOAT,!1,0,0)},e._draw=function(){this._isVideo&&this._keepUpdate&&this._updateTexture(),this._renderer.render({gl:this.context,shaderProgram:this.shaderProgram,indexBuffer:this.indexBuffer,mvMatrix:this.mvMatrix,pMatrix:this.pMatrix})},e._requestPresent=function(t){var n=this,i=this.context,r=this.canvas,o=this._animator;this._vr=J?new Ki(t):new qi;var a=this._vr;return o.stop(),new m(function(t,e){a.requestPresent(r,i).then(function(){a.addEndCallback(n.exitVR),o.setContext(a.context),o.setCallback(n._onFirstVRFrame),W&&n._setWrapperFullscreen(),n._shouldForceDraw=!0,o.start(),t("success")}).catch(function(t){a.destroy(),n._vr=null,o.start(),e(t)})})},e._setWrapperFullscreen=function(){var t=this._wrapper;t&&(this._wrapperOrigStyle=t.getAttribute("style"),(t=t.style).width="100vw",t.height="100vh",t.position="fixed",t.left="0",t.top="0",t.zIndex="9999")},e._restoreStyle=function(){var t=this._wrapper,e=this.canvas;t&&(this._wrapperOrigStyle?t.setAttribute("style",this._wrapperOrigStyle):t.removeAttribute("style"),this._wrapperOrigStyle=null,e.removeAttribute("style"),this._setDefaultCanvasStyle())},t.EVENTS=er,t.ERROR_TYPE=nr,t}(_),rr=function(o){function a(t,e){void 0===e&&(e={});var n=o.call(this)||this;if(!yi.isWebGLAvailable())return setTimeout(function(){n.trigger(new p(li.ERROR,{type:ci.NO_WEBGL,message:"no webgl support"}))},0),n;if(!yi.isStableWebGL())return setTimeout(function(){n.trigger(new p(li.ERROR,{type:ci.INVALID_DEVICE,message:"blacklisted browser"}))},0),n;if(e.image&&e.video)return setTimeout(function(){n.trigger(new p(li.ERROR,{type:ci.INVALID_RESOURCE,message:"Specifying multi resouces(both image and video) is not valid."}))},0),n;$(),n._container=t,n._image=e.image||e.video,n._isVideo=!!e.video,n._projectionType=e.projectionType||di.EQUIRECTANGULAR,n._cubemapConfig=h({order:n._projectionType===di.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0},trim:0},e.cubemapConfig),n._stereoFormat=e.stereoFormat||fi.TOP_BOTTOM,n._width=e.width||parseInt(window.getComputedStyle(t).width,10),n._height=e.height||parseInt(window.getComputedStyle(t).height,10),n._yaw=e.yaw||0,n._pitch=e.pitch||0,n._fov=e.fov||65,n._gyroMode=e.gyroMode||cn.YAWPITCH,n._quaternion=null,n._aspectRatio=0!==n._height?n._width/n._height:1,n._canvasClass=e.canvasClass||_i;var i=e.fovRange||[30,110],r=a._isValidTouchDirection(e.touchDirection)?e.touchDirection:Un.TOUCH_DIRECTION_ALL,r=h(h({},e),{element:t,yaw:n._yaw,pitch:n._pitch,fov:n._fov,gyroMode:n._gyroMode,fovRange:i,aspectRatio:n._aspectRatio,touchDirection:r});return n._isReady=!1,n._initYawPitchControl(r),n._initRenderer(n._yaw,n._pitch,n._fov,n._projectionType,n._cubemapConfig),n}s(a,o);var t=a.prototype;return a.isSupported=function(){return yi.isWebGLAvailable()&&yi.isStableWebGL()},a.isWebGLAvailable=function(){return yi.isWebGLAvailable()},a.isGyroSensorAvailable=function(t){var n;H||!t?m.race([new m(function(e){n=function(t){t=!(null==t.rotationRate.alpha);e(t)},window.addEventListener("devicemotion",n)}),new m(function(t){setTimeout(function(){return t(!1)},1e3)})]).then(function(e){window.removeEventListener("devicemotion",n),t&&t(e),a.isGyroSensorAvailable=function(t){return t&&t(e),e}}):t(!1)},a._isValidTouchDirection=function(t){return t===a.TOUCH_DIRECTION.NONE||t===a.TOUCH_DIRECTION.YAW||t===a.TOUCH_DIRECTION.PITCH||t===a.TOUCH_DIRECTION.ALL},t.getVideo=function(){return this._isVideo?this._photoSphereRenderer.getContent():null},t.setVideo=function(t,e){return void 0===e&&(e={}),t&&this.setImage(t,{projectionType:e.projectionType,isVideo:!0,cubemapConfig:e.cubemapConfig,stereoFormat:e.stereoFormat}),this},t.getImage=function(){return this._isVideo?null:this._photoSphereRenderer.getContent()},t.setImage=function(t,e){void 0===e&&(e={});var n=h({order:"RLUDBF",tileConfig:{flipHorizontal:!1,rotation:0},trim:0},e.cubemapConfig),i=e.stereoFormat||fi.TOP_BOTTOM,r=!!e.isVideo;return this._image&&this._isVideo!==r?console.warn("PanoViewer is not currently supporting content type changes. (Image <--\x3e Video)"):t&&(this._deactivate(),this._image=t,this._isVideo=r,this._projectionType=e.projectionType||di.EQUIRECTANGULAR,this._cubemapConfig=n,this._stereoFormat=i,this._initRenderer(this._yaw,this._pitch,this._fov,this._projectionType,this._cubemapConfig)),this},t.keepUpdate=function(t){return this._photoSphereRenderer.keepUpdate(t),this},t.getProjectionType=function(){return this._projectionType},t.enableSensor=function(){return new m(function(e,n){H&&"function"==typeof H.requestPermission?H.requestPermission().then(function(t){"granted"===t?e():n(new Error("permission denied"))}).catch(function(t){n(t)}):e()})},t.disableSensor=function(){return this},t.enterVR=function(t){var i=this;return void 0===t&&(t={}),this._isReady?new m(function(e,n){i.enableSensor().then(function(){return i._photoSphereRenderer.enterVR(t)}).then(function(t){return e(t)}).catch(function(t){return n(t)})}):m.reject(new Error("PanoViewer is not ready to show image."))},t.exitVR=function(){return this._photoSphereRenderer.exitVR(),this},t.setUseZoom=function(t){return"boolean"==typeof t&&this._yawPitchControl.option("useZoom",t),this},t.setUseKeyboard=function(t){return this._yawPitchControl.option("useKeyboard",t),this},t.setGyroMode=function(t){return this._yawPitchControl.option("gyroMode",t),this},t.setFovRange=function(t){return this._yawPitchControl.option("fovRange",t),this},t.getFovRange=function(){return this._yawPitchControl.option("fovRange")},t.updateViewportDimensions=function(t){if(void 0===t&&(t={}),!this._isReady)return this;void 0!==t.width&&void 0!==t.height||(n=window.getComputedStyle(this._container));var e=t.width||parseInt(n.width,10),n=t.height||parseInt(n.height,10);return e===this._width&&n===this._height||(this._width=e,this._height=n,this._aspectRatio=e/n,this._photoSphereRenderer.updateViewportDimensions(e,n),this._yawPitchControl.option("aspectRatio",this._aspectRatio),this._yawPitchControl.updatePanScale({height:n}),this.lookAt({},0)),this},t.getFov=function(){return this._fov},t.getYaw=function(){return this._yaw},t.getPitch=function(){return this._pitch},t.getYawRange=function(){return this._yawPitchControl.option("yawRange")},t.getPitchRange=function(){return this._yawPitchControl.option("pitchRange")},t.setYawRange=function(t){return this._yawPitchControl.option("yawRange",t),this},t.setPitchRange=function(t){return this._yawPitchControl.option("pitchRange",t),this},t.setShowPolePoint=function(t){return this._yawPitchControl.option("showPolePoint",t),this},t.lookAt=function(t,e){if(void 0===e&&(e=0),!this._isReady)return this;var n=void 0!==t.yaw?t.yaw:this._yaw,i=void 0!==t.pitch?t.pitch:this._pitch,r=this._yawPitchControl.option("pitchRange"),r=r[1]-r[0],t=void 0!==t.fov?t.fov:this._fov;return r<t&&(t=r),this._yawPitchControl.lookAt({yaw:n,pitch:i,fov:t},e),0===e&&this._photoSphereRenderer.renderWithYawPitch(n,i,t),this},t.setTouchDirection=function(t){return a._isValidTouchDirection(t)&&this._yawPitchControl.option("touchDirection",t),this},t.getTouchDirection=function(){return this._yawPitchControl.option("touchDirection")},t.destroy=function(){return this._deactivate(),this._yawPitchControl&&(this._yawPitchControl.destroy(),this._yawPitchControl=null),this},t._initRenderer=function(t,e,n,i,r){var o=this;this._photoSphereRenderer=new ir(this._image,this._width,this._height,this._isVideo,this._container,this._canvasClass,{initialYaw:t,initialPitch:e,fieldOfView:n,imageType:i,cubemapConfig:r,stereoFormat:this._stereoFormat}),this._photoSphereRenderer.setYawPitchControl(this._yawPitchControl),this._bindRendererHandler(),this._photoSphereRenderer.bindTexture().then(function(){return o._activate()}).catch(function(){o.trigger(new p(li.ERROR,{type:ci.FAIL_BIND_TEXTURE,message:"failed to bind texture"}))})},t._updateYawPitchIfNeeded=function(){var t,e,n;this._projectionType===a.ProjectionType.PANORAMA&&(e=t=void 0,(n=(n=this._photoSphereRenderer.getContent()).naturalWidth/n.naturalHeight)<1&&(n=1/n),e=n<6?(t=tn.toDegree(n),2*tn.toDegree(Math.atan(.5))):(t=360)/n,n=this._yawPitchControl.option("fovRange")[0],this._yawPitchControl.option({fov:e,yawRange:[-t/2,t/2],pitchRange:[-e/2,e/2],fovRange:[n,e]}),this.lookAt({fov:e}))},t._bindRendererHandler=function(){var e=this;this._photoSphereRenderer.on(ir.EVENTS.ERROR,function(t){e.trigger(new p(li.ERROR,t))}),this._photoSphereRenderer.on(ir.EVENTS.RENDERING_CONTEXT_LOST,function(){e._deactivate(),e.trigger(new p(li.ERROR,{type:ci.RENDERING_CONTEXT_LOST,message:"webgl rendering context lost"}))})},t._initYawPitchControl=function(t){var e=this;this._yawPitchControl=new Un(t),this._yawPitchControl.on(li.ANIMATION_END,function(t){e.trigger(new p(li.ANIMATION_END,t))}),this._yawPitchControl.on("change",function(t){e._yaw=t.yaw,e._pitch=t.pitch,e._fov=t.fov,e._quaternion=t.quaternion,e.trigger(new p(li.VIEW_CHANGE,{yaw:t.yaw,pitch:t.pitch,fov:t.fov,quaternion:t.quaternion,isTrusted:t.isTrusted}))})},t._activate=function(){this._photoSphereRenderer.attachTo(this._container),this._yawPitchControl.enable(),this.updateViewportDimensions(),this._isReady=!0,this._updateYawPitchIfNeeded(),this.trigger(new p(li.READY)),this._photoSphereRenderer.startRender()},t._deactivate=function(){var t=this.getVideo();t&&t.pause(),this._isReady&&(this._photoSphereRenderer.stopRender(),this._yawPitchControl.disable(),this._isReady=!1),this._photoSphereRenderer&&(this._photoSphereRenderer.destroy(),this._photoSphereRenderer=null)},a.VERSION=i,a.ERROR_TYPE=ci,a.EVENTS=li,a.PROJECTION_TYPE=di,a.GYRO_MODE=cn,a.ProjectionType=di,a.STEREO_FORMAT=fi,a.TOUCH_DIRECTION={NONE:Un.TOUCH_DIRECTION_NONE,YAW:Un.TOUCH_DIRECTION_YAW,PITCH:Un.TOUCH_DIRECTION_PITCH,ALL:Un.TOUCH_DIRECTION_ALL},a}(_),z={__proto__:null,PanoViewer:rr,VERSION:i,GYRO_MODE:cn,PANOVIEWER_EVENTS:li,ERROR_TYPE:ci,PROJECTION_TYPE:di,STEREO_FORMAT:fi,PANOVIEWER_OPTIONS:{image:!0,video:!0,projectionType:!0,cubemapConfig:!0,stereoFormat:!0,width:!0,height:!0,yaw:!0,pitch:!0,fov:!0,showPolePoint:!0,useZoom:!0,useKeyboard:!0,gyroMode:!0,yawRange:!0,pitchRange:!0,fovRange:!0,touchDirection:!0,canvasClass:!0},DEFAULT_CANVAS_CLASS:_i},or="view360-wrapper",ar="view360-image",sr=function(u){function h(t,e){void 0===e&&(e={});var n=u.call(this)||this,i=e||{};n._el=t,n._rowCount=i.rowCount||1,n._colCount=i.colCount||1,n._totalCount=n._rowCount*n._colCount,n._width=i.width||"auto",n._height=i.height||"auto",n._autoHeight=null==i.autoHeight||i.autoHeight,n._colRow=[0,0],i.colRow?n._colRow=i.colRow:i.frameIndex&&n.setFrameIndex(i.frameIndex),n._el.style.width=h._getSizeString(n._width),n._el.style.height=h._getSizeString(n._height);var r=i.wrapperClass||or,e=i.imageClass||ar;if(!i.imageUrl)return setTimeout(function(){n.trigger(new p("imageError",{imageUrl:i.imageUrl}))},0),n;var o=t.querySelector("."+e),a=t.querySelector("."+r);a&&o&&(o.style.display="none"),n._image=o||new Image;var s=n._image;return s.onload=function(){a&&o&&(o.style.display=""),n._bg=h._createBgDiv(a,s,n._rowCount,n._colCount,n._autoHeight),n._el.appendChild(n._bg),n.setColRow(n._colRow[0],n._colRow[1]),n.trigger(new p("load",{target:n._el,bgElement:n._bg})),n._autoPlayReservedInfo&&(n.play(n._autoPlayReservedInfo),n._autoPlayReservedInfo=null)},s.onerror=function(){n.trigger(new p("imageError",{imageUrl:i.imageUrl}))},s.src=i.imageUrl,n}s(h,u);var t=h.prototype;return h._createBgDiv=function(t,e,n,i,r){t=t||document.createElement("div");t.style.position="relative",t.style.overflow="hidden",e.style.position="absolute",e.style.width=100*i+"%",e.style.height=100*n+"%",e.ondragstart=function(){return!1},Z&&(e.style.willChange="transform"),t.appendChild(e);i=e.naturalWidth/i,n=e.naturalHeight/n;return r?(i=n/i,t.style.paddingBottom=100*i+"%"):t.style.height="100%",t},h._getSizeString=function(t){return"number"==typeof t?t+"px":t},t.setFrameIndex=function(t){t=this.toColRow(t);this.setColRow(t[0],t[1])},t.getFrameIndex=function(){return this._colRow[1]*this._colCount+this._colRow[0]},t.setColRow=function(t,e){e>this._rowCount-1||t>this._colCount-1||(this._image&&K&&(this._image.style[K]="translate("+-(t/this._colCount)*100+"%, "+-(e/this._rowCount)*100+"%)"),this._colRow=[t,e])},t.getColRow=function(){return this._colRow},t.stop=function(){this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=-1)},t.play=function(t){var e,n,i,r=this,o=void 0===t?{interval:1e3/this._totalCount,playCount:0}:t,t=o.interval,a=o.playCount;this._bg?(this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=-1),e=this.getFrameIndex(),i=n=0,this._autoPlayTimer=window.setInterval(function(){e%=r._totalCount;var t=r.toColRow(e);r.setColRow(t[0],t[1]),e++,++i===r._totalCount&&(i=0,n++),0<a&&n===a&&clearInterval(r._autoPlayTimer)},t)):this._autoPlayReservedInfo={interval:t,playCount:a}},t.toColRow=function(t){var e=this._colCount,n=this._rowCount;return t<0?[0,0]:t>=this._totalCount?[e-1,n-1]:[t%e,Math.floor(t/e)]},h.VERSION=i,h}(_),ur=function(o){function t(t,e){void 0===e&&(e={});var n=o.call(this)||this;n._el=t;var i=h({},e),r=i.colCount||1,e=i.rowCount||1;return n._scale=i.scale||1,n._panScale=.21*n._scale,n._frameCount=r*e,n._sprites=new sr(t,i).on({load:function(t){n.trigger(new p("load",t))},imageError:function(t){n.trigger(new p("imageError",{imageUrl:t.imageUrl}))}}),n._panInput=new oe(n._el,{scale:[n._panScale,n._panScale]}),n._axes=new re({angle:{range:[0,359],circular:!0}}).on({change:function(t){var e=Math.floor(t.pos.angle/(360/n._frameCount)),e=n._frameCount-e-1;n._sprites.setFrameIndex(e),n.trigger(new p("change",{frameIndex:e,colRow:n._sprites.getColRow(),angle:t.pos.angle}))},animationEnd:function(t){n.trigger(new p("animationEnd",{isTrusted:t.isTrusted}))}}),n._axes.connect("angle",n._panInput),n}s(t,o);var e=t.prototype;return e.setScale=function(t){return isNaN(t)||t<0||(this._scale=t,this._panScale=.21*t,this._panInput.options.scale=[this._panScale,this._panScale]),this},e.getScale=function(){return this._scale},e.spinBy=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setBy({angle:t},e.duration),this},e.spinTo=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setTo({angle:t},e.duration),this},e.getAngle=function(){return this._axes.get().angle||0},t.VERSION=i,t}(_),j={__proto__:null,SpinViewer:ur,SpriteImage:sr,VERSION:i,SPINVIEWER_OPTIONS:{imageUrl:!0,rowCount:!0,colCount:!0,width:!0,height:!0,autoHeight:!0,colRow:!0,scale:!0,frameIndex:!0,wrapperClass:!0,imageClass:!0},SPINVIEWER_EVENTS:{LOAD:"load",IMAGE_ERROR:"imageError",CHANGE:"change",ANIMATION_END:"animationEnd"},DEFAULT_WRAPPER_CLASS:or,DEFAULT_IMAGE_CLASS:ar},hr=function(t,e){return null!=t&&t!==e},cr=function(t,e,n,i){hr(n[e],i[e])&&t["set"+e[0].toUpperCase()+e.slice(1)](n[e])},Ht={__proto__:null,withMethods:tr,withPanoViewerMethods:function(t,e){tr(rr,t,e)},withSpinViewerMethods:function(t,e){tr(ur,t,e)},updatePanoViewer:function(e,n,i){hr(n.image,i.image)?e.setImage(n.image,{projectionType:n.projectionType,cubemapConfig:n.cubemapConfig,stereoFormat:n.stereoFormat,isVideo:!1}):hr(n.video,i.video)&&e.setVideo(n.video,{projectionType:n.projectionType,cubemapConfig:n.cubemapConfig,stereoFormat:n.stereoFormat});["fovRange","gyroMode","pitchRange","showPolePoint","touchDirection","useKeyboard","useZoom","yawRange"].forEach(function(t){cr(e,t,n,i)})},getValidProps:function(n){return Object.keys(n).reduce(function(t,e){return null!=n[e]&&(t[e]=n[e]),t},{})},generateCanvasKey:function(t){var e;do{var n=new Uint32Array(1)}while(crypto.getRandomValues(n),(e=n[0])===t);return e}},q={};return pi(q,z),pi(q,j),pi(q,Ht),q});
//# sourceMappingURL=view360.pkgd.min.js.map
